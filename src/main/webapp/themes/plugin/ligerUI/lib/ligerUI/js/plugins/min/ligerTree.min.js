(function(e){e.fn.ligerTree=function(t){return e.ligerui.run.call(this,"ligerTree",arguments)},e.fn.ligerGetTreeManager=function(){return e.ligerui.run.call(this,"ligerGetTreeManager",arguments)},e.ligerDefaults.Tree={url:null,data:null,checkbox:!0,autoCheckboxEven:!0,parentIcon:"folder",childIcon:"leaf",textFieldName:"text",attribute:["id","url"],treeLine:!0,nodeWidth:90,statusName:"__status",isLeaf:null,single:!1,onBeforeExpand:function(){},onContextmenu:function(){},onExpand:function(){},onBeforeCollapse:function(){},onCollapse:function(){},onBeforeSelect:function(){},onSelect:function(){},onBeforeCancelSelect:function(){},onCancelselect:function(){},onCheck:function(){},onSuccess:function(){},onError:function(){},onClick:function(){},idFieldName:"id",parentIDFieldName:null,topParentIDValue:0,onBeforeAppend:function(){},onAppend:function(){},onAfterAppend:function(){},slide:!0,iconFieldName:"icon",nodeDraggable:!1,nodeDraggingRender:null,btnClickToToggleOnly:!0},e.ligerui.controls.Tree=function(t,n){e.ligerui.controls.Tree.base.constructor.call(this,t,n)},e.ligerui.controls.Tree.ligerExtend(e.ligerui.core.UIComponent,{_init:function(){e.ligerui.controls.Tree.base._init.call(this);var t=this,n=this.options;n.single&&(n.autoCheckboxEven=!1)},_render:function(){var t=this,n=this.options;t.set(n,!0),t.tree=e(t.element),t.tree.addClass("l-tree"),t.sysAttribute=["isexpand","ischecked","href","style"],t.loading=e("<div class='l-tree-loading'></div>"),t.tree.after(t.loading),t.data=[],t.maxOutlineLevel=1,t.treedataindex=0,t._applyTree(),t._setTreeEven(),t.set(n,!1)},_setTreeLine:function(e){e?this.tree.removeClass("l-tree-noline"):this.tree.addClass("l-tree-noline")},_setUrl:function(e){e&&this.loadData(null,e)},_setData:function(e){e&&this.append(null,e)},setData:function(e){this.set("data",e)},getData:function(){return this.data},hasChildren:function(e){return this.options.isLeaf?this.options.isLeaf(e):e.hasChild===undefined?e.children?!0:!1:e.hasChild},getParent:function(t,n){var r=this;t=r.getNodeDom(t);var i=r.getParentTreeItem(t,n);if(!i)return null;var s=e(i).attr("treedataindex");return r._getDataNodeByTreeDataIndex(s)},getParentTreeItem:function(t,n){var r=this;t=r.getNodeDom(t);var i=e(t);if(i.parent().hasClass("l-tree"))return null;if(n==undefined)return i.parent().parent("li").length==0?null:i.parent().parent("li")[0];var s=parseInt(i.attr("outlinelevel")),o=i;for(var u=s-1;u>=n;u--)o=o.parent().parent("li");return o[0]},getChecked:function(){var t=this,n=this.options;if(!this.options.checkbox)return null;var r=[];return e(".l-checkbox-checked",t.tree).parent().parent("li").each(function(){var n=parseInt(e(this).attr("treedataindex"));r.push({target:this,data:t._getDataNodeByTreeDataIndex(t.data,n)})}),r},getSelected:function(){var t=this,n=this.options,r={};r.target=e(".l-selected",t.tree).parent("li")[0];if(r.target){var i=parseInt(e(r.target).attr("treedataindex"));return r.data=t._getDataNodeByTreeDataIndex(t.data,i),r}return null},upgrade:function(t){var n=this,r=this.options;e(".l-note",t).each(function(){e(this).removeClass("l-note").addClass("l-expandable-open")}),e(".l-note-last",t).each(function(){e(this).removeClass("l-note-last").addClass("l-expandable-open")}),e("."+n._getChildNodeClassName(),t).each(function(){e(this).removeClass(n._getChildNodeClassName()).addClass(n._getParentNodeClassName(!0))})},demotion:function(t){var n=this,r=this.options;if(!t&&t[0].tagName.toLowerCase()!="li")return;var i=e(t).hasClass("l-last");e(".l-expandable-open",t).each(function(){e(this).removeClass("l-expandable-open").addClass(i?"l-note-last":"l-note")}),e(".l-expandable-close",t).each(function(){e(this).removeClass("l-expandable-close").addClass(i?"l-note-last":"l-note")}),e("."+n._getParentNodeClassName(!0),t).each(function(){e(this).removeClass(n._getParentNodeClassName(!0)).addClass(n._getChildNodeClassName())})},collapseAll:function(){var t=this,n=this.options;e(".l-expandable-open",t.tree).click()},expandAll:function(){var t=this,n=this.options;e(".l-expandable-close",t.tree).click()},loadData:function(t,n,r){var i=this,s=this.options;i.loading.show();var o=r?"post":"get";r=r||[],e.ajax({type:o,url:n,data:r,dataType:"json",success:function(e){if(!e)return;i.loading.hide(),i.append(t,e),i.trigger("success",[e])},error:function(e,t,n){try{i.loading.hide(),i.trigger("error",[e,t,n])}catch(r){}}})},clear:function(){var t=this,n=this.options;e("> li",t.tree).each(function(){t.remove(this)})},getNodeDom:function(t){var n=this,r=this.options;return t==null?t:typeof t=="string"||typeof t=="number"?e("li[treedataindex="+t+"]",n.tree).get(0):typeof t=="object"&&"treedataindex"in t?n.getNodeDom(t.treedataindex):t},remove:function(t){var n=this,r=this.options;t=n.getNodeDom(t);var i=parseInt(e(t).attr("treedataindex")),s=n._getDataNodeByTreeDataIndex(n.data,i);s&&n._setTreeDataStatus([s],"delete");var o=n.getParentTreeItem(t);r.checkbox&&n._setParentCheckboxStatus(e(t)),e(t).remove(),n._updateStyle(o?e("ul:first",o):n.tree)},_updateStyle:function(t){var n=this,r=this.options,i=e(" > li",t),s=i.length;if(!s)return;i.each(function(t,r){t==0&&!e(this).hasClass("l-first")&&e(this).addClass("l-first"),t==s-1&&!e(this).hasClass("l-last")&&e(this).addClass("l-last"),t==0&&t==s-1&&e(this).addClass("l-onlychild"),e("> div .l-note,> div .l-note-last",this).removeClass("l-note l-note-last").addClass(t==s-1?"l-note-last":"l-note"),n._setTreeItem(this,{isLast:t==s-1})})},update:function(t,n){var r=this,i=this.options;t=r.getNodeDom(t);var s=parseInt(e(t).attr("treedataindex"));nodedata=r._getDataNodeByTreeDataIndex(r.data,s);for(var o in n)nodedata[o]=n[o],o==i.textFieldName&&e("> .l-body > span",t).text(n[o])},append:function(t,n,r,i){var s=this,o=this.options;t=s.getNodeDom(t);if(s.trigger("beforeAppend",[t,n])==0)return!1;if(!n||!n.length)return!1;o.idFieldName&&o.parentIDFieldName&&(n=s.arrayToTree(n,o.idFieldName,o.parentIDFieldName)),s._addTreeDataIndexToData(n),s._setTreeDataStatus(n,"add"),r!=null&&(r=s.getNodeDom(r)),s.trigger("append",[t,n]),s._appendData(t,n);if(t==null){var u=s._getTreeHTMLByData(n,1,[],!0);u[u.length-1]=u[0]="",r!=null?(e(r)[i?"after":"before"](u.join("")),s._updateStyle(t?e("ul:first",t):s.tree)):(e("> li:last",s.tree).length>0&&s._setTreeItem(e("> li:last",s.tree)[0],{isLast:!1}),s.tree.append(u.join(""))),e(".l-body",s.tree).hover(function(){e(this).addClass("l-over")},function(){e(this).removeClass("l-over")}),s._upadteTreeWidth(),s.trigger("afterAppend",[t,n]);return}var a=e(t),f=parseInt(a.attr("outlinelevel")),l=e("> ul",a).length>0;l||(a.append("<ul class='l-children'></ul>"),s.upgrade(t));var c=[];for(var h=1;h<=f-1;h++){var p=e(s.getParentTreeItem(t,h));c.push(p.hasClass("l-last"))}c.push(a.hasClass("l-last"));var u=s._getTreeHTMLByData(n,f+1,c,!0);u[u.length-1]=u[0]="",r!=null?(e(r)[i?"after":"before"](u.join("")),s._updateStyle(t?e("ul:first",t):s.tree)):(e("> .l-children > li:last",a).length>0&&s._setTreeItem(e("> .l-children > li:last",a)[0],{isLast:!1}),e(">.l-children",t).append(u.join(""))),s._upadteTreeWidth(),e(">.l-children .l-body",t).hover(function(){e(this).addClass("l-over")},function(){e(this).removeClass("l-over")}),s.trigger("afterAppend",[t,n])},cancelSelect:function(t){var n=this,r=this.options,i=n.getNodeDom(t),s=e(i),o=parseInt(s.attr("treedataindex")),u=n._getDataNodeByTreeDataIndex(n.data,o),a=e(">div:first",s);r.checkbox?e(".l-checkbox",a).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked"):a.removeClass("l-selected"),n.trigger("cancelSelect",[{data:u,target:s[0]}])},selectNode:function(t){var n=this,r=this.options,i=null;if(typeof t=="function")i=t;else{if(typeof t=="object"){var s=e(t),o=parseInt(s.attr("treedataindex")),u=n._getDataNodeByTreeDataIndex(n.data,o),a=e(">div:first",s);r.checkbox?e(".l-checkbox",a).removeClass("l-checkbox-unchecked").addClass("l-checkbox-checked"):a.addClass("l-selected"),n.trigger("select",[{data:u,target:s[0]}]);return}i=function(e){return e[r.idFieldName]?e[r.idFieldName].toString()==t.toString():!1}}e("li",n.tree).each(function(){var t=e(this),r=parseInt(t.attr("treedataindex")),s=n._getDataNodeByTreeDataIndex(n.data,r);i(s,r)?n.selectNode(this):n.cancelSelect(this)})},getTextByID:function(e){var t=this,n=this.options,r=t.getDataByID(e);return r?r[n.textFieldName]:null},getDataByID:function(t){var n=this,r=this.options,i=null;return e("li",n.tree).each(function(){if(i)return;var s=e(this),o=parseInt(s.attr("treedataindex")),u=n._getDataNodeByTreeDataIndex(n.data,o);u[r.idFieldName].toString()==t.toString()&&(i=u)}),i},arrayToTree:function(e,t,n){if(!e||!e.length)return[];var r=[],i={},s=e.length;for(var o=0;o<s;o++){var u=e[o];i[u[t]]=u}for(var o=0;o<s;o++){var a=e[o],f=i[a[n]];if(!f){r.push(a);continue}f.children=f.children||[],f.children.push(a)}return r},_getDataNodeByTreeDataIndex:function(e,t){var n=this,r=this.options;for(var i=0;i<e.length;i++){if(e[i].treedataindex==t)return e[i];if(e[i].children){var s=n._getDataNodeByTreeDataIndex(e[i].children,t);if(s)return s}}return null},_setTreeDataStatus:function(t,n){var r=this,i=this.options;e(t).each(function(){this[i.statusName]=n,this.children&&r._setTreeDataStatus(this.children,n)})},_addTreeDataIndexToData:function(t){var n=this,r=this.options;e(t).each(function(){if(this.treedataindex!=undefined)return;this.treedataindex=n.treedataindex++,this.children&&n._addTreeDataIndexToData(this.children)})},_addToNodes:function(t){var n=this,r=this.options;n.nodes=n.nodes||[],e.inArray(t,n.nodes)==-1&&n.nodes.push(t),t.children&&e(t.children).each(function(e,t){n._addToNodes(t)})},_appendData:function(t,n){var r=this,i=this.options,s=parseInt(e(t).attr("treedataindex")),o=r._getDataNodeByTreeDataIndex(r.data,s);r.treedataindex==undefined&&(r.treedataindex=0),o&&o.children==undefined&&(o.children=[]),e(n).each(function(e,t){o?o.children[o.children.length]=t:r.data[r.data.length]=t,r._addToNodes(t)})},_setTreeItem:function(t,n){var r=this,i=this.options;if(!n)return;t=r.getNodeDom(t);var s=e(t),o=parseInt(s.attr("outlinelevel"));n.isLast!=undefined&&(n.isLast==1?(s.removeClass("l-last").addClass("l-last"),e("> div .l-note",s).removeClass("l-note").addClass("l-note-last"),e(".l-children li",s).find(".l-box:eq("+(o-1)+")").removeClass("l-line")):n.isLast==0&&(s.removeClass("l-last"),e("> div .l-note-last",s).removeClass("l-note-last").addClass("l-note"),e(".l-children li",s).find(".l-box:eq("+(o-1)+")").removeClass("l-line").addClass("l-line")))},_upadteTreeWidth:function(){var e=this,t=this.options,n=e.maxOutlineLevel*22;t.checkbox&&(n+=22);if(t.parentIcon||t.childIcon)n+=22;n+=t.nodeWidth,e.tree.width(n)},_getChildNodeClassName:function(){var e=this,t=this.options;return"l-tree-icon-"+t.childIcon},_getParentNodeClassName:function(e){var t=this,n=this.options,r="l-tree-icon-"+n.parentIcon;return e&&(r+="-open"),r},_getTreeHTMLByData:function(t,n,r,i){var s=this,o=this.options;s.maxOutlineLevel<n&&(s.maxOutlineLevel=n),r=r||[],n=n||1;var u=[];i?u.push("<ul class='l-children'>"):u.push('<ul class="l-children" style="display:none">');for(var a=0;a<t.length;a++){var f=a==0,l=a==t.length-1,c=!0,h=t[a];if(h.isexpand==0||h.isexpand=="false")c=!1;u.push("<li "),h.treedataindex!=undefined&&u.push('treedataindex="'+h.treedataindex+'" '),c&&u.push("isexpand="+h.isexpand+" "),u.push("outlinelevel="+n+" ");for(var p=0;p<s.sysAttribute.length;p++)e(this).attr(s.sysAttribute[p])&&(t[dataindex][s.sysAttribute[p]]=e(this).attr(s.sysAttribute[p]));for(var p=0;p<o.attribute.length;p++)h[o.attribute[p]]&&u.push(o.attribute[p]+'="'+h[o.attribute[p]]+'" ');u.push('class="'),f&&u.push("l-first "),l&&u.push("l-last "),f&&l&&u.push("l-onlychild "),u.push('"'),u.push(">"),u.push('<div class="l-body">');for(var d=0;d<=n-2;d++)r[d]?u.push('<div class="l-box"></div>'):u.push('<div class="l-box l-line"></div>');s.hasChildren(h)?(c?u.push('<div class="l-box l-expandable-open"></div>'):u.push('<div class="l-box l-expandable-close"></div>'),o.checkbox&&(h.ischecked?u.push('<div class="l-box l-checkbox l-checkbox-checked"></div>'):u.push('<div class="l-box l-checkbox l-checkbox-unchecked"></div>')),o.parentIcon&&(u.push('<div class="l-box l-tree-icon '),u.push(s._getParentNodeClassName(o.parentIcon?!0:!1)+" "),o.iconFieldName&&h[o.iconFieldName]&&u.push("l-tree-icon-none"),u.push('">'),o.iconFieldName&&h[o.iconFieldName]&&u.push('<img src="'+h[o.iconFieldName]+'" />'),u.push("</div>"))):(l?u.push('<div class="l-box l-note-last"></div>'):u.push('<div class="l-box l-note"></div>'),o.checkbox&&(h.ischecked?u.push('<div class="l-box l-checkbox l-checkbox-checked"></div>'):u.push('<div class="l-box l-checkbox l-checkbox-unchecked"></div>')),o.childIcon&&(u.push('<div class="l-box l-tree-icon '),u.push(s._getChildNodeClassName()+" "),o.iconFieldName&&h[o.iconFieldName]&&u.push("l-tree-icon-none"),u.push('">'),o.iconFieldName&&h[o.iconFieldName]&&u.push('<img src="'+h[o.iconFieldName]+'" />'),u.push("</div>"))),u.push("<span>"+h[o.textFieldName]+"</span></div>");if(s.hasChildren(h)){var v=[];for(var d=0;d<r.length;d++)v.push(r[d]);v.push(l),u.push(s._getTreeHTMLByData(h.children,n+1,v,c).join(""))}u.push("</li>")}return u.push("</ul>"),u},_getDataByTreeHTML:function(t){var n=this,r=this.options,i=[];return e("> li",t).each(function(t,s){var o=i.length;i[o]={treedataindex:n.treedataindex++},i[o][r.textFieldName]=e("> span,> a",this).html();for(var u=0;u<n.sysAttribute.length;u++)e(this).attr(n.sysAttribute[u])&&(i[o][n.sysAttribute[u]]=e(this).attr(n.sysAttribute[u]));for(var u=0;u<r.attribute.length;u++)e(this).attr(r.attribute[u])&&(i[o][r.attribute[u]]=e(this).attr(r.attribute[u]));e("> ul",this).length>0&&(i[o].children=n._getDataByTreeHTML(e("> ul",this)))}),i},_applyTree:function(){var t=this,n=this.options;t.data=t._getDataByTreeHTML(t.tree);var r=t._getTreeHTMLByData(t.data,1,[],!0);r[r.length-1]=r[0]="",t.tree.html(r.join("")),t._upadteTreeWidth(),e(".l-body",t.tree).hover(function(){e(this).addClass("l-over")},function(){e(this).removeClass("l-over")})},_applyTreeEven:function(t){var n=this,r=this.options;e("> .l-body",t).hover(function(){e(this).addClass("l-over")},function(){e(this).removeClass("l-over")})},_getSrcElementByEvent:function(t){var n=this,r=t.target||t.srcElement,i=r.tagName.toLowerCase(),s=e(r).parents().add(r),o=function(t){for(var n=s.length-1;n>=0;n--)if(e(s[n]).hasClass(t))return s[n];return null};if(s.index(this.element)==-1)return{out:!0};var u={tree:o("l-tree"),node:o("l-body"),checkbox:o("l-checkbox"),icon:o("l-tree-icon"),text:i=="span"};if(u.node){var a=parseInt(e(u.node).parent().attr("treedataindex"));u.data=n._getDataNodeByTreeDataIndex(n.data,a)}return u},_setTreeEven:function(){var t=this,n=this.options;t.hasBind("contextmenu")&&t.tree.bind("contextmenu",function(n){var r=n.target||n.srcElement,i=null;r.tagName.toLowerCase()=="a"||r.tagName.toLowerCase()=="span"||e(r).hasClass("l-box")?i=e(r).parent().parent():e(r).hasClass("l-body")?i=e(r).parent():r.tagName.toLowerCase()=="li"&&(i=e(r));if(!i)return;var s=parseInt(i.attr("treedataindex")),o=t._getDataNodeByTreeDataIndex(t.data,s);return t.trigger("contextmenu",[{data:o,target:i[0]},n])}),t.tree.click(function(r){var i=r.target||r.srcElement,s=null;i.tagName.toLowerCase()=="a"||i.tagName.toLowerCase()=="span"||e(i).hasClass("l-box")?s=e(i).parent().parent():e(i).hasClass("l-body")?s=e(i).parent():s=e(i);if(!s)return;var o=parseInt(s.attr("treedataindex")),u=t._getDataNodeByTreeDataIndex(t.data,o),a=e("div.l-body:first",s).find("div.l-expandable-open:first,div.l-expandable-close:first"),f=e(i).hasClass("l-expandable-open")||e(i).hasClass("l-expandable-close");if(!e(i).hasClass("l-checkbox")&&!f)if(e(">div:first",s).hasClass("l-selected")){if(t.trigger("beforeCancelSelect",[{data:u,target:s[0]}])==0)return!1;e(">div:first",s).removeClass("l-selected"),t.trigger("cancelSelect",[{data:u,target:s[0]}])}else{if(t.trigger("beforeSelect",[{data:u,target:s[0]}])==0)return!1;e(".l-body",t.tree).removeClass("l-selected"),e(">div:first",s).addClass("l-selected"),t.trigger("select",[{data:u,target:s[0]}])}if(e(i).hasClass("l-checkbox"))n.autoCheckboxEven?(e(i).hasClass("l-checkbox-unchecked")?(e(i).removeClass("l-checkbox-unchecked").addClass("l-checkbox-checked"),e(".l-children .l-checkbox",s).removeClass("l-checkbox-incomplete l-checkbox-unchecked").addClass("l-checkbox-checked"),t.trigger("check",[{data:u,target:s[0]},!0])):e(i).hasClass("l-checkbox-checked")?(e(i).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked"),e(".l-children .l-checkbox",s).removeClass("l-checkbox-incomplete l-checkbox-checked").addClass("l-checkbox-unchecked"),t.trigger("check",[{data:u,target:s[0]},!1])):e(i).hasClass("l-checkbox-incomplete")&&(e(i).removeClass("l-checkbox-incomplete").addClass("l-checkbox-checked"),e(".l-children .l-checkbox",s).removeClass("l-checkbox-incomplete l-checkbox-unchecked").addClass("l-checkbox-checked"),t.trigger("check",[{data:u,target:s[0]},!0])),t._setParentCheckboxStatus(s)):e(i).hasClass("l-checkbox-unchecked")?(e(i).removeClass("l-checkbox-unchecked").addClass("l-checkbox-checked"),n.single&&e(".l-checkbox",t.tree).not(i).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked"),t.trigger("check",[{data:u,target:s[0]},!0])):e(i).hasClass("l-checkbox-checked")&&(e(i).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked"),t.trigger("check",[{data:u,target:s[0]},!1]));else if(a.hasClass("l-expandable-open")&&(!n.btnClickToToggleOnly||f)){if(t.trigger("beforeCollapse",[{data:u,target:s[0]}])==0)return!1;a.removeClass("l-expandable-open").addClass("l-expandable-close"),n.slide?e("> .l-children",s).slideToggle("fast"):e("> .l-children",s).toggle(),e("> div ."+t._getParentNodeClassName(!0),s).removeClass(t._getParentNodeClassName(!0)).addClass(t._getParentNodeClassName()),t.trigger("collapse",[{data:u,target:s[0]}])}else if(a.hasClass("l-expandable-close")&&(!n.btnClickToToggleOnly||f)){if(t.trigger("beforeExpand",[{data:u,target:s[0]}])==0)return!1;a.removeClass("l-expandable-close").addClass("l-expandable-open");var l=function(){t.trigger("expand",[{data:u,target:s[0]}])};n.slide?e("> .l-children",s).slideToggle("fast",l):(e("> .l-children",s).toggle(),l()),e("> div ."+t._getParentNodeClassName(),s).removeClass(t._getParentNodeClassName()).addClass(t._getParentNodeClassName(!0))}t.trigger("click",[{data:u,target:s[0]}])}),e.fn.ligerDrag&&n.nodeDraggable&&(t.nodeDroptip=e("<div class='l-drag-nodedroptip' style='display:none'></div>").appendTo("body"),t.tree.ligerDrag({revert:!0,animate:!1,proxyX:20,proxyY:20,proxy:function(r,i){var s=t._getSrcElementByEvent(i);if(s.node){var o="dragging";if(n.nodeDraggingRender)o=n.nodeDraggingRender(r.draggingNodes,r,t);else{o="";var u=!1;for(var a in r.draggingNodes){var f=r.draggingNodes[a];u&&(o+=","),o+=f.text,u=!0}}var l=e("<div class='l-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div>"+o+"</div>").appendTo("body");return l}},onRevert:function(){return!1},onRendered:function(){this.set("cursor","default"),t.children[this.id]=this},onStartDrag:function(e,r){if(r.button==2)return!1;this.set("cursor","default");var i=t._getSrcElementByEvent(r);if(i.checkbox)return!1;if(n.checkbox){var s=t.getChecked();this.draggingNodes=[];for(var o in s)this.draggingNodes.push(s[o].data);if(!this.draggingNodes||!this.draggingNodes.length)return!1}else this.draggingNodes=[i.data];this.draggingNode=i.data,this.set("cursor","move"),t.nodedragging=!0,this.validRange={top:t.tree.offset().top,bottom:t.tree.offset().top+t.tree.height(),left:t.tree.offset().left,right:t.tree.offset().left+t.tree.width()}},onDrag:function(n,r){var i=this.draggingNode;if(!i)return!1;var s=this.draggingNodes?this.draggingNodes:[i];t.nodeDropIn==null&&(t.nodeDropIn=-1);var o=r.pageX,u=r.pageY,a=!1,f=this.validRange;if(o<f.left||o>f.right||u>f.bottom||u<f.top){t.nodeDropIn=-1,t.nodeDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes l-drop-add").addClass("l-drop-no");return}for(var l=0,c=t.nodes.length;l<c;l++){var h=t.nodes[l],p=h.treedataindex;i["treedataindex"]==p&&(a=!0);if(e.inArray(h,s)!=-1)continue;var d=a?!0:!1;if(t.nodeDropIn!=-1&&t.nodeDropIn!=p)continue;var v=e("li[treedataindex="+p+"] div:first",t.tree),m=v.offset(),y={top:m.top,bottom:m.top+v.height(),left:t.tree.offset().left,right:t.tree.offset().left+t.tree.width()};if(o>y.left&&o<y.right&&u>y.top&&u<y.bottom){var b=m.top;d&&(b+=v.height()),t.nodeDroptip.css({left:y.left,top:b,width:y.right-y.left}).show(),t.nodeDropIn=p,t.nodeDropDir=d?"bottom":"top",u>y.top+7&&u<y.bottom-7?(this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-yes").addClass("l-drop-add"),t.nodeDroptip.hide(),t.nodeDropInParent=!0):(this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-add").addClass("l-drop-yes"),t.nodeDroptip.show(),t.nodeDropInParent=!1);break}t.nodeDropIn!=-1&&(t.nodeDropIn=-1,t.nodeDropInParent=!1,t.nodeDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes  l-drop-add").addClass("l-drop-no"))}},onStopDrag:function(n,r){var i=this.draggingNodes;t.nodedragging=!1;if(t.nodeDropIn!=-1){for(var s=0;s<i.length;s++){var o=i[s].children;o&&(i=e.grep(i,function(t,n){var r=e.inArray(t,o)==-1;return r}))}for(var s in i){var u=i[s];t.nodeDropInParent?(t.remove(u),t.append(t.nodeDropIn,[u])):(t.remove(u),t.append(t.getParent(t.nodeDropIn),[u],t.nodeDropIn,t.nodeDropDir=="bottom"))}t.nodeDropIn=-1}t.nodeDroptip.hide(),this.set("cursor","default")}}))},_setParentCheckboxStatus:function(t){var n=this,r=this.options,i=e(".l-checkbox-unchecked",t.parent()).length==0,s=e(".l-checkbox-checked",t.parent()).length==0;i?t.parent().prev().find(".l-checkbox").removeClass("l-checkbox-unchecked l-checkbox-incomplete").addClass("l-checkbox-checked"):s?t.parent().prev().find("> .l-checkbox").removeClass("l-checkbox-checked l-checkbox-incomplete").addClass("l-checkbox-unchecked"):t.parent().prev().find("> .l-checkbox").removeClass("l-checkbox-unchecked l-checkbox-checked").addClass("l-checkbox-incomplete"),t.parent().parent("li").length>0&&n._setParentCheckboxStatus(t.parent().parent("li"))}})})(jQuery)