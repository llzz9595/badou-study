(function($){var l=$.ligerui;$.fn.ligerGrid=function(e){return $.ligerui.run.call(this,"ligerGrid",arguments)},$.fn.ligerGetGridManager=function(){return $.ligerui.run.call(this,"ligerGetGridManager",arguments)},$.ligerDefaults.Grid={title:null,width:"auto",height:"auto",columnWidth:null,resizable:!0,url:!1,usePager:!0,page:1,pageSize:10,pageSizeOptions:[10,20,30,40,50],parms:[],columns:[],minColToggle:1,dataType:"server",dataAction:"server",showTableToggleBtn:!1,switchPageSizeApplyComboBox:!1,allowAdjustColWidth:!0,checkbox:!1,allowHideColumn:!0,enabledEdit:!1,isScroll:!0,onDragCol:null,onToggleCol:null,onChangeSort:null,onSuccess:null,onDblClickRow:null,onSelectRow:null,onUnSelectRow:null,onBeforeCheckRow:null,onCheckRow:null,onBeforeCheckAllRow:null,onCheckAllRow:null,onBeforeShowData:null,onAfterShowData:null,onError:null,onSubmit:null,dateFormat:"yyyy-MM-dd",InWindow:!0,statusName:"__status",method:"post",async:!0,fixedCellHeight:!0,heightDiff:0,cssClass:null,root:"Rows",record:"Total",pageParmName:"page",pagesizeParmName:"pagesize",sortnameParmName:"sortname",sortorderParmName:"sortorder",onReload:null,onToFirst:null,onToPrev:null,onToNext:null,onToLast:null,allowUnSelectRow:!1,alternatingRow:!0,mouseoverRowCssClass:"l-grid-row-over",enabledSort:!0,rowAttrRender:null,groupColumnName:null,groupColumnDisplay:"分组",groupRender:null,totalRender:null,delayLoad:!1,where:null,selectRowButtonOnly:!1,onAfterAddRow:null,onBeforeEdit:null,onBeforeSubmitEdit:null,onAfterEdit:null,onLoading:null,onLoaded:null,onContextmenu:null,whenRClickToSelect:!1,contentType:null,checkboxColWidth:27,detailColWidth:29,clickToEdit:!0,detailToEdit:!1,onEndEdit:null,minColumnWidth:80,tree:null,isChecked:null,frozen:!0,frozenDetail:!1,frozenCheckbox:!0,detailHeight:260,rownumbers:!1,frozenRownumbers:!0,rownumbersColWidth:26,colDraggable:!1,rowDraggable:!1,rowDraggingRender:null,autoCheckChildren:!0,onRowDragDrop:null,rowHeight:22,headerRowHeight:23,toolbar:null,headerImg:null},$.ligerDefaults.GridString={errorMessage:"发生错误",pageStatMessage:"显示从{from}到{to}, 总 {total} 条. 每页显示 {pagesize} 条",pageTextMessage:"Page",loadingMessage:"加载中...",findTextMessage:"查找",noRecordMessage:"没有符合条件的记录存在",isContinueByDataChanged:"数据已经改变,如果继续将丢失数据,是否继续?",cancelMessage:"取消",saveMessage:"保存",applyMessage:"应用",draggingMessage:"{count}行"},$.ligerMethos.Grid=$.ligerMethos.Grid||{},$.ligerDefaults.Grid.sorters=$.ligerDefaults.Grid.sorters||{},$.ligerDefaults.Grid.formatters=$.ligerDefaults.Grid.formatters||{},$.ligerDefaults.Grid.editors=$.ligerDefaults.Grid.editors||{},$.ligerDefaults.Grid.sorters.date=function(e,t){return e<t?-1:e>t?1:0},$.ligerDefaults.Grid.sorters["int"]=function(e,t){return parseInt(e)<parseInt(t)?-1:parseInt(e)>parseInt(t)?1:0},$.ligerDefaults.Grid.sorters["float"]=function(e,t){return parseFloat(e)<parseFloat(t)?-1:parseFloat(e)>parseFloat(t)?1:0},$.ligerDefaults.Grid.sorters.string=function(e,t){return e.localeCompare(t)},$.ligerDefaults.Grid.formatters.date=function(value,column){function getFormatDate(e,t){var n=this,r=this.options;if(isNaN(e))return null;var i=t,s={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(i)&&(i=i.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in s)(new RegExp("("+o+")")).test(i)&&(i=i.replace(RegExp.$1,RegExp.$1.length==1?s[o]:("00"+s[o]).substr((""+s[o]).length)));return i}if(!value)return"";typeof value=="string"&&/^\/Date/.test(value)?(value=value.replace(/^\//,"new ").replace(/\/$/,""),eval("value = "+value)):typeof value=="number"&&(value=new Date(value));if(value instanceof Date){var format=column.format||this.options.dateFormat||"yyyy-MM-dd";return getFormatDate(value,format)}return value.toString()},$.ligerDefaults.Grid.editors.date={create:function(e,t){var n=t.column,r=$("<input type='text'/>");e.append(r);var i={},s=n.editor.p||n.editor.ext;if(s){var o=typeof s=="function"?s(t.record,t.rowindex,t.value,n):s;$.extend(i,o)}return r.ligerDateEditor(i),r},getValue:function(e,t){return e.liger("option","value")},setValue:function(e,t,n){e.liger("option","value",t)},resize:function(e,t,n,r){e.liger("option","width",t),e.liger("option","height",n)},destroy:function(e,t){e.liger("destroy")}},$.ligerDefaults.Grid.editors.select=$.ligerDefaults.Grid.editors.combobox={create:function(e,t){var n=t.column,r=$("<input type='text'/>");e.append(r);var i={data:n.editor.data,slide:!1,valueField:n.editor.valueField||n.editor.valueColumnName,textField:n.editor.textField||n.editor.displayColumnName},s=n.editor.p||n.editor.ext;if(s){var o=typeof s=="function"?s(t.record,t.rowindex,t.value,n):s;$.extend(i,o)}return r.ligerComboBox(i),r},getValue:function(e,t){return e.liger("option","value")},setValue:function(e,t,n){e.liger("option","value",t)},resize:function(e,t,n,r){e.liger("option","width",t),e.liger("option","height",n)},destroy:function(e,t){e.liger("destroy")}},$.ligerDefaults.Grid.editors["int"]=$.ligerDefaults.Grid.editors["float"]=$.ligerDefaults.Grid.editors.spinner={create:function(e,t){var n=t.column,r=$("<input type='text'/>");e.append(r),r.css({border:"#6E90BE"});var i={type:n.editor.type=="float"?"float":"int"};return n.editor.minValue!=undefined&&(i.minValue=n.editor.minValue),n.editor.maxValue!=undefined&&(i.maxValue=n.editor.maxValue),r.ligerSpinner(i),r},getValue:function(e,t){var n=t.column,r=n.editor.type=="int";return r?parseInt(e.val(),10):parseFloat(e.val())},setValue:function(e,t,n){e.val(t)},resize:function(e,t,n,r){e.liger("option","width",t),e.liger("option","height",n)},destroy:function(e,t){e.liger("destroy")}},$.ligerDefaults.Grid.editors.string=$.ligerDefaults.Grid.editors.text={create:function(e,t){var n=$("<input type='text' class='l-text-editing'/>");return e.append(n),n.ligerTextBox(),n},getValue:function(e,t){return e.val()},setValue:function(e,t,n){e.val(t)},resize:function(e,t,n,r){e.liger("option","width",t),e.liger("option","height",n)},destroy:function(e,t){e.liger("destroy")}},$.ligerDefaults.Grid.editors.chk=$.ligerDefaults.Grid.editors.checkbox={create:function(e,t){var n=$("<input type='checkbox' />");return e.append(n),n.ligerCheckBox(),n},getValue:function(e,t){return e[0].checked?1:0},setValue:function(e,t,n){e.val(t?!0:!1)},resize:function(e,t,n,r){e.liger("option","width",t),e.liger("option","height",n)},destroy:function(e,t){e.liger("destroy")}},$.ligerui.controls.Grid=function(e,t){$.ligerui.controls.Grid.base.constructor.call(this,e,t)},$.ligerui.controls.Grid.ligerExtend($.ligerui.core.UIComponent,{__getType:function(){return"$.ligerui.controls.Grid"},__idPrev:function(){return"grid"},_extendMethods:function(){return $.ligerMethos.Grid},_init:function(){$.ligerui.controls.Grid.base._init.call(this);var e=this,t=this.options;t.dataType=t.url?"server":"local",t.dataType=="local"&&(t.data=t.data||[],t.dataAction="local"),t.isScroll==0&&(t.height="auto"),t.frozen||(t.frozenCheckbox=!1,t.frozenDetail=!1,t.frozenRownumbers=!1),t.detailToEdit&&(t.enabledEdit=!0,t.clickToEdit=!1,t.detail={height:"auto",onShowDetail:function(n,r,i){function s(){$(r).parent().parent().remove(),e.collapseDetail(n)}$(r).addClass("l-grid-detailpanel-edit"),e.beginEdit(n,function(e,n){var i=$("<div class='l-editbox'></div>");return i.width(120).height(t.rowHeight+1),i.appendTo(r),i}),$("<div class='l-clear'></div>").appendTo(r),$("<div class='l-button'>"+t.saveMessage+"</div>").appendTo(r).click(function(){e.endEdit(n),s()}),$("<div class='l-button'>"+t.applyMessage+"</div>").appendTo(r).click(function(){e.submitEdit(n)}),$("<div class='l-button'>"+t.cancelMessage+"</div>").appendTo(r).click(function(){e.cancelEdit(n),s()})}}),t.tree&&(t.tree.childrenName=t.tree.childrenName||"children",t.tree.isParent=t.tree.isParent||function(e){var n=t.tree.childrenName in e;return n},t.tree.isExtend=t.tree.isExtend||function(e){return"isextend"in e&&e["isextend"]==0?!1:!0})},_render:function(){var e=this,t=this.options;e.grid=$(e.element),e.grid.addClass("l-panel");var n=[];n.push("        <div class='l-panel-header'><span class='l-panel-header-text'></span></div>"),n.push("                    <div class='l-grid-loading'></div>"),n.push("        <div class='l-panel-topbar'></div>"),n.push("        <div class='l-panel-bwarp'>"),n.push("            <div class='l-panel-body'>"),n.push("                <div class='l-grid'>"),n.push("                    <div class='l-grid-dragging-line'></div>"),n.push("                    <div class='l-grid-popup'><table cellpadding='0' cellspacing='0'><tbody></tbody></table></div>"),n.push("                  <div class='l-grid1'>"),n.push("                      <div class='l-grid-header l-grid-header1'>"),n.push("                          <div class='l-grid-header-inner'><table class='l-grid-header-table' cellpadding='0' cellspacing='0'><tbody></tbody></table></div>"),n.push("                      </div>"),n.push("                      <div class='l-grid-body l-grid-body1'>"),n.push("                      </div>"),n.push("                  </div>"),n.push("                  <div class='l-grid2'>"),n.push("                      <div class='l-grid-header l-grid-header2'>"),n.push("                          <div class='l-grid-header-inner'><table class='l-grid-header-table' cellpadding='0' cellspacing='0'><tbody></tbody></table></div>"),n.push("                      </div>"),n.push("                      <div class='l-grid-body l-grid-body2 l-scroll'>"),n.push("                      </div>"),n.push("                  </div>"),n.push("                 </div>"),n.push("              </div>"),n.push("         </div>"),n.push("         <div class='l-panel-bar'>"),n.push("            <div class='l-panel-bbar-inner'>"),n.push("                <div class='l-bar-group  l-bar-message'><span class='l-bar-text'></span></div>"),n.push("            <div class='l-bar-group l-bar-selectpagesize'></div>"),n.push("                <div class='l-bar-separator'></div>"),n.push("                <div class='l-bar-group'>"),n.push("                    <div class='l-bar-button l-bar-btnfirst'><span></span></div>"),n.push("                    <div class='l-bar-button l-bar-btnprev'><span></span></div>"),n.push("                </div>"),n.push("                <div class='l-bar-separator'></div>"),n.push("                <div class='l-bar-group'><span class='pcontrol'> <input type='text' size='4' value='1' style='width:20px' maxlength='3' /> / <span></span></span></div>"),n.push("                <div class='l-bar-separator'></div>"),n.push("                <div class='l-bar-group'>"),n.push("                     <div class='l-bar-button l-bar-btnnext'><span></span></div>"),n.push("                    <div class='l-bar-button l-bar-btnlast'><span></span></div>"),n.push("                </div>"),n.push("                <div class='l-bar-separator'></div>"),n.push("                <div class='l-bar-group'>"),n.push("                     <div class='l-bar-button l-bar-btnload'><span></span></div>"),n.push("                </div>"),n.push("                <div class='l-bar-separator'></div>"),n.push("                <div class='l-clear'></div>"),n.push("            </div>"),n.push("         </div>"),e.grid.html(n.join("")),e.header=$(".l-panel-header:first",e.grid),e.body=$(".l-panel-body:first",e.grid),e.toolbar=$(".l-panel-bar:first",e.grid),e.popup=$(".l-grid-popup:first",e.grid),e.gridloading=$(".l-grid-loading:first",e.grid),e.draggingline=$(".l-grid-dragging-line",e.grid),e.topbar=$(".l-panel-topbar:first",e.grid),e.gridview=$(".l-grid:first",e.grid),e.gridview.attr("id",e.id+"grid"),e.gridview1=$(".l-grid1:first",e.gridview),e.gridview2=$(".l-grid2:first",e.gridview),e.gridheader=$(".l-grid-header:first",e.gridview2),e.gridbody=$(".l-grid-body:first",e.gridview2),e.f={},e.f.gridheader=$(".l-grid-header:first",e.gridview1),e.f.gridbody=$(".l-grid-body:first",e.gridview1),e.currentData=null,e.changedCells={},e.editors={},e.editor={editing:!1},t.height=="auto"&&e.bind("SysGridHeightChanged",function(){e.enabledFrozen()&&e.gridview.height(Math.max(e.gridview1.height(),e.gridview2.height()))});var r=$.extend({},t);this._bulid(),this._setColumns(t.columns),delete r.columns,delete r.data,delete r.url,e.set(r),t.delayLoad||(t.url?e.set({url:t.url}):t.data&&e.set({data:t.data}))},_setFrozen:function(e){e?this.grid.addClass("l-frozen"):this.grid.removeClass("l-frozen")},_setCssClass:function(e){this.grid.addClass(e)},_setLoadingMessage:function(e){this.gridloading.html(e)},_setHeight:function(e){var t=this,n=this.options;t.unbind("SysGridHeightChanged");if(e=="auto"){t.bind("SysGridHeightChanged",function(){t.enabledFrozen()&&t.gridview.height(Math.max(t.gridview1.height(),t.gridview2.height()))});return}typeof e=="string"&&e.indexOf("%")>0&&(n.inWindow?e=$(window).height()*parseFloat(e)*.01:e=t.grid.parent().height()*parseFloat(e)*.01),n.title&&(e-=24),n.usePager&&(e-=32),n.totalRender&&(e-=25),n.toolbar&&(e-=t.topbar.outerHeight());var r=n.headerRowHeight*(t._columnMaxLevel-1)+n.headerRowHeight-1;e-=r,e>0&&(t.gridbody.height(e),e>18&&t.f.gridbody.height(e-18),t.gridview.height(e+r))},_updateFrozenWidth:function(){var e=this,t=this.options;if(e.enabledFrozen()){e.gridview1.width(e.f.gridtablewidth);var n=e.gridview.width()-e.f.gridtablewidth;e.gridview2.css({left:e.f.gridtablewidth}),n>0&&e.gridview2.css({width:n})}},_setWidth:function(e){var t=this,n=this.options;t.enabledFrozen()&&t._onResize()},_setUrl:function(e){this.options.url=e,e?(this.options.dataType="server",this.loadData(!0)):this.options.dataType="local"},_setData:function(e){this.loadData(this.options.data)},loadData:function(e){var t=this,n=this.options;t.loading=!0;var r=null,i=!0;typeof e=="function"?(r=e,i=!1):typeof e=="boolean"?i=e:typeof e=="object"&&e&&(i=!1,n.dataType="local",n.data=e),n.newPage||(n.newPage=1),n.dataAction=="server"&&(n.sortOrder||(n.sortOrder="asc"));var s=[];if(n.parms)if(n.parms.length)$(n.parms).each(function(){s.push({name:this.name,value:this.value})});else if(typeof n.parms=="object")for(var o in n.parms)s.push({name:o,value:n.parms[o]});n.dataAction=="server"&&(n.usePager&&(s.push({name:n.pageParmName,value:n.newPage}),s.push({name:n.pagesizeParmName,value:n.pageSize})),n.sortName&&(s.push({name:n.sortnameParmName,value:n.sortName}),s.push({name:n.sortorderParmName,value:n.sortOrder}))),$(".l-bar-btnload span",t.toolbar).addClass("l-disabled"),n.dataType=="local"?(t.filteredData=t.data=n.data,r&&(t.filteredData[n.root]=t._searchData(t.filteredData[n.root],r)),n.usePager?t.currentData=t._getCurrentPageData(t.filteredData):t.currentData=t.filteredData,t._showData()):n.dataAction=="local"&&!i?t.data&&t.data[n.root]&&(t.filteredData=t.data,r&&(t.filteredData[n.root]=t._searchData(t.filteredData[n.root],r)),t.currentData=t._getCurrentPageData(t.filteredData),t._showData()):t.loadServerData(s,r),t.loading=!1},loadServerData:function(e,t){var n=this,r=this.options,i={type:r.method,url:r.url,data:e,async:r.async,dataType:"json",beforeSend:function(){n.hasBind("loading")?n.trigger("loading"):n.toggleLoading(!0)},success:function(e){n.trigger("success",[e,n]);if(!e||!e[r.root]||!e[r.root].length){n.currentData=n.data={},n.currentData[r.root]=n.data[r.root]=[],n.currentData[r.record]=n.data[r.record]=0,n._showData();return}n.data=e,r.dataAction=="server"?n.currentData=n.data:(n.filteredData=n.data,t&&(n.filteredData[r.root]=n._searchData(n.filteredData[r.root],t)),r.usePager?n.currentData=n._getCurrentPageData(n.filteredData):n.currentData=n.filteredData),n._showData.ligerDefer(n,10,[n.currentData])},complete:function(){n.trigger("complete",[n]),n.hasBind("loaded")?n.trigger("loaded",[n]):n.toggleLoading.ligerDefer(n,10,[!1])},error:function(e,t,i){n.currentData=n.data={},n.currentData[r.root]=n.data[r.root]=[],n.currentData[r.record]=n.data[r.record]=0,n.toggleLoading.ligerDefer(n,10,[!1]),$(".l-bar-btnload span",n.toolbar).removeClass("l-disabled"),n.trigger("error",[e,t,i])}};r.contentType&&(i.contentType=r.contentType),$.ajax(i)},toggleLoading:function(e){this.gridloading[e?"show":"hide"]()},_createEditor:function(e,t,n,r,i){var s=e.create(t,n);return e.setValue&&e.setValue(s,n.value,n),e.resize&&e.resize(s,r,i,n),s},beginEdit:function(e,t){var n=this,r=this.options;if(!r.enabledEdit||r.clickToEdit)return;var i=n.getRow(e);if(i._editing)return;if(n.trigger("beginEdit",{record:i,rowindex:i["__index"]})==0)return;n.editors[i.__id]={},i._editing=!0,n.reRender({rowdata:i}),t=t||function(e,t){var r=n.getCellObj(e,t),i=$(r).html("");return n.setCellEditing(e,t,!0),i};for(var s=0,o=n.columns.length;s<o;s++){var u=n.columns[s];if(!u.name||!u.editor||!u.editor.type||!r.editors[u.editor.type])continue;var a=r.editors[u.editor.type],f={record:i,value:i[u.name],column:u,rowindex:i.__index,grid:n},l=t(i,u),c=l.width(),h=l.height(),p=n._createEditor(a,l,f,c,h);n.editors[i.__id][u.__id]={editor:a,input:p,editParm:f,container:l}}n.trigger("afterBeginEdit",{record:i,rowindex:i.__index})},cancelEdit:function(e){var t=this;if(e==undefined)for(var n in t.editors)t.cancelEdit(n);else{var r=t.getRow(e);if(!t.editors[r.__id])return;if(t.trigger("cancelEdit",{record:r,rowindex:r["__index"]})==0)return;for(var i in t.editors[r.__id]){var s=t.editors[r.__id][i];s.editor.destroy&&s.editor.destroy(s.input,s.editParm)}delete t.editors[r.__id],delete r._editing,t.reRender({rowdata:r})}},addEditRow:function(e){this.submitEdit(),e=this.add(e),this.beginEdit(e)},submitEdit:function(e){var t=this,n=this.options;if(e==undefined)for(var r in t.editors)t.submitEdit(r);else{var i=t.getRow(e),s={};if(!t.editors[i.__id])return;for(var o in t.editors[i.__id]){var u=t.editors[i.__id][o],a=u.editParm.column;a.name&&(s[a.name]=u.editor.getValue(u.input,u.editParm))}if(t.trigger("beforeSubmitEdit",{record:i,rowindex:i["__index"],newdata:s})==0)return!1;t.updateRow(i,s),t.trigger("afterSubmitEdit",{record:i,rowindex:i.__index,newdata:s})}},endEdit:function(e){var t=this,n=this.options;if(t.editor.editing){var r=t.editor;t.trigger("sysEndEdit",[t.editor.editParm]),t.trigger("endEdit",[t.editor.editParm]),r.editor.destroy&&r.editor.destroy(r.input,r.editParm),t.editor.container.remove(),t.reRender({rowdata:t.editor.editParm.record,column:t.editor.editParm.column}),t.trigger("afterEdit",[t.editor.editParm]),t.editor={editing:!1}}else if(e!=undefined){var i=t.getRow(e);if(!t.editors[i.__id])return;if(t.submitEdit(e)==0)return!1;for(var s in t.editors[i.__id]){var r=t.editors[i.__id][s];r.editor.destroy&&r.editor.destroy(r.input,r.editParm)}delete t.editors[i.__id],delete i._editing,t.trigger("afterEdit",{record:i,rowindex:i.__index})}else for(var o in t.editors)t.endEdit(o)},setWidth:function(e){return this._setWidth(e)},setHeight:function(e){return this._setHeight(e)},enabledCheckbox:function(){return this.options.checkbox?!0:!1},enabledFrozen:function(){var e=this,t=this.options;if(!t.frozen)return!1;var n=e.columns||[];if(e.enabledDetail()&&t.frozenDetail||e.enabledCheckbox()&&t.frozenCheckbox||t.frozenRownumbers&&t.rownumbers)return!0;for(var r=0,i=n.length;r<i;r++)if(n[r].frozen)return!0;return this._setFrozen(!1),!1},enabledDetailEdit:function(){return this.enabledDetail()?this.options.detailToEdit?!0:!1:!1},enabledDetail:function(){return this.options.detail&&this.options.detail.onShowDetail?!0:!1},enabledGroup:function(){return this.options.groupColumnName?!0:!1},deleteSelectedRow:function(){if(!this.selected)return;for(var e in this.selected){var t=this.selected[e];t.__id in this.records&&this._deleteData.ligerDefer(this,10,[t])}this.reRender.ligerDefer(this,20)},removeRange:function(e){var t=this,n=this.options;$.each(e,function(){t._removeData(this)}),t.reRender()},remove:function(e){var t=this,n=this.options,r=t.getRow(e);t._removeData(e),t.reRender()},deleteRange:function(e){var t=this,n=this.options;$.each(e,function(){t._deleteData(this)}),t.reRender()},deleteRow:function(e){var t=this,n=this.options,r=t.getRow(e);if(!r)return;t._deleteData(r),t.reRender(),t.isDataChanged=!0},_deleteData:function(e){var t=this,n=this.options,r=t.getRow(e);r[n.statusName]="delete";if(n.tree){var i=t.getChildren(r,!0);if(i)for(var s=0,o=i.length;s<o;s++)i[s][n.statusName]="delete"}t.deletedRows=t.deletedRows||[],t.deletedRows.push(r),t._removeSelected(r)},updateCell:function(e,t,n){var r=this,i=this.options,s,o,u;if(typeof e=="string"){for(var a=0,f=r.columns.length;a<f;a++)r.columns[a].name==e&&r.updateCell(a,t,n);return}if(typeof e=="number")s=r.columns[e],u=r.getRow(n),o=r.getCellObj(u,s);else if(typeof e=="object"&&e.__id)s=e,u=r.getRow(n),o=r.getCellObj(u,s);else{o=e;var l=o.id.split("|"),c=l[l.length-1];s=r._columns[c];var h=$(o).parent();u=u||r.getRow(h[0])}t!=null&&s.name&&(u[s.name]=t,u[i.statusName]!="add"&&(u[i.statusName]="update"),r.isDataChanged=!0),r.reRender({rowdata:u,column:s})},addRows:function(e,t,n,r){var i=this,s=this.options;$(e).each(function(){i.addRow(this,t,n,r)})},_createRowid:function(){return"r"+(1e3+this.recordNumber)},_isRowId:function(e){return e in this.records},_addNewRecord:function(e,t,n){var r=this,i=this.options;r.recordNumber++,e.__id=r._createRowid(),e.__previd=t;if(t&&t!=-1){var s=r.records[t];if(s.__nextid&&s["__nextid"]!=-1){var o=r.records[s.__nextid];o&&(o.__previd=e.__id)}s.__nextid=e.__id,e.__index=s.__index+1}else e.__index=0;if(i.tree){if(n&&n!=-1){var u=r.records[n];e.__pid=n,e.__level=u.__level+1}else e.__pid=-1,e.__level=1;e.__hasChildren=e[i.tree.childrenName]?!0:!1}return e[i.statusName]!="add"&&(e[i.statusName]="nochanged"),r.rows[e.__index]=e,r.records[e.__id]=e,e},_getRows:function(e){function t(e){if(!e||!e.length)return;for(var n=0,s=e.length;n<s;n++){var o=e[n];i.push(o),o[r.tree.childrenName]&&t(o[r.tree.childrenName])}}var n=this,r=this.options,i=[];return t(e),i},_updateGridData:function(){function e(i,s){if(!i||!i.length)return;for(var o=0,u=i.length;o<u;o++){var a=i[o];t.formatRecord(a);if(a[n.statusName]=="delete")continue;t._addNewRecord(a,r,s),r=a.__id,a.__hasChildren&&e(a[n.tree.childrenName],a.__id)}}var t=this,n=this.options;t.recordNumber=0,t.rows=[],t.records={};var r=-1;return e(t.currentData[n.root],-1),t.rows},_moveData:function(e,t,n){var r=this,i=this.options,s=r.getRow(e),o=r.getRow(t),u,a,f=r._getParentChildren(s);u=$.inArray(s,f),f.splice(u,1),f=r._getParentChildren(o),a=$.inArray(o,f),f.splice(a+(n?1:0),0,s)},move:function(e,t,n){this._moveData(e,t,n),this.reRender()},moveRange:function(e,t,n){for(var r in e)this._moveData(e[r],t,n);this.reRender()},up:function(e){var t=this,n=this.options,r=t.getRow(e),i=t._getParentChildren(r),s=$.inArray(r,i);if(s==-1||s==0)return;var o=t.getSelected();t.move(r,i[s-1],!1),t.select(o)},down:function(e){var t=this,n=this.options,r=t.getRow(e),i=t._getParentChildren(r),s=$.inArray(r,i);if(s==-1||s==i.length-1)return;var o=t.getSelected();t.move(r,i[s+1],!0),t.select(o)},addRow:function(e,t,n,r){var i=this,s=this.options;e=e||{},i._addData(e,r,t,n),i.reRender(),e[s.statusName]="add";if(s.tree){var o=i.getChildren(e,!0);if(o)for(var u=0,a=o.length;u<a;u++)o[u][s.statusName]="add"}return i.isDataChanged=!0,s.total=s.total?s.total+1:1,s.pageCount=Math.ceil(s.total/s.pageSize),i._buildPager(),i.trigger("SysGridHeightChanged"),i.trigger("afterAddRow",[e]),e},updateRow:function(e,t){var n=this,r=this.options,i=n.getRow(e);return n.isDataChanged=!0,$.extend(i,t||{}),i[r.statusName]!="add"&&(i[r.statusName]="update"),n.reRender.ligerDefer(n,10,[{rowdata:i}]),i},setCellEditing:function(e,t,n){var r=this,i=this.options,s=r.getCellObj(e,t),o=n?"addClass":"removeClass";$(s)[o]("l-grid-row-cell-editing");if(e["__id"]!=0){var u=$(r.getRowObj(e.__id)).prev();if(!u.length)return;var a=r.getRow(u[0]),f=r.getCellObj(a,t);if(!f)return;$(f)[o]("l-grid-row-cell-editing-topcell")}if(t["__previd"]!=-1&&t["__previd"]!=null){var f=$(r.getCellObj(e,t)).prev();$(f)[o]("l-grid-row-cell-editing-leftcell")}},reRender:function(e){var t=this,n=this.options;e=e||{};var r=e.rowdata,i=e.column;if(i&&(i.isdetail||i.ischeckbox))return;if(r&&r[n.statusName]=="delete")return;if(r&&i){var s=t.getCellObj(r,i);$(s).html(t._getCellHtml(r,i)),i.issystem||t.setCellEditing(r,i,!1)}else if(r)$(t.columns).each(function(){t.reRender({rowdata:r,column:this})});else if(i){for(var o in t.records)t.reRender({rowdata:t.records[o],column:i});for(var u=0;u<t.totalNumber;u++){var a=document.getElementById(t.id+"|total"+u+"|"+i.__id);$("div:first",a).html(t._getTotalCellContent(i,t.groups&&t.groups[u]?t.groups[u]:t.currentData[n.root]))}}else t._showData()},getData:function(e,t){var n=this,r=this.options,i=[];for(var s in n.records){var o=$.extend(!0,{},n.records[s]);(o[r.statusName]==e||e==undefined)&&i.push(n.formatRecord(o,t))}return i},formatRecord:function(e,t){return delete e.__id,delete e.__previd,delete e.__nextid,delete e.__index,this.options.tree&&(delete e.__pid,delete e.__level,delete e.__hasChildren),t&&delete e[this.options.statusName],e},getUpdated:function(){return this.getData("update",!0)},getDeleted:function(){return this.deletedRows},getAdded:function(){return this.getData("add",!0)},getColumn:function(e){var t=this,n=this.options;if(typeof e=="string")return t._isColumnId(e)?t._columns[e]:t.columns[parseInt(e)];if(typeof e=="number")return t.columns[e];if(typeof e=="object"&&e.nodeType==1){var r=e.id.split("|"),i=r[r.length-1];return t._columns[i]}return e},getColumnType:function(e){var t=this,n=this.options;for(i=0;i<t.columns.length;i++)if(t.columns[i].name==e)return t.columns[i].type?t.columns[i].type:"string";return null},isTotalSummary:function(){var e=this,t=this.options;for(var n=0;n<e.columns.length;n++)if(e.columns[n].totalSummary)return!0;return!1},getColumns:function(e){var t=this,n=this.options,r=[];for(var i in t._columns){var s=t._columns[i];e!=undefined?s["__level"]==e&&r.push(s):s.__leaf&&r.push(s)}return r},changeSort:function(e,t){var n=this,r=this.options;if(n.loading)return!0;if(r.dataAction=="local"){var i=n.getColumnType(e);n.sortedData||(n.sortedData=n.filteredData),r.sortName==e?n.sortedData[r.root].reverse():n.sortedData[r.root].sort(function(t,r){return n._compareData(t,r,e,i)}),r.usePager?n.currentData=n._getCurrentPageData(n.sortedData):n.currentData=n.sortedData,n._showData()}r.sortName=e,r.sortOrder=t,r.dataAction=="server"&&n.loadData(r.where)},changePage:function(e){var t=this,n=this.options;if(t.loading)return!0;if(n.dataAction!="local"&&t.isDataChanged&&!confirm(n.isContinueByDataChanged))return!1;n.pageCount=parseInt($(".pcontrol span",t.toolbar).html());switch(e){case"first":if(n.page==1)return;n.newPage=1;break;case"prev":if(n.page==1)return;n.page>1&&(n.newPage=parseInt(n.page)-1);break;case"next":if(n.page>=n.pageCount)return;n.newPage=parseInt(n.page)+1;break;case"last":if(n.page>=n.pageCount)return;n.newPage=n.pageCount;break;case"input":var r=parseInt($(".pcontrol input",t.toolbar).val());isNaN(r)&&(r=1),r<1?r=1:r>n.pageCount&&(r=n.pageCount),$(".pcontrol input",t.toolbar).val(r),n.newPage=r}if(n.newPage==n.page)return!1;n.newPage==1?($(".l-bar-btnfirst span",t.toolbar).addClass("l-disabled"),$(".l-bar-btnprev span",t.toolbar).addClass("l-disabled")):($(".l-bar-btnfirst span",t.toolbar).removeClass("l-disabled"),$(".l-bar-btnprev span",t.toolbar).removeClass("l-disabled")),n.newPage==n.pageCount?($(".l-bar-btnlast span",t.toolbar).addClass("l-disabled"),$(".l-bar-btnnext span",t.toolbar).addClass("l-disabled")):($(".l-bar-btnlast span",t.toolbar).removeClass("l-disabled"),$(".l-bar-btnnext span",t.toolbar).removeClass("l-disabled")),t.trigger("changePage",[n.newPage]),n.dataAction=="server"?t.loadData(n.where):(t.currentData=t._getCurrentPageData(t.filteredData),t._showData())},getSelectedRow:function(){for(var e in this.selected){var t=this.selected[e];if(t.__id in this.records)return t}return null},getSelectedRows:function(){var e=[];for(var t in this.selected){var n=this.selected[t];n.__id in this.records&&e.push(n)}return e},getSelectedRowObj:function(){for(var e in this.selected){var t=this.selected[e];if(t.__id in this.records)return this.getRowObj(t)}return null},getSelectedRowObjs:function(){var e=[];for(var t in this.selected){var n=this.selected[t];n.__id in this.records&&e.push(this.getRowObj(n))}return e},getCellObj:function(e,t){var n=this.getRow(e);return t=this.getColumn(t),document.getElementById(this._getCellDomId(n,t))},getRowObj:function(e,t){var n=this,r=this.options;return e==null?null:typeof e=="string"?n._isRowId(e)?document.getElementById(n.id+(t?"|1|":"|2|")+e):document.getElementById(n.id+(t?"|1|":"|2|")+n.rows[parseInt(e)].__id):typeof e=="number"?document.getElementById(n.id+(t?"|1|":"|2|")+n.rows[e].__id):typeof e=="object"&&e.__id?n.getRowObj(e.__id,t):e},getRow:function(e){var t=this,n=this.options;return e==null?null:typeof e=="string"?t._isRowId(e)?t.records[e]:t.rows[parseInt(e)]:typeof e=="number"?t.rows[parseInt(e)]:typeof e=="object"&&e.nodeType==1&&!e.__id?t._getRowByDomId(e.id):e},_setColumnVisible:function(e,t){var n=this,r=this.options;if(!t){e._hide=!1,document.getElementById(e.__domid).style.display="";if(e["__pid"]!=-1){var i=n._columns[e.__pid];i._hide&&(document.getElementById(i.__domid).style.display="",this._setColumnVisible(i,t))}}else{e._hide=!0,document.getElementById(e.__domid).style.display="none";if(e["__pid"]!=-1){var s=!0,i=this._columns[e.__pid];for(var o=0;i&&o<i.columns.length;o++)if(!i.columns[o]._hide){s=!1;break}s&&(i._hide=!0,document.getElementById(i.__domid).style.display="none",this._setColumnVisible(i,t))}}},toggleCol:function(e,t,n){var r=this,i=this.options,s;if(typeof e=="number")s=r.columns[e];else if(typeof e=="object"&&e.__id)s=e;else if(typeof e=="string"){if(!r._isColumnId(e)){$(r.columns).each(function(){this.name==e&&r.toggleCol(this,t,n)});return}s=r._columns[e]}if(!s)return;var o=s.__leafindex,u=document.getElementById(s.__domid);if(!u)return;u=$(u);var a=[];for(var f in r.rows){var l=r.getCellObj(r.rows[f],s);l&&a.push(l)}for(var f=0;f<r.totalNumber;f++){var c=document.getElementById(r.id+"|total"+f+"|"+s.__id);c&&a.push(c)}var h=s._width;t&&s._hide?(s.frozen?r.f.gridtablewidth+=parseInt(h)+1:r.gridtablewidth+=parseInt(h)+1,r._setColumnVisible(s,!1),$(a).show()):!t&&!s._hide&&(s.frozen?r.f.gridtablewidth-=parseInt(h)+1:r.gridtablewidth-=parseInt(h)+1,r._setColumnVisible(s,!0),$(a).hide()),s.frozen?($("div:first",r.f.gridheader).width(r.f.gridtablewidth),$("div:first",r.f.gridbody).width(r.f.gridtablewidth)):($("div:first",r.gridheader).width(r.gridtablewidth+40),$("div:first",r.gridbody).width(r.gridtablewidth)),r._updateFrozenWidth(),n||$(":checkbox[columnindex="+o+"]",r.popup).each(function(){this.checked=t;if($.fn.ligerCheckBox){var e=$(this).ligerGetCheckBoxManager();e&&e.updateStyle()}})},setColumnWidth:function(e,t){var n=this,r=this.options;if(!t)return;t=parseInt(t,10);var i;if(typeof e=="number")i=n.columns[e];else if(typeof e=="object"&&e.__id)i=e;else if(typeof e=="string"){if(!n._isColumnId(e)){$(n.columns).each(function(){this.name==e&&n.setColumnWidth(this,t)});return}i=n._columns[e]}if(!i)return;var s=r.minColumnWidth;i.minWidth&&(s=i.minWidth),t=t<s?s:t;var o=t-i._width;if(n.trigger("beforeChangeColumnWidth",[i,t])==0)return;i._width=t,i.frozen?(n.f.gridtablewidth+=o,$("div:first",n.f.gridheader).width(n.f.gridtablewidth),$("div:first",n.f.gridbody).width(n.f.gridtablewidth)):(n.gridtablewidth+=o,$("div:first",n.gridheader).width(n.gridtablewidth+40),$("div:first",n.gridbody).width(n.gridtablewidth)),$(document.getElementById(i.__domid)).css("width",t);var u=[];for(var a in n.records){var f=n.getCellObj(n.records[a],i);f&&u.push(f);if(!n.enabledDetailEdit()&&n.editors[a]&&n.editors[a][i.__id]){var l=n.editors[a][i.__id];l.editor.resize&&l.editor.resize(l.input,t,l.container.height(),l.editParm)}}for(var c=0;c<n.totalNumber;c++){var h=document.getElementById(n.id+"|total"+c+"|"+i.__id);h&&u.push(h)}$(u).css("width",t).find("> div.l-grid-row-cell-inner:first").css("width",t-8),n._updateFrozenWidth(),n.trigger("afterChangeColumnWidth",[i,t])},changeHeaderText:function(e,t){var n=this,r=this.options,i;if(typeof e=="number")i=n.columns[e];else if(typeof e=="object"&&e.__id)i=e;else if(typeof e=="string"){if(!n._isColumnId(e)){$(n.columns).each(function(){this.name==e&&n.changeHeaderText(this,t)});return}i=n._columns[e]}if(!i)return;var s=i.__leafindex,o=document.getElementById(i.__domid);$(".l-grid-hd-cell-text",o).html(t),r.allowHideColumn&&$(":checkbox[columnindex="+s+"]",n.popup).parent().next().html(t)},changeCol:function(e,t,n){var r=this,i=this.options;if(!e||!t)return;var s=r.getColumn(e),o=r.getColumn(t);s.frozen=o.frozen;var u,a,f=s["__pid"]==-1?i.columns:r._columns[s.__pid].columns,l=o["__pid"]==-1?i.columns:r._columns[o.__pid].columns;u=
$.inArray(s,f),a=$.inArray(o,l);var c=f==l,h=s["__level"]==o["__level"];l.splice(a+(n?1:0),0,s),c?n?f.splice(u,1):f.splice(u+1,1):f.splice(u,1),r._setColumns(i.columns),r.reRender()},collapseDetail:function(e){var t=this,n=this.options,r=t.getRow(e);if(!r)return;for(var i=0,s=t.columns.length;i<s;i++)if(t.columns[i].isdetail){var o=t.getRowObj(r),u=t.getCellObj(r,t.columns[i]);$(o).next("tr.l-grid-detailpanel").hide(),$(".l-grid-row-cell-detailbtn:first",u).removeClass("l-open"),t.trigger("SysGridHeightChanged");return}},extendDetail:function(e){var t=this,n=this.options,r=t.getRow(e);if(!r)return;for(var i=0,s=t.columns;i<s;i++)if(t.columns[i].isdetail){var o=t.getRowObj(r),u=t.getCellObj(r,t.columns[i]);$(o).next("tr.l-grid-detailpanel").show(),$(".l-grid-row-cell-detailbtn:first",u).addClass("l-open"),t.trigger("SysGridHeightChanged");return}},getParent:function(e){var t=this,n=this.options;if(!n.tree)return null;var r=t.getRow(e);return r?r.__pid in t.records?t.records[r.__pid]:null:null},getChildren:function(e,t){function n(e){if(e[i.tree.childrenName])for(var r=0,s=e[i.tree.childrenName].length;r<s;r++){var u=e[i.tree.childrenName][r];if(u["__status"]=="delete")continue;o.push(u),t&&n(u)}}var r=this,i=this.options;if(!i.tree)return null;var s=r.getRow(e);if(!s)return null;var o=[];return n(s),o},isLeaf:function(e){var t=this,n=this.options,r=t.getRow(e);if(!r)return;return r.__hasChildren?!1:!0},hasChildren:function(e){var t=this,n=this.options,r=this.getRow(e);if(!r)return;return r[n.tree.childrenName]&&r[n.tree.childrenName].length?!0:!1},existRecord:function(e){for(var t in this.records)if(this.records[t]==e)return!0;return!1},_removeSelected:function(e){var t=this,n=this.options;if(n.tree){var r=t.getChildren(e,!0);if(r)for(var i=0,s=r.length;i<s;i++){var o=$.inArray(r[i],t.selected);o!=-1&&t.selected.splice(o,1)}}var u=$.inArray(e,t.selected);u!=-1&&t.selected.splice(u,1)},_getParentChildren:function(e){var t=this,n=this.options,r=t.getRow(e),i;return n.tree&&t.existRecord(r)&&r.__pid in t.records?i=t.records[r.__pid][n.tree.childrenName]:i=t.currentData[n.root],i},_removeData:function(e){var t=this,n=this.options,r=t._getParentChildren(e),i=$.inArray(e,r);i!=-1&&r.splice(i,1),t._removeSelected(e)},_addData:function(e,t,n,r){var i=this,s=this.options,o=i.currentData[s.root];if(n){s.tree&&(t?o=t[s.tree.childrenName]:n.__pid in i.records&&(o=i.records[n.__pid][s.tree.childrenName]));var u=$.inArray(n,o);o.splice(u==-1?-1:u+(r?0:1),0,e)}else s.tree&&t&&(o=t[s.tree.childrenName]),o.push(e)},_appendData:function(e,t,n,r){var i=this,s=this.options;e[s.statusName]="update",i._removeData(e),i._addData(e,t,n,r)},appendRange:function(e,t,n,r){var i=this,s=this.options,o=!1;$.each(e,function(e,s){s.__id&&i.existRecord(s)?(i.isLeaf(t)&&i.upgrade(t),i._appendData(s,t,n,r),o=!0):i.appendRow(s,t,n,r)}),o&&i.reRender()},appendRow:function(e,t,n,r){var i=this,s=this.options;if($.isArray(e)){i.appendRange(e,t,n,r);return}if(e.__id&&i.existRecord(e)){i._appendData(e,t,n,r),i.reRender();return}t&&i.isLeaf(t)&&i.upgrade(t),i.addRow(e,n,r?!0:!1,t)},upgrade:function(e){var t=this,n=this.options,r=t.getRow(e);if(!r||!n.tree)return;r[n.tree.childrenName]=r[n.tree.childrenName]||[],r.__hasChildren=!0;var i=[t.getRowObj(r)];t.enabledFrozen()&&i.push(t.getRowObj(r,!0)),$("> td > div > .l-grid-tree-space:last",i).addClass("l-grid-tree-link l-grid-tree-link-open")},demotion:function(e){var t=this,n=this.options,r=t.getRow(e);if(!r||!n.tree)return;var i=[t.getRowObj(r)];t.enabledFrozen()&&i.push(t.getRowObj(r,!0)),$("> td > div > .l-grid-tree-space:last",i).removeClass("l-grid-tree-link l-grid-tree-link-open l-grid-tree-link-close");if(t.hasChildren(r)){var s=t.getChildren(r);for(var o=0,u=s.length;o<u;o++)t.deleteRow(s[o])}r.__hasChildren=!1},collapse:function(e){var t=this,n=this.options,r=t.getRowObj(e),i=$(".l-grid-tree-link",r);if(i.hasClass("l-grid-tree-link-close"))return;t.toggle(e)},expand:function(e){var t=this,n=this.options,r=t.getRowObj(e),i=$(".l-grid-tree-link",r);if(i.hasClass("l-grid-tree-link-open"))return;t.toggle(e)},toggle:function(e){if(!e)return;var t=this,n=this.options,r=t.getRow(e),i=[t.getRowObj(r)];t.enabledFrozen()&&i.push(t.getRowObj(r,!0));var s=r.__level,o,u=$(".l-grid-tree-link:first",i),a=!0;t.collapsedRows=t.collapsedRows||[],u.hasClass("l-grid-tree-link-close")?(u.removeClass("l-grid-tree-link-close").addClass("l-grid-tree-link-open"),o=$.inArray(r,t.collapsedRows),o!=-1&&t.collapsedRows.splice(o,1)):(a=!1,u.addClass("l-grid-tree-link-close").removeClass("l-grid-tree-link-open"),o=$.inArray(r,t.collapsedRows),o==-1&&t.collapsedRows.push(r));var f=t.getChildren(r,!0);for(var l=0,c=f.length;l<c;l++){var h=f[l],p=$([t.getRowObj(h.__id)]);t.enabledFrozen()&&(p=p.add(t.getRowObj(h.__id,!0))),a?($(".l-grid-tree-link",p).removeClass("l-grid-tree-link-close").addClass("l-grid-tree-link-open"),p.show()):($(".l-grid-tree-link",p).removeClass("l-grid-tree-link-open").addClass("l-grid-tree-link-close"),p.hide())}},_bulid:function(){var e=this;e._clearGrid(),e._initBuildHeader(),e._initHeight(),e._initFootbar(),e._buildPager(),e._setEvent()},_setColumns:function(e){var t=this;t._initColumns(),t._initBuildGridHeader(),t._initBuildPopup()},_initBuildHeader:function(){var e=this,t=this.options;t.title?($(".l-panel-header-text",e.header).html(t.title),t.headerImg&&e.header.append("<img src='"+t.headerImg+"' />").addClass("l-panel-header-hasicon")):e.header.hide(),t.toolbar?$.fn.ligerToolBar&&(e.toolbarManager=e.topbar.ligerToolBar(t.toolbar)):e.topbar.remove()},_createColumnId:function(e){return e.id!=null?e.id.toString():"c"+(100+this._columnCount)},_isColumnId:function(e){return e in this._columns},_initColumns:function(){function e(e,t){for(var n in t)t[n]in e&&delete e[t[n]]}function t(r,i,s,o){e(r,["__id","__pid","__previd","__nextid","__domid","__leaf","__leafindex","__level","__colSpan","__rowSpan"]),i>n._columnMaxLevel&&(n._columnMaxLevel=i),n._columnCount++,r.__id=n._createColumnId(r),r.__domid=n.id+"|hcell|"+r.__id,n._columns[r.__id]=r;if(!r.columns||!r.columns.length)r.__leafindex=n._columnLeafCount++;r.__level=i,r.__pid=s,r.__previd=o;if(!r.columns||!r.columns.length)return r.__leaf=!0,1;var u=0,a=-1;for(var f=0,l=r.columns.length;f<l;f++){var c=r.columns[f];u+=t(c,i+1,r.__id,a),a=c.__id}return r.__leafcount=u,u}var n=this,r=this.options;n._columns={},n._columnCount=0,n._columnLeafCount=0,n._columnMaxLevel=1;if(!r.columns)return;var i=-1;if(r.rownumbers){var s=n.enabledGroup()?!1:r.frozen&&r.frozenRownumbers,o={isrownumber:!0,issystem:!0,width:r.rownumbersColWidth,frozen:s};t(o,1,-1,i),i=o.__id}if(n.enabledDetail()){var u=n.enabledGroup()?!1:r.frozen&&r.frozenDetail,o={isdetail:!0,issystem:!0,width:r.detailColWidth,frozen:u};t(o,1,-1,i),i=o.__id}if(n.enabledCheckbox()){var a=n.enabledGroup()?!1:r.frozen&&r.frozenCheckbox,o={ischeckbox:!0,issystem:!0,width:r.detailColWidth,frozen:a};t(o,1,-1,i),i=o.__id}for(var f=0,l=r.columns.length;f<l;f++){var o=r.columns[f];t(o,1,-1,i),i=o.__id}for(var c in n._columns){var o=n._columns[c];o.__leafcount>1&&(o.__colSpan=o.__leafcount),o.__leaf&&o["__level"]!=n._columnMaxLevel&&(o.__rowSpan=n._columnMaxLevel-o.__level+1)}n.columns=n.getColumns(),$(n.columns).each(function(e,t){t.columnname=t.name,t.columnindex=e,t.type=t.type||"string",t.islast=e==n.columns.length-1,t.isSort=t.isSort==0?!1:!0,t.frozen=t.frozen?!0:!1,t._width=n._getColumnWidth(t),t._hide=t.hide?!0:!1})},_getColumnWidth:function(e){var t=this,n=this.options;if(e._width)return e._width;var r;e.width?r=e.width:n.columnWidth&&(r=n.columnWidth);if(!r){var i=4;t.enabledCheckbox()&&(i+=n.checkboxColWidth),t.enabledDetail()&&(i+=n.detailColWidth),r=parseInt((t.grid.width()-i)/t.columns.length)}return typeof r=="string"&&r.indexOf("%")>0&&(e._width=r=parseInt(parseInt(r)*.01*(t.grid.width()-t.columns.length))),e.minWidth&&r<e.minWidth&&(r=e.minWidth),e.maxWidth&&r>e.maxWidth&&(r=e.maxWidth),e._width=r,r},_createHeaderCell:function(e){var t=this,n=this.options,r=$("<td class='l-grid-hd-cell'><div class='l-grid-hd-cell-inner'><span class='l-grid-hd-cell-text'></span></div></td>");r.attr("id",e.__domid),e.__leaf||r.addClass("l-grid-hd-cell-mul"),e.columnindex==t.columns.length-1&&r.addClass("l-grid-hd-cell-last"),e.isrownumber&&(r.addClass("l-grid-hd-cell-rownumbers"),r.html("<div class='l-grid-hd-cell-inner'></div>")),e.ischeckbox&&(r.addClass("l-grid-hd-cell-checkbox"),r.html("<div class='l-grid-hd-cell-inner'><div class='l-grid-hd-cell-text l-grid-hd-cell-btn-checkbox'></div></div>")),e.isdetail&&(r.addClass("l-grid-hd-cell-detail"),r.html("<div class='l-grid-hd-cell-inner'><div class='l-grid-hd-cell-text l-grid-hd-cell-btn-detail'></div></div>")),e.heightAlign&&$(".l-grid-hd-cell-inner:first",r).css("textAlign",e.heightAlign),e.__colSpan&&r.attr("colSpan",e.__colSpan),e.__rowSpan?(r.attr("rowSpan",e.__rowSpan),r.height(n.headerRowHeight*e.__rowSpan)):r.height(n.headerRowHeight),e.__leaf&&(r.width(e._width),r.attr("columnindex",e.__leafindex)),e._hide&&r.hide(),e.name&&r.attr({columnname:e.name});var i="";return e.display&&e.display!=""?i=e.display:e.headerRender?i=e.headerRender(e):i="&nbsp;",$(".l-grid-hd-cell-text:first",r).html(i),!e.issystem&&e.__leaf&&e.resizable!==!1&&$.fn.ligerResizable&&(t.colResizable[e.__id]=r.ligerResizable({handles:"e",onStartResize:function(e,n){this.proxy.hide(),t.draggingline.css({height:t.body.height(),top:0,left:n.pageX-t.grid.offset().left+parseInt(t.body[0].scrollLeft)}).show()},onResize:function(e,n){t.colresizing=!0,t.draggingline.css({left:n.pageX-t.grid.offset().left+parseInt(t.body[0].scrollLeft)}),$("body").add(r).css("cursor","e-resize")},onStopResize:function(n){return t.colresizing=!1,$("body").add(r).css("cursor","default"),t.draggingline.hide(),t.setColumnWidth(e,e._width+n.diffX),!1}})),r},_initBuildGridHeader:function(){var e=this,t=this.options;e.gridtablewidth=0,e.f.gridtablewidth=0;if(e.colResizable){for(var n in e.colResizable)e.colResizable[n].destroy();e.colResizable=null}e.colResizable={},$("tbody:first",e.gridheader).html(""),$("tbody:first",e.f.gridheader).html("");for(var r=1;r<=e._columnMaxLevel;r++){var i=e.getColumns(r),s=r==e._columnMaxLevel,o=$("<tr class='l-grid-hd-row'></tr>"),u=$("<tr class='l-grid-hd-row'></tr>");s||o.add(u).addClass("l-grid-hd-mul"),$("tbody:first",e.gridheader).append(o),$("tbody:first",e.f.gridheader).append(u),$(i).each(function(t,n){(n.frozen?u:o).append(e._createHeaderCell(n));if(n.__leaf){var r=n._width;n.frozen?e.f.gridtablewidth+=(parseInt(r)?parseInt(r):0)+1:e.gridtablewidth+=(parseInt(r)?parseInt(r):0)+1}})}if(e._columnMaxLevel>0){var a=t.headerRowHeight*e._columnMaxLevel;e.gridheader.add(e.f.gridheader).height(a),t.rownumbers&&t.frozenRownumbers&&e.f.gridheader.find("td:first").height(a)}e._updateFrozenWidth(),$("div:first",e.gridheader).width(e.gridtablewidth+40)},_initBuildPopup:function(){var e=this,t=this.options;$(":checkbox",e.popup).unbind(),$("tbody tr",e.popup).remove(),$(e.columns).each(function(t,n){if(n.issystem)return;if(n.isAllowHide==0)return;var r='checked="checked"';n._hide&&(r="");var i=n.display;$("tbody",e.popup).append('<tr><td class="l-column-left"><input type="checkbox" '+r+' class="l-checkbox" columnindex="'+t+'"/></td><td class="l-column-right">'+i+"</td></tr>")}),$.fn.ligerCheckBox&&$("input:checkbox",e.popup).ligerCheckBox({onBeforeClick:function(n){return n.checked?$("input:checked",e.popup).length<=t.minColToggle?!1:!0:!0}});if(t.allowHideColumn){$("tr",e.popup).hover(function(){$(this).addClass("l-popup-row-over")},function(){$(this).removeClass("l-popup-row-over")});var n=function(){if($("input:checked",e.popup).length+1<=t.minColToggle)return!1;e.toggleCol(parseInt($(this).attr("columnindex")),this.checked,!0)};$.fn.ligerCheckBox?$(":checkbox",e.popup).bind("change",n):$(":checkbox",e.popup).bind("click",n)}},_initHeight:function(){var e=this,t=this.options;t.height=="auto"&&(e.gridbody.height("auto"),e.f.gridbody.height("auto")),t.width&&e.grid.width(t.width),e._onResize.call(e)},_initFootbar:function(){var e=this,t=this.options;if(t.usePager){var n="",r=-1;$(t.pageSizeOptions).each(function(e,i){var s="";t.pageSize==i&&(r=e),n+="<option value='"+i+"' "+s+" >"+i+"</option>"}),$(".l-bar-selectpagesize",e.toolbar).append("<select name='rp'>"+n+"</select>"),r!=-1&&($(".l-bar-selectpagesize select",e.toolbar)[0].selectedIndex=r),t.switchPageSizeApplyComboBox&&$.fn.ligerComboBox&&$(".l-bar-selectpagesize select",e.toolbar).ligerComboBox({onBeforeSelect:function(){return t.url&&e.isDataChanged&&!confirm(t.isContinueByDataChanged)?!1:!0},width:45})}else e.toolbar.hide()},_searchData:function(e,t){var n=this,r=this.options,i=new Array;for(var s=0;s<e.length;s++)t(e[s],s)&&(i[i.length]=e[s]);return i},_clearGrid:function(){var e=this,t=this.options;for(var n in e.rows){var r=$(e.getRowObj(e.rows[n]));e.enabledFrozen()&&(r=r.add(e.getRowObj(e.rows[n],!0))),r.unbind()}e.gridbody.html(""),e.f.gridbody.html(""),e.recordNumber=0,e.records={},e.rows=[],e.selected=[],e.totalNumber=0,e.editorcounter=0},_fillGridBody:function(e,t){var n=this,r=this.options,i=['<div class="l-grid-body-inner"><table class="l-grid-body-table" cellpadding=0 cellspacing=0><tbody>'];if(n.enabledGroup()){var s=[],o=[];n.groups=o;for(var u in e){var a=e[u],f=a[r.groupColumnName],l=$.inArray(f,s);l==-1&&(s.push(f),l=s.length-1,o.push([])),o[l].push(a)}$(o).each(function(e,u){o.length==1&&i.push('<tr class="l-grid-grouprow l-grid-grouprow-last l-grid-grouprow-first"'),e==o.length-1?i.push('<tr class="l-grid-grouprow l-grid-grouprow-last"'):e==0?i.push('<tr class="l-grid-grouprow l-grid-grouprow-first"'):i.push('<tr class="l-grid-grouprow"'),i.push(' groupindex"='+e+'" >'),i.push('<td colSpan="'+n.columns.length+'" class="l-grid-grouprow-cell">'),i.push('<span class="l-grid-group-togglebtn">&nbsp;&nbsp;&nbsp;&nbsp;</span>'),r.groupRender?i.push(r.groupRender(s[e],u,r.groupColumnDisplay)):i.push(r.groupColumnDisplay+":"+s[e]),i.push("</td>"),i.push("</tr>"),i.push(n._getHtmlFromData(u,t)),n.isTotalSummary()&&i.push(n._getTotalSummaryHtml(u,"l-grid-totalsummary-group",t))})}else i.push(n._getHtmlFromData(e,t));i.push("</tbody></table></div>"),(t?n.f.gridbody:n.gridbody).html(i.join("")),n.enabledGroup()||n._bulidTotalSummary(t),$("> div:first",n.gridbody).width(n.gridtablewidth),n._onResize()},_showData:function(){var e=this,t=this.options,n=e.currentData[t.root];t.usePager&&(t.dataAction=="server"&&e.data&&e.data[t.record]?t.total=e.data[t.record]:e.filteredData&&e.filteredData[t.root]?t.total=e.filteredData[t.root].length:e.data&&e.data[t.root]?t.total=e.data[t.root].length:n&&(t.total=n.length),t.page=t.newPage,t.total||(t.total=0),t.page||(t.page=1),t.pageCount=Math.ceil(t.total/t.pageSize),t.pageCount||(t.pageCount=1),e._buildPager()),$(".l-bar-btnloading:first",e.toolbar).removeClass("l-bar-btnloading");if(e.trigger("beforeShowData",[e.currentData])==0)return;e._clearGrid(),e.isDataChanged=!1;if(!n)return;$(".l-bar-btnload:first span",e.toolbar).removeClass("l-disabled"),e._updateGridData(),e.enabledFrozen()&&e._fillGridBody(e.rows,!0),e._fillGridBody(e.rows,!1),e.trigger("SysGridHeightChanged"),t.totalRender&&($(".l-panel-bar-total",e.element).remove(),$(".l-panel-bar",e.element).before('<div class="l-panel-bar-total">'+t.totalRender(e.data,e.filteredData)+"</div>"));if(t.mouseoverRowCssClass)for(var r in e.rows){var i=$(e.getRowObj(e.rows[r]));e.enabledFrozen()&&(i=i.add(e.getRowObj(e.rows[r],!0))),i.bind("mouseover.gridrow",function(){e._onRowOver(this,!0)}).bind("mouseout.gridrow",function(){e._onRowOver(this,!1)})}e.gridbody.trigger("scroll.grid"),e.trigger("afterShowData",[e.currentData])},_getRowDomId:function(e,t){return this.id+"|"+(t?"1":"2")+"|"+e.__id},_getCellDomId:function(e,t){return this._getRowDomId(e,t.frozen)+"|"+t.__id},_getHtmlFromData:function(e,t){if(!e)return"";var n=this,r=this.options,i=[];for(var s in e){var o=e[s],u=o.__id;if(!o)continue;i.push("<tr"),i.push(' id="'+n._getRowDomId(o,t)+'"'),i.push(' class="l-grid-row'),!t&&n.enabledCheckbox()&&r.isChecked&&r.isChecked(o)?(n.select(o),i.push(" l-selected")):n.isSelected(o)&&i.push(" l-selected"),o["__index"]%2==1&&r.alternatingRow&&i.push(" l-grid-row-alt"),i.push('" '),r.rowAttrRender&&i.push(r.rowAttrRender(o,u));if(r.tree&&n.collapsedRows&&n.collapsedRows.length){var a=function(){var e=n.getParent(o);while(e){if($.inArray(e,n.collapsedRows)!=-1)return!0;e=n.getParent(e)}return!1};a()&&i.push(' style="display:none;" ')}i.push(">"),$(n.columns).each(function(e,s){if(t!=s.frozen)return;i.push("<td"),i.push(' id="'+n._getCellDomId(o,this)+'"');if(this.isrownumber){i.push(' class="l-grid-row-cell l-grid-row-cell-rownumbers" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"'),r.fixedCellHeight&&i.push(' style = "height:'+r.rowHeight+'px;" '),i.push(">"+(parseInt(o.__index)+1)+"</div></td>");return}if(this.ischeckbox){i.push(' class="l-grid-row-cell l-grid-row-cell-checkbox" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"'),r.fixedCellHeight&&i.push(' style = "height:'+r.rowHeight+'px;" '),i.push('><span class="l-grid-row-cell-btn-checkbox"></span></div></td>');return}if(this.isdetail){i.push(' class="l-grid-row-cell l-grid-row-cell-detail" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"'),r.fixedCellHeight&&i.push(' style = "height:'+r.rowHeight+'px;" '),i.push('><span class="l-grid-row-cell-detailbtn"></span></div></td>');return}var a=this._width;i.push(' class="l-grid-row-cell '),n.changedCells[u+"_"+this.__id]&&i.push("l-grid-row-cell-edited "),this.islast&&i.push("l-grid-row-cell-last "),i.push('"'),i.push(' style = "'),i.push("width:"+a+"px; "),s._hide&&i.push("display:none;"),i.push(' ">'),i.push(n._getCellHtml(o,s)),i.push("</td>")}),i.push("</tr>")}return i.join("")},_getCellHtml:function(e,t){var n=this,r=this.options;if(t.isrownumber)return'<div class="l-grid-row-cell-inner">'+(parseInt(e.__index)+1)+"</div>";var i=[];i.push('<div class="l-grid-row-cell-inner"'),i.push(' style = "width:'+parseInt(t._width-8)+"px;"),r.fixedCellHeight&&i.push("height:"+r.rowHeight+"px;min-height:"+r.rowHeight+"px; "),t.align&&i.push("text-align:"+t.align+";");var s=n._getCellContent(e,t);return i.push('">'+s+"</div>"),i.join("")},_getCellContent:function(e,t){if(!e||!t)return"";if(t.isrownumber)return parseInt(e.__index)+1;var n=e.__id,r=e.__index,i=t.name?e[t.name]:null,s=this,o=this.options,u="";return t.render?u=t.render.call(s,e,r,i,t):o.formatters[t.type]?u=o.formatters[t.type].call(s,i,t):i!=null&&(u=i.toString()),o.tree&&(o.tree.columnName!=null&&o.tree.columnName==t.name||o.tree.columnId!=null&&o.tree.columnId==t.id)&&(u=s._getTreeCellHtml(u,e)),u||""},_getTreeCellHtml:function(e,t){var n=t.__level,r=this,i=this.options,s=$.inArray(t,r.collapsedRows||[])==-1,o=i.tree.isParent(t),u="";n=parseInt(n)||1;for(var a=1;a<n;a++)u+="<div class='l-grid-tree-space'></div>";return s&&o?u+="<div class='l-grid-tree-space l-grid-tree-link l-grid-tree-link-open'></div>":o?u+="<div class='l-grid-tree-space l-grid-tree-link l-grid-tree-link-close'></div>":u+="<div class='l-grid-tree-space'></div>",u+="<span class='l-grid-tree-content'>"+e+"</span>",u},_applyEditor:function(e){var t=this,n=this.options,r=e,i=r.id.split("|"),s=i[i.length-1],o=t._columns[s],u=$(r).parent(),a=t.getRow(u[0]),f=a.__id,l=a.__index;if(!o||!o.editor)return;var c=o.name,h=o.columnindex;if(o.editor.type&&n.editors[o.editor.type]){var p=a[c],d={record:a,value:p,column:o,rowindex:l};if(t.trigger("beforeEdit",[d])==0)return!1;var v=n.editors[o.editor.type],m=$(r),g=$(r).offset();m.html(""),t.setCellEditing(a,o,!0);var y=$(r).width(),b=$(r).height(),w=g.left,E=b>30?g.top+b/2-15:g.top,S=$("<div class='l-grid-editor'></div>").appendTo("body");$.browser.mozilla?S.css({left:w,top:E}).show():S.css({left:w+1,top:E+1}).show();var x=t._createEditor(v,S,d,y,b);t.editor={editing:!0,editor:v,input:x,editParm:d,container:S},t.unbind("sysEndEdit"),t.bind("sysEndEdit",function(){var e=v.getValue(x,d);e!=p&&($(r).addClass("l-grid-row-cell-edited"),t.changedCells[f+"_"+o.__id]=!0,o.editor.onChange&&o.editor.onChange(r,e),d.value=e,t._checkEditAndUpdateCell(d)&&o.editor.onChanged&&o.editor.onChanged(r,e))})}},_checkEditAndUpdateCell:function(e){var t=this,n=this.options;return t.trigger("beforeSubmitEdit",[e])==0?!1:(t.updateCell(e.column,e.value,e.record),(e.column.render||t.enabledTotal())&&t.reRender({column:e.column}),t.reRender({rowdata:e.record}),!0)},_getCurrentPageData:function(e){var t=this,n=this.options,r={};r[n.root]=[];if(!e||!e[n.root]||!e[n.root].length)return r[n.record]=0,r;r[n.record]=e[n.root].length,n.newPage||(n.newPage=1);for(i=(n.newPage-1)*n.pageSize;i<e[n.root].length&&i<n.newPage*n.pageSize;i++)r[n.root].push(e[n.root][i]);return r},_compareData:function(e,t,n,r){var i=this,s=this.options,o=e[n],u=t[n];return o==null&&u!=null?1:o==null&&u==null?0:o!=null&&u==null?-1:s.sorters[r]?s.sorters[r].call(i,o,u):o<u?-1:o>u?1:0},_getTotalCellContent:function(e,t){var n=this,r=this.options,i=[];if(e.totalSummary){var s=function(e){for(var t=0;t<d.length;t++)if(d[t].toLowerCase()==e.toLowerCase())return!0;return!1},o=0,u=0,a=0,f=parseFloat(t[0][e.name]),l=parseFloat(t[0][e.name]);for(var c=0;c<t.length;c++){u+=1;var h=parseFloat(t[c][e.name]);if(!h)continue;o+=h,h>f&&(f=h),h<l&&(l=h)}a=o*1/t.length;if(e.totalSummary.render){var p=e.totalSummary.render({sum:o,count:u,avg:a,min:l,max:f},e,n.data);i.push(p)}else if(e.totalSummary.type){var d=e.totalSummary.type.split(",");s("sum")&&i.push("<div>Sum="+o.toFixed(2)+"</div>"),s("count")&&i.push("<div>Count="+u+"</div>"),s("max")&&i.push("<div>Max="+f.toFixed(2)+"</div>"),s("min")&&i.push("<div>Min="+l.toFixed(2)+"</div>"),s("avg")&&i.push("<div>Avg="+a.toFixed(2)+"</div>")}}return i.join("")},_getTotalSummaryHtml:function(e,t,n){var r=this,i=this.options,s=[];return t?s.push('<tr class="l-grid-totalsummary '+t+'">'):s.push('<tr class="l-grid-totalsummary">'),$(r.columns).each(function(t,i){if(this.frozen!=n)return;if(this.isrownumber){s.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-rownumbers" style="width:'+this.width+'px"><div>&nbsp;</div></td>');return}if(this.ischeckbox){s.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-checkbox" style="width:'+this.width+'px"><div>&nbsp;</div></td>');return}if(this.isdetail){s.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-detail" style="width:'+this.width+'px"><div>&nbsp;</div></td>');return}s.push('<td class="l-grid-totalsummary-cell'),this.islast&&s.push(" l-grid-totalsummary-cell-last"),s.push('" '),s.push('id="'+r.id+"|total"+r.totalNumber+"|"+i.__id+'" '),s.push('width="'+this._width+'" '),columnname=this.columnname,columnname&&s.push('columnname="'+columnname+'" '),s.push('columnindex="'+t+'" '),s.push('><div class="l-grid-totalsummary-cell-inner"'),i.align&&s.push(' style="text-Align:'+i.align+';"'),s.push(">"),s.push(r._getTotalCellContent(i,e)),s.push("</div></td>")}),s.push("</tr>"),n||r.totalNumber++,s.join("")},_bulidTotalSummary:function(e){var t=this,n=this.options;if(!t.isTotalSummary())return!1;if(!t.currentData||t.currentData[n.root].length==0)return!1;var r=$(t._getTotalSummaryHtml(t.currentData[n.root],null,e));$("tbody:first",e?t.f.gridbody:t.gridbody).append(r)},_buildPager:function(){var e=this,t=this.options;$(".pcontrol input",e.toolbar).val(t.page),t.pageCount||(t.pageCount=1),$(".pcontrol span",e.toolbar).html(t.pageCount);var n=parseInt((t.page-1)*t.pageSize)+1,r=parseInt(n)+parseInt(t.pageSize)-1;t.total||(t.total=0),t.total<r&&(r=t.total),t.total||(n=r=0),n<0&&(n=0),r<0&&(r=0);var i=t.pageStatMessage;i=i.replace(/{from}/,n),i=i.replace(/{to}/,r),i=i.replace(/{total}/,t.total),i=i.replace(/{pagesize}/,t.pageSize),$(".l-bar-text",e.toolbar).html(i),t.total||$(".l-bar-btnfirst span,.l-bar-btnprev span,.l-bar-btnnext span,.l-bar-btnlast span",e.toolbar).addClass("l-disabled"),t.page==1?($(".l-bar-btnfirst span",e.toolbar).addClass("l-disabled"),$(".l-bar-btnprev span",e.toolbar).addClass("l-disabled")):t.page>t.pageCount&&t.pageCount>0&&($(".l-bar-btnfirst span",e.toolbar).removeClass("l-disabled"),$(".l-bar-btnprev span",e.toolbar).removeClass("l-disabled")),t.page==t.pageCount?($(".l-bar-btnlast span",e.toolbar).addClass("l-disabled"),$(".l-bar-btnnext span",e.toolbar).addClass("l-disabled")):t.page<t.pageCount&&t.pageCount>0&&($(".l-bar-btnlast span",e.toolbar).removeClass("l-disabled"),$(".l-bar-btnnext span",e.toolbar).removeClass("l-disabled"))},_getRowIdByDomId:function(e){var t=e.split("|"),n=t[2];return n},_getRowByDomId:function(e){return this.records[this._getRowIdByDomId(e)]},_getSrcElementByEvent:function(e){var t=this,n=e.target||e.srcElement,r=$(n).parents().add(n),i=function(e){for(var t=0,n=r.length;t<n;t++)if(typeof e=="string"){if($(r[t]).hasClass(e))return r[t]}else if(typeof e=="object"&&r[t]==e)return r[t];return null};if(i("l-grid-editor"))return{editing:!0,editor:i("l-grid-editor")};if(r.index(this.element)==-1)return{out:!0};var s=!1;if(r.hasClass("l-grid-detailpanel")&&t.detailrows)for(var o=0,u=t.detailrows.length;o<u;o++)if(r.index(t.detailrows[o])!=-1){s=!0;break}var a={grid:i("l-panel"),indetail:s,frozen:i(t.gridview1[0])?!0:!1,header:i("l-panel-header"),gridheader:i("l-grid-header"),gridbody:i("l-grid-body"),total:i("l-panel-bar-total"),popup:i("l-grid-popup"),toolbar:i("l-panel-bar")};if(a.gridheader){a.hrow=i("l-grid-hd-row"),a.hcell=i("l-grid-hd-cell"),a.hcelltext=i("l-grid-hd-cell-text"),a.checkboxall=i("l-grid-hd-cell-checkbox");if(a.hcell){var f=a.hcell.id.split("|")[2];a.column=t._columns[f]}}return a.gridbody&&(a.row=i("l-grid-row"),a.cell=i("l-grid-row-cell"),a.checkbox=i("l-grid-row-cell-btn-checkbox"),a.groupbtn=i("l-grid-group-togglebtn"),a.grouprow=i("l-grid-grouprow"),a.detailbtn=i("l-grid-row-cell-detailbtn"),a.detailrow=i("l-grid-detailpanel"),a.totalrow=i("l-grid-totalsummary"),a.totalcell=i("l-grid-totalsummary-cell"),a.rownumberscell=$(a.cell).hasClass("l-grid-row-cell-rownumbers")?a.cell:null,a.detailcell=$(a.cell).hasClass("l-grid-row-cell-detail")?a.cell:null,a.checkboxcell=$(a.cell).hasClass("l-grid-row-cell-checkbox")?a.cell:null,a.treelink=i("l-grid-tree-link"),a.editor=i("l-grid-editor"),a.row&&(a.data=this._getRowByDomId(a.row.id)),a.cell&&(a.editing=$(a.cell).hasClass("l-grid-row-cell-editing")),a.editor&&(a.editing=!0),a.editing&&(a.out=!1)),a.toolbar&&(a.first=i("l-bar-btnfirst"),a.last=i("l-bar-btnlast"),a.next=i("l-bar-btnnext"),a.prev=i("l-bar-btnprev"),a.load=i("l-bar-btnload"),a.button=i("l-bar-button")),a},_setEvent:function(){var e=this,t=this.options;e.grid.bind("mousedown.grid",function(t){e._onMouseDown.call(e,t)}),e.grid.bind("dblclick.grid",function(t){e._onDblClick.call(e,t)}),e.grid.bind("contextmenu.grid",function(t){return e._onContextmenu.call(e,t)}),$(document).bind("mouseup.grid",function(t){e._onMouseUp.call(e,t)}),$(document).bind("click.grid",function(t){e._onClick.call(e,t)}),$(window).bind("resize.grid",function(t){e._onResize.call(e)}),$(document).bind("keydown.grid",function(t){t.ctrlKey&&(e.ctrlKey=!0)}),$(document).bind("keyup.grid",function(t){delete e.ctrlKey}),e.gridbody.bind("scroll.grid",function(){var t=e.gridbody.scrollLeft(),n=e.gridbody.scrollTop();t!=null&&(e.gridheader[0].scrollLeft=t),n!=null&&(e.f.gridbody[0].scrollTop=n),e.endEdit(),e.trigger("SysGridHeightChanged")}),$("select",e.toolbar).change(function(){if(e.isDataChanged&&!confirm(t.isContinueByDataChanged))return!1;t.newPage=1,t.pageSize=this.value,e.loadData(t.where)}),$("span.pcontrol :text",e.toolbar).blur(function(t){e.changePage("input")}),$("div.l-bar-button",e.toolbar).hover(function(){$(this).addClass("l-bar-button-over")},function(){$(this).removeClass("l-bar-button-over")}),$.fn.ligerDrag&&t.colDraggable&&(e.colDroptip=$("<div class='l-drag-coldroptip' style='display:none'><div class='l-drop-move-up'></div><div class='l-drop-move-down'></div></div>").appendTo("body"),e.gridheader.add(e.f.gridheader).ligerDrag({revert:!0,animate:!1,proxyX:0,proxyY:0,proxy:function(t,n){var r=e._getSrcElementByEvent(n);if(r.hcell&&r.column){var i=$(".l-grid-hd-cell-text:first",r.hcell).html(),s=$("<div class='l-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div></div>").appendTo("body");return s.append(i),s}},onRevert:function(){return!1},onRendered:function(){this.set("cursor","default"),e.children[this.id]=this},onStartDrag:function(t,n){if(n.button==2)return!1;if(e.colresizing)return!1;this.set("cursor","default");var r=e._getSrcElementByEvent(n);if(!r.hcell||!r.column||r.column.issystem||r.hcelltext)return!1;if($(r.hcell).css("cursor").indexOf("resize")!=-1)return!1;this.draggingColumn=r.column,e.coldragging=!0;var i=e.grid.offset();this.validRange={top:i.top,bottom:i.top+e.gridheader.height(),left:i.left-10,right:i.left+e.grid.width()+10}},onDrag:function(n,r){this.set("cursor","default");var i=this.draggingColumn;if(!i)return!1;if(e.colresizing)return!1;e.colDropIn==null&&(e.colDropIn=-1);var s=r.pageX,o=r.pageY,u=!1,a=e.grid.offset(),f=this.validRange;if(s<f.left||s>f.right||o>f.bottom||o<f.top){e.colDropIn=-1,e.colDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes").addClass("l-drop-no");return}for(var l in e._columns){var c=e._columns[l];if(i==c){u=!0;continue}if(c.issystem)continue;var h=c["__level"]==i["__level"],p=h?u?!0:!1:!1;i.frozen!=c.frozen&&(p=c.frozen?!1:!0);if(e.colDropIn!=-1&&e.colDropIn!=l)continue;var d=document.getElementById(c.__domid),v=$(d).offset(),m={top:v.top,bottom:v.top+$(d).height(),left:v.left-10,right:v.left+10};if(p){var g=$(d).width();m.left+=g,m.right+=g}if(s>m.left&&s<m.right&&o>m.top&&o<m.bottom){var y=t.headerRowHeight;c.__rowSpan&&(y*=c.__rowSpan),e.colDroptip.css({left:m.left+5,top:m.top-9,height:y+18}).show(),e.colDropIn=l,e.colDropDir=p?"right":"left",this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no").addClass("l-drop-yes");break}e.colDropIn!=-1&&(e.colDropIn=-1,e.colDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes").addClass("l-drop-no"))}},onStopDrag:function(t,n){var r=this.draggingColumn;e.coldragging=!1,e.colDropIn!=-1&&(e.changeCol.ligerDefer(e,0,[r,e.colDropIn,e.colDropDir=="right"]),e.colDropIn=-1),e.colDroptip.hide(),this.set("cursor","default")}})),$.fn.ligerDrag&&t.rowDraggable&&(e.rowDroptip=$("<div class='l-drag-rowdroptip' style='display:none'></div>").appendTo("body"),e.gridbody.add(e.f.gridbody).ligerDrag({revert:!0,animate:!1,proxyX:0,proxyY:0,proxy:function(n,r){var i=e._getSrcElementByEvent(r);if(i.row){var s=t.draggingMessage.replace(/{count}/,n.draggingRows?n.draggingRows.length:1);t.rowDraggingRender&&(s=t.rowDraggingRender(n.draggingRows,n,e));var o=$("<div class='l-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div>"+s+"</div>").appendTo("body");return o}},onRevert:function(){return!1},onRendered:function(){this.set("cursor","default"),e.children[this.id]=this},onStartDrag:function(t,n){if(n.button==2)return!1;if(e.colresizing)return!1;if(!e.columns.length)return!1;this.set("cursor","default");var r=e._getSrcElementByEvent(n);if(!r.cell||!r.data||r.checkbox)return!1;var i=r.cell.id.split("|"),s=e._columns[i[i.length-1]];if(!(r.rownumberscell||r.detailcell||r.checkboxcell||s==e.columns[0]))return!1;if(e.enabledCheckbox()){this.draggingRows=e.getSelecteds();if(!this.draggingRows||!this.draggingRows.length)return!1}else this.draggingRows=[r.data];this.draggingRow=r.data,this.set("cursor","move"),e.rowdragging=!0,this.validRange={top:e.gridbody.offset().top,bottom:e.gridbody.offset().top+e.gridbody.height(),left:e.grid.offset().left-10,right:e.grid.offset().left+e.grid.width()+10}},onDrag:function(n,r){var i=this.draggingRow;if(!i)return!1;var s=this.draggingRows?this.draggingRows:[i];if(e.colresizing)return!1;e.rowDropIn==null&&(e.rowDropIn=-1);var o=r.pageX,u=r.pageY,a=!1,f=this.validRange;if(o<f.left||o>f.right||u>f.bottom||u<f.top){e.rowDropIn=-1,e.rowDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes l-drop-add").addClass("l-drop-no");return}for(var l in e.rows){var c=e.rows[l],h=c.__id;i==c&&(a=!0);if($.inArray(c,s)!=-1)continue;var p=a?!0:!1;if(e.rowDropIn!=-1&&e.rowDropIn!=h)continue;var d=e.getRowObj(h),v=$(d).offset(),m={top:v.top-4,bottom:v.top+$(d).height()+4,left:e.grid.offset().left,right:e.grid.offset().left+e.grid.width()};if(o>m.left&&o<m.right&&u>m.top&&u<m.bottom){var g=v.top;p&&(g+=$(d).height()),e.rowDroptip.css({left:m.left,top:g,width:m.right-m.left}).show(),e.rowDropIn=h,e.rowDropDir=p?"bottom":"top",t.tree&&u>m.top+5&&u<m.bottom-5?(this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-yes").addClass("l-drop-add"),e.rowDroptip
.hide(),e.rowDropInParent=!0):(this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-add").addClass("l-drop-yes"),e.rowDroptip.show(),e.rowDropInParent=!1);break}e.rowDropIn!=-1&&(e.rowDropIn=-1,e.rowDropInParent=!1,e.rowDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes  l-drop-add").addClass("l-drop-no"))}},onStopDrag:function(n,r){var i=this.draggingRows;e.rowdragging=!1;for(var s=0;s<i.length;s++){var o=i[s].children;o&&(i=$.grep(i,function(e,t){var n=$.inArray(e,o)==-1;return n}))}if(e.rowDropIn!=-1){if(t.tree){var u,a;e.rowDropInParent?a=e.getRow(e.rowDropIn):(u=e.getRow(e.rowDropIn),a=e.getParent(u)),e.appendRange(i,a,u,e.rowDropDir!="bottom"),e.trigger("rowDragDrop",{rows:i,parent:a,near:u,after:e.rowDropDir=="bottom"})}else e.moveRange(i,e.rowDropIn,e.rowDropDir=="bottom"),e.trigger("rowDragDrop",{rows:i,parent:a,near:e.getRow(e.rowDropIn),after:e.rowDropDir=="bottom"});e.rowDropIn=-1}e.rowDroptip.hide(),this.set("cursor","default")}}))},_onRowOver:function(e,t){if(l.draggable.dragging)return;var n=this,r=this.options,i=n.getRow(e),s=t?"addClass":"removeClass";n.enabledFrozen()&&$(n.getRowObj(i,!0))[s](r.mouseoverRowCssClass),$(n.getRowObj(i,!1))[s](r.mouseoverRowCssClass)},_onMouseUp:function(e){var t=this,n=this.options;if(l.draggable.dragging){var r=t._getSrcElementByEvent(e);r.hcell&&r.column?t.trigger("dragdrop",[{type:"header",column:r.column,cell:r.hcell},e]):r.row&&t.trigger("dragdrop",[{type:"row",record:r.data,row:r.row},e])}},_onMouseDown:function(e){var t=this,n=this.options},_onContextmenu:function(e){var t=this,n=this.options,r=t._getSrcElementByEvent(e);if(r.row){n.whenRClickToSelect&&t.select(r.data);if(t.hasBind("contextmenu"))return t.trigger("contextmenu",[{data:r.data,rowindex:r.data.__index,row:r.row},e])}else if(r.hcell){if(!n.allowHideColumn)return!0;var i=$(r.hcell).attr("columnindex");if(i==undefined)return!0;var s=e.pageX-t.body.offset().left+parseInt(t.body[0].scrollLeft);return i==t.columns.length-1&&(s-=50),t.popup.css({left:s,top:t.gridheader.height()+1}),t.popup.toggle(),!1}},_onDblClick:function(e){var t=this,n=this.options,r=t._getSrcElementByEvent(e);r.row&&t.trigger("dblClickRow",[r.data,r.data.__id,r.row])},_onClick:function(e){var t=e.target||e.srcElement,n=this,r=this.options,i=n._getSrcElementByEvent(e);if(i.out){n.editor.editing&&!$.ligerui.win.masking&&n.endEdit(),r.allowHideColumn&&n.popup.hide();return}if(i.indetail||i.editing)return;n.editor.editing&&n.endEdit(),r.allowHideColumn&&(i.popup||n.popup.hide());if(i.checkboxall){var s=$(i.hrow),o=s.hasClass("l-checked");if(n.trigger("beforeCheckAllRow",[!o,n.element])==0)return!1;o?s.removeClass("l-checked"):s.addClass("l-checked"),n.selected=[];for(var u in n.records)o?n.unselect(n.records[u]):n.select(n.records[u]);n.trigger("checkAllRow",[!o,n.element])}else if(i.hcelltext){var a=$(i.hcelltext).parent().parent();if(!r.enabledSort||!i.column)return;if(i.column.isSort==0)return;if(r.url&&n.isDataChanged&&!confirm(r.isContinueByDataChanged))return;var f=$(".l-grid-hd-cell-sort:first",a),l=i.column.name;if(!l)return;f.length>0?f.hasClass("l-grid-hd-cell-sort-asc")?(f.removeClass("l-grid-hd-cell-sort-asc").addClass("l-grid-hd-cell-sort-desc"),a.removeClass("l-grid-hd-cell-asc").addClass("l-grid-hd-cell-desc"),n.changeSort(l,"desc")):f.hasClass("l-grid-hd-cell-sort-desc")&&(f.removeClass("l-grid-hd-cell-sort-desc").addClass("l-grid-hd-cell-sort-asc"),a.removeClass("l-grid-hd-cell-desc").addClass("l-grid-hd-cell-asc"),n.changeSort(l,"asc")):(a.removeClass("l-grid-hd-cell-desc").addClass("l-grid-hd-cell-asc"),$(i.hcelltext).after("<span class='l-grid-hd-cell-sort l-grid-hd-cell-sort-asc'>&nbsp;&nbsp;</span>"),n.changeSort(l,"asc")),$(".l-grid-hd-cell-sort",n.gridheader).add($(".l-grid-hd-cell-sort",n.f.gridheader)).not($(".l-grid-hd-cell-sort:first",a)).remove()}else if(i.detailbtn&&r.detail){var c=i.data,s=$([n.getRowObj(c,!1)]);n.enabledFrozen()&&(s=s.add(n.getRowObj(c,!0)));var u=c.__id;if($(i.detailbtn).hasClass("l-open"))r.detail.onCollapse&&r.detail.onCollapse(c,$(".l-grid-detailpanel-inner:first",h)[0]),s.next("tr.l-grid-detailpanel").hide(),$(i.detailbtn).removeClass("l-open");else{var h=s.next("tr.l-grid-detailpanel");if(h.length>0){h.show(),r.detail.onExtend&&r.detail.onExtend(c,$(".l-grid-detailpanel-inner:first",h)[0]),$(i.detailbtn).addClass("l-open"),n.trigger("SysGridHeightChanged");return}$(i.detailbtn).addClass("l-open");var p=0;for(var d=0;d<n.columns.length;d++)n.columns[d].frozen&&p++;var v=$("<tr class='l-grid-detailpanel'><td><div class='l-grid-detailpanel-inner' style='display:none'></div></td></tr>"),m=$("<tr class='l-grid-detailpanel'><td><div class='l-grid-detailpanel-inner' style='display:none'></div></td></tr>");v.attr("id",n.id+"|detail|"+u),n.detailrows=n.detailrows||[],n.detailrows.push(v[0]),n.detailrows.push(m[0]);var g=$("div:first",v);g.parent().attr("colSpan",n.columns.length-p),s.eq(0).after(v),p>0&&(m.find("td:first").attr("colSpan",p),s.eq(1).after(m)),r.detail.onShowDetail?(r.detail.onShowDetail(c,g[0],function(){n.trigger("SysGridHeightChanged")}),$("div:first",m).add(g).show().height(r.detail.height||r.detailHeight)):r.detail.render&&(g.append(r.detail.render()),g.show()),n.trigger("SysGridHeightChanged")}}else if(i.groupbtn){var y=$(i.grouprow),b=!0;$(i.groupbtn).hasClass("l-grid-group-togglebtn-close")?($(i.groupbtn).removeClass("l-grid-group-togglebtn-close"),y.hasClass("l-grid-grouprow-last")&&$("td:first",y).width("auto")):(b=!1,$(i.groupbtn).addClass("l-grid-group-togglebtn-close"),y.hasClass("l-grid-grouprow-last")&&$("td:first",y).width(n.gridtablewidth));var w=y.next(".l-grid-row,.l-grid-totalsummary-group,.l-grid-detailpanel");for(;;){if(w.length==0)break;b?(w.show(),w.hasClass("l-grid-detailpanel")&&!w.prev().find("td.l-grid-row-cell-detail:first span.l-grid-row-cell-detailbtn:first").hasClass("l-open")&&w.hide()):w.hide(),w=w.next(".l-grid-row,.l-grid-totalsummary-group,.l-grid-detailpanel")}n.trigger("SysGridHeightChanged")}else if(i.treelink)n.toggle(i.data);else if(i.row&&n.enabledCheckbox()){var E=r.selectRowButtonOnly?!0:!1;r.enabledEdit&&(E=!0);if(i.checkbox||!E){var s=$(i.row),o=s.hasClass("l-selected");if(n.trigger("beforeCheckRow",[!o,i.data,i.data["__id"],i.row])==0)return!1;var S=o?"unselect":"select";n[S](i.data);if(r.tree&&r.autoCheckChildren){var x=n.getChildren(i.data,!0);for(var d=0,T=x.length;d<T;d++)n[S](x[d])}n.trigger("checkRow",[!o,i.data,i.data.__id,i.row])}!i.checkbox&&i.cell&&r.enabledEdit&&r.clickToEdit&&n._applyEditor(i.cell)}else if(i.row&&!n.enabledCheckbox()){i.cell&&r.enabledEdit&&r.clickToEdit&&n._applyEditor(i.cell);if($(i.row).hasClass("l-selected")){if(!r.allowUnSelectRow){$(i.row).addClass("l-selected-again");return}n.unselect(i.data)}else n.select(i.data)}else if(i.toolbar)if(i.first){if(n.trigger("toFirst",[n.element])==0)return!1;n.changePage("first")}else if(i.prev){if(n.trigger("toPrev",[n.element])==0)return!1;n.changePage("prev")}else if(i.next){if(n.trigger("toNext",[n.element])==0)return!1;n.changePage("next")}else if(i.last){if(n.trigger("toLast",[n.element])==0)return!1;n.changePage("last")}else if(i.load){if($("span",i.load).hasClass("l-disabled"))return!1;if(n.trigger("reload",[n.element])==0)return!1;if(r.url&&n.isDataChanged&&!confirm(r.isContinueByDataChanged))return!1;n.loadData(r.where)}},select:function(e){var t=this,n=this.options,r=t.getRow(e),i=r.__id,s=t.getRowObj(i),o=t.getRowObj(i,!0);if(!t.enabledCheckbox()&&!t.ctrlKey){for(var u in t.selected){var a=t.selected[u];a.__id in t.records&&($(t.getRowObj(a)).removeClass("l-selected l-selected-again"),t.enabledFrozen()&&$(t.getRowObj(a,!0)).removeClass("l-selected l-selected-again"))}t.selected=[]}s&&$(s).addClass("l-selected"),o&&$(o).addClass("l-selected"),t.selected[t.selected.length]=r,t.trigger("selectRow",[r,i,s])},unselect:function(e){var t=this,n=this.options,r=t.getRow(e),i=r.__id,s=t.getRowObj(i),o=t.getRowObj(i,!0);$(s).removeClass("l-selected l-selected-again"),t.enabledFrozen()&&$(o).removeClass("l-selected l-selected-again"),t._removeSelected(r),t.trigger("unSelectRow",[r,i,s])},isSelected:function(e){var t=this,n=this.options,r=t.getRow(e);for(var i in t.selected)if(t.selected[i]==r)return!0;return!1},_onResize:function(){var e=this,t=this.options;if(t.height&&t.height!="auto"){var n=$(window).height(),r=0,i=null;if(typeof t.height=="string"&&t.height.indexOf("%")>0){var s=e.grid.parent();t.InWindow?(i=n,i-=parseInt($("body").css("paddingTop")),i-=parseInt($("body").css("paddingBottom"))):i=s.height(),r=i*parseFloat(t.height)*.01;if(t.InWindow||s[0].tagName.toLowerCase()=="body")r-=e.grid.offset().top-parseInt($("body").css("paddingTop"))}else r=parseInt(t.height);r+=t.heightDiff,e.windowHeight=n,e._setHeight(r)}if(e.enabledFrozen()){var o=e.gridview1.width(),u=e.gridview.width();e.gridview2.css({width:u-o})}e.trigger("SysGridHeightChanged")}}),$.ligerui.controls.Grid.prototype.enabledTotal=$.ligerui.controls.Grid.prototype.isTotalSummary,$.ligerui.controls.Grid.prototype.add=$.ligerui.controls.Grid.prototype.addRow,$.ligerui.controls.Grid.prototype.update=$.ligerui.controls.Grid.prototype.updateRow,$.ligerui.controls.Grid.prototype.append=$.ligerui.controls.Grid.prototype.appendRow,$.ligerui.controls.Grid.prototype.getSelected=$.ligerui.controls.Grid.prototype.getSelectedRow,$.ligerui.controls.Grid.prototype.getSelecteds=$.ligerui.controls.Grid.prototype.getSelectedRows,$.ligerui.controls.Grid.prototype.getCheckedRows=$.ligerui.controls.Grid.prototype.getSelectedRows,$.ligerui.controls.Grid.prototype.getCheckedRowObjs=$.ligerui.controls.Grid.prototype.getSelectedRowObjs,$.ligerui.controls.Grid.prototype.setOptions=$.ligerui.controls.Grid.prototype.set})(jQuery)