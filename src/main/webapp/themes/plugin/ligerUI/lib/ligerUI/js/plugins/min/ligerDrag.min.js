(function(e){var t=e.ligerui;e.fn.ligerDrag=function(e){return t.run.call(this,"ligerDrag",arguments,{idAttrName:"ligeruidragid",hasElement:!1,propertyToElemnt:"target"})},e.fn.ligerGetDragManager=function(){return t.run.call(this,"ligerGetDragManager",arguments,{idAttrName:"ligeruidragid",hasElement:!1,propertyToElemnt:"target"})},e.ligerDefaults.Drag={onStartDrag:!1,onDrag:!1,onStopDrag:!1,handler:null,proxy:!0,revert:!1,animate:!0,onRevert:null,onEndRevert:null,receive:null,onDragEnter:null,onDragOver:null,onDragLeave:null,onDrop:null,disabled:!1,proxyX:null,proxyY:null},t.controls.Drag=function(e){t.controls.Drag.base.constructor.call(this,null,e)},t.controls.Drag.ligerExtend(t.core.UIComponent,{__getType:function(){return"Drag"},__idPrev:function(){return"Drag"},_render:function(){var e=this,t=this.options;this.set(t),e.cursor="move",e.handler.css("cursor",e.cursor),e.handler.bind("mousedown.drag",function(n){if(t.disabled)return;if(n.button==2)return;e._start.call(e,n)}).bind("mousemove.drag",function(){if(t.disabled)return;e.handler.css("cursor",e.cursor)})},_rendered:function(){this.options.target.ligeruidragid=this.id},_start:function(n){var r=this,i=this.options;if(r.reverting)return;if(i.disabled)return;r.current={target:r.target,left:r.target.offset().left,top:r.target.offset().top,startX:n.pageX||n.screenX,startY:n.pageY||n.clientY};if(r.trigger("startDrag",[r.current,n])==0)return!1;r.cursor="move",r._createProxy(i.proxy,n);if(i.proxy&&!r.proxy)return!1;(r.proxy||r.handler).css("cursor",r.cursor),e(document).bind("selectstart.drag",function(){return!1}),e(document).bind("mousemove.drag",function(){r._drag.apply(r,arguments)}),t.draggable.dragging=!0,e(document).bind("mouseup.drag",function(){t.draggable.dragging=!1,r._stop.apply(r,arguments)})},_drag:function(t){var n=this,r=this.options;if(!n.current)return;var i=t.pageX||t.screenX,s=t.pageY||t.screenY;n.current.diffX=i-n.current.startX,n.current.diffY=s-n.current.startY,(n.proxy||n.handler).css("cursor",n.cursor),n.receive&&n.receive.each(function(r,o){var u=e(o),a=u.offset();i>a.left&&i<a.left+u.width()&&s>a.top&&s<a.top+u.height()?n.receiveEntered[r]?n.trigger("dragOver",[o,n.proxy||n.target,t]):(n.receiveEntered[r]=!0,n.trigger("dragEnter",[o,n.proxy||n.target,t])):n.receiveEntered[r]&&(n.receiveEntered[r]=!1,n.trigger("dragLeave",[o,n.proxy||n.target,t]))}),n.hasBind("drag")?n.trigger("drag",[n.current,t])!=0?n._applyDrag():n._removeProxy():n._applyDrag()},_stop:function(t){var n=this,r=this.options;e(document).unbind("mousemove.drag"),e(document).unbind("mouseup.drag"),e(document).unbind("selectstart.drag"),n.receive&&n.receive.each(function(e,r){n.receiveEntered[e]&&n.trigger("drop",[r,n.proxy||n.target,t])}),n.proxy&&(r.revert?n.hasBind("revert")?n.trigger("revert",[n.current,t])!=0?n._revert(t):n._removeProxy():n._revert(t):(n._applyDrag(n.target),n._removeProxy())),n.cursor="move",n.trigger("stopDrag",[n.current,t]),n.current=null,n.handler.css("cursor",n.cursor)},_revert:function(e){var t=this;t.reverting=!0,t.proxy.animate({left:t.current.left,top:t.current.top},function(){t.reverting=!1,t._removeProxy(),t.trigger("endRevert",[t.current,e]),t.current=null})},_applyDrag:function(e){var t=this,n=this.options;e=e||t.proxy||t.target;var r={},i=!1,s=e==t.target;t.current.diffX&&(s||n.proxyX==null?r.left=t.current.left+t.current.diffX:r.left=t.current.startX+n.proxyX+t.current.diffX,i=!0),t.current.diffY&&(s||n.proxyY==null?r.top=t.current.top+t.current.diffY:r.top=t.current.startY+n.proxyY+t.current.diffY,i=!0),e==t.target&&t.proxy&&n.animate?(t.reverting=!0,e.animate(r,function(){t.reverting=!1})):e.css(r)},_setReceive:function(t){this.receiveEntered={};if(!t)return;typeof t=="string"?this.receive=e(t):this.receive=t},_setHandler:function(t){var n=this,r=this.options;t?n.handler=typeof t=="string"?e(t,r.target):t:n.handler=e(r.target)},_setTarget:function(t){this.target=e(t)},_setCursor:function(e){this.cursor=e,(this.proxy||this.handler).css("cursor",e)},_createProxy:function(t,n){if(!t)return;var r=this,i=this.options;typeof t=="function"?r.proxy=t.call(this.options.target,r,n):t=="clone"?(r.proxy=r.target.clone().css("position","absolute"),r.proxy.appendTo("body")):(r.proxy=e("<div class='l-draggable'></div>"),r.proxy.width(r.target.width()).height(r.target.height()),r.proxy.attr("dragid",r.id).appendTo("body")),r.proxy.css({left:i.proxyX==null?r.current.left:r.current.startX+i.proxyX,top:i.proxyY==null?r.current.top:r.current.startY+i.proxyY}).show()},_removeProxy:function(){var e=this;e.proxy&&(e.proxy.remove(),e.proxy=null)}})})(jQuery)