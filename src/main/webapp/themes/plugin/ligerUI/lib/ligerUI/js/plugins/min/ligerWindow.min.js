(function(e){var t=e.ligerui;t.windowCount=0,e.ligerWindow=function(e){return t.run.call(null,"ligerWindow",arguments,{isStatic:!0})},e.ligerWindow.show=function(t){return e.ligerWindow(t)},e.ligerDefaults.Window={showClose:!0,showMax:!0,showToggle:!0,showMin:!0,title:"window",load:!1,onLoaded:null,modal:!1},e.ligerMethos.Window={},t.controls.Window=function(e){t.controls.Window.base.constructor.call(this,null,e)},t.controls.Window.ligerExtend(t.core.Win,{__getType:function(){return"Window"},__idPrev:function(){return"Window"},_extendMethods:function(){return e.ligerMethos.Window},_render:function(){var n=this,r=this.options;n.window=e('<div class="l-window"><div class="l-window-header"><div class="l-window-header-buttons"><div class="l-window-toggle"></div><div class="l-window-max"></div><div class="l-window-close"></div><div class="l-clear"></div></div><div class="l-window-header-inner"></div></div><div class="l-window-content"></div></div>'),n.element=n.window[0],n.window.content=e(".l-window-content",n.window),n.window.header=e(".l-window-header",n.window),n.window.buttons=e(".l-window-header-buttons:first",n.window);if(r.url)if(r.load)n.window.content.load(r.url,function(){n.trigger("loaded")}),n.window.content.addClass("l-window-content-scroll");else{var i=e("<iframe frameborder='0' src='"+r.url+"'></iframe>"),s="ligeruiwindow"+t.windowCount++;r.name&&(s=r.name),i.attr("name",s).attr("id",s),r.framename=s,i.appendTo(n.window.content),n.iframe=i}else if(r.content){var o=e("<div>"+r.content+"</div>");o.appendTo(n.window.content)}else r.target&&(n.window.content.append(r.target),r.target.show());this.mask(),n.active(),e("body").append(n.window),n.set({width:r.width,height:r.height});var u=0,a=0;r.left!=null?u=r.left:r.left=u=.5*(e(window).width()-n.window.width()),r.top!=null?a=r.top:r.top=a=.5*(e(window).height()-n.window.height())+e(window).scrollTop()-10,u<0&&(r.left=u=0),a<0&&(r.top=a=0),n.set(r),r.framename&&e(">iframe",n.window.content).attr("name",r.framename),r.showToggle||e(".l-window-toggle",n.window).remove(),r.showMax||e(".l-window-max",n.window).remove(),r.showClose||e(".l-window-close",n.window).remove(),n._saveStatus(),e.fn.ligerDrag&&(n.draggable=n.window.drag=n.window.ligerDrag({handler:".l-window-header-inner",onStartDrag:function(){n.active()},onStopDrag:function(){n._saveStatus()},animate:!1})),e.fn.ligerResizable&&(n.resizeable=n.window.resizable=n.window.ligerResizable({onStartResize:function(){n.active(),e(".l-window-max",n.window).removeClass("l-window-regain")},onStopResize:function(e,t){var r=0,i=0;return isNaN(parseInt(n.window.css("top")))||(r=parseInt(n.window.css("top"))),isNaN(parseInt(n.window.css("left")))||(i=parseInt(n.window.css("left"))),e.diffTop&&n.window.css({top:r+e.diffTop}),e.diffLeft&&n.window.css({left:i+e.diffLeft}),e.newWidth&&n.window.width(e.newWidth),e.newHeight&&n.window.content.height(e.newHeight-28),n._saveStatus(),!1}}),n.window.append("<div class='l-btn-nw-drop'></div>")),e(".l-window-toggle",n.window).click(function(){e(this).hasClass("l-window-toggle-close")?(n.collapsed=!1,e(this).removeClass("l-window-toggle-close")):(n.collapsed=!0,e(this).addClass("l-window-toggle-close")),n.window.content.slideToggle()}).hover(function(){n.window.drag&&n.window.drag.set("disabled",!0)},function(){n.window.drag&&n.window.drag.set("disabled",!1)}),e(".l-window-close",n.window).click(function(){if(n.trigger("close")==0)return!1;n.window.hide(),t.win.removeTask(n)}).hover(function(){n.window.drag&&n.window.drag.set("disabled",!0)},function(){n.window.drag&&n.window.drag.set("disabled",!1)}),e(".l-window-max",n.window).click(function(){if(e(this).hasClass("l-window-regain")){if(n.trigger("regain")==0)return!1;n.window.width(n._width).css({left:n._left,top:n._top}),n.window.content.height(n._height-28),e(this).removeClass("l-window-regain")}else{if(n.trigger("max")==0)return!1;n.window.width(e(window).width()-2).css({left:0,top:0}),n.window.content.height(e(window).height()-28).show(),e(this).addClass("l-window-regain")}})},_saveStatus:function(){var e=this;e._width=e.window.width(),e._height=e.window.height();var t=0,n=0;isNaN(parseInt(e.window.css("top")))||(t=parseInt(e.window.css("top"))),isNaN(parseInt(e.window.css("left")))||(n=parseInt(e.window.css("left"))),e._top=t,e._left=n},min:function(){this.window.hide(),this.minimize=!0,this.actived=!1},_setShowMin:function(n){var r=this,i=this.options;n?r.winmin||(r.winmin=e('<div class="l-window-min"></div>').prependTo(r.window.buttons).click(function(){r.min()}),t.win.addTask(r)):r.winmin&&(r.winmin.remove(),r.winmin=null)},_setLeft:function(e){e!=null&&this.window.css({left:e})},_setTop:function(e){e!=null&&this.window.css({top:e})},_setWidth:function(e){e>0&&this.window.width(e)},_setHeight:function(e){e>28&&this.window.content.height(e-28)},_setTitle:function(t){t&&e(".l-window-header-inner",this.window.header).html(t)},_setUrl:function(e){var t=this,n=this.options;n.url=e,n.load?t.window.content.html("").load(n.url,function(){if(t.trigger("loaded")==0)return!1}):t.jiframe&&t.jiframe.attr("src",n.url)},hide:function(){var e=this,t=this.options;this.unmask(),this.window.hide()},show:function(){var e=this,t=this.options;this.mask(),this.window.show()},remove:function(){var e=this,t=this.options;this.unmask(),this.window.remove()},active:function(){var n=this,r=this.options;if(n.minimize){var i=n._width,s=n._height,o=n._left,u=n._top;n.maximum&&(i=e(window).width(),s=e(window).height(),o=u=0,t.win.taskbar&&(s-=t.win.taskbar.outerHeight(),t.win.top&&(u+=t.win.taskbar.outerHeight()))),n.set({width:i,height:s,left:o,top:u})}n.actived=!0,n.minimize=!1,t.win.setFront(n),n.show(),t.win.setFront(this)},setUrl:function(e){return _setUrl(e)}})})(jQuery)