(function(e){e.fn.ligerDateEditor=function(){return e.ligerui.run.call(this,"ligerDateEditor",arguments)},e.fn.ligerGetDateEditorManager=function(){return e.ligerui.run.call(this,"ligerGetDateEditorManager",arguments)},e.ligerDefaults.DateEditor={format:"yyyy-MM-dd hh:mm",showTime:!1,onChangeDate:!1,absolute:!0},e.ligerDefaults.DateEditorString={dayMessage:["日","一","二","三","四","五","六"],monthMessage:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],todayMessage:"今天",closeMessage:"关闭"},e.ligerMethos.DateEditor={},e.ligerui.controls.DateEditor=function(t,n){e.ligerui.controls.DateEditor.base.constructor.call(this,t,n)},e.ligerui.controls.DateEditor.ligerExtend(e.ligerui.controls.Input,{__getType:function(){return"DateEditor"},__idPrev:function(){return"DateEditor"},_extendMethods:function(){return e.ligerMethos.DateEditor},_render:function(){var t=this,n=this.options;!n.showTime&&n.format.indexOf(" hh:mm")>-1&&(n.format=n.format.replace(" hh:mm",""));if(this.element.tagName.toLowerCase()!="input"||this.element.type!="text")return;t.inputText=e(this.element),t.inputText.hasClass("l-text-field")||t.inputText.addClass("l-text-field"),t.link=e('<div class="l-trigger"><div class="l-trigger-icon"></div></div>'),t.text=t.inputText.wrap('<div class="l-text l-text-date"></div>').parent(),t.text.append('<div class="l-text-l"></div><div class="l-text-r"></div>'),t.text.append(t.link),t.textwrapper=t.text.wrap('<div class="l-text-wrapper"></div>').parent();var r="";r+="<div class='l-box-dateeditor' style='display:none'>",r+="    <div class='l-box-dateeditor-header'>",r+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-prevyear'><span></span></div>",r+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-prevmonth'><span></span></div>",r+="        <div class='l-box-dateeditor-header-text'><a class='l-box-dateeditor-header-month'></a> , <a  class='l-box-dateeditor-header-year'></a></div>",r+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-nextmonth'><span></span></div>",r+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-nextyear'><span></span></div>",r+="    </div>",r+="    <div class='l-box-dateeditor-body'>",r+="        <table cellpadding='0' cellspacing='0' border='0' class='l-box-dateeditor-calendar'>",r+="            <thead>",r+="                <tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr>",r+="            </thead>",r+="            <tbody>",r+="                <tr class='l-first'><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr>",r+="            </tbody>",r+="        </table>",r+="        <ul class='l-box-dateeditor-monthselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>",r+="        <ul class='l-box-dateeditor-yearselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>",r+="        <ul class='l-box-dateeditor-hourselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>",r+="        <ul class='l-box-dateeditor-minuteselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>",r+="    </div>",r+="    <div class='l-box-dateeditor-toolbar'>",r+="        <div class='l-box-dateeditor-time'></div>",r+="        <div class='l-button l-button-today'></div>",r+="        <div class='l-button l-button-close'></div>",r+="        <div class='l-clear'></div>",r+="    </div>",r+="</div>",t.dateeditor=e(r),n.absolute?t.dateeditor.appendTo("body").addClass("l-box-dateeditor-absolute"):t.textwrapper.append(t.dateeditor),t.header=e(".l-box-dateeditor-header",t.dateeditor),t.body=e(".l-box-dateeditor-body",t.dateeditor),t.toolbar=e(".l-box-dateeditor-toolbar",t.dateeditor),t.body.thead=e("thead",t.body),t.body.tbody=e("tbody",t.body),t.body.monthselector=e(".l-box-dateeditor-monthselector",t.body),t.body.yearselector=e(".l-box-dateeditor-yearselector",t.body),t.body.hourselector=e(".l-box-dateeditor-hourselector",t.body),t.body.minuteselector=e(".l-box-dateeditor-minuteselector",t.body),t.toolbar.time=e(".l-box-dateeditor-time",t.toolbar),t.toolbar.time.hour=e("<a></a>"),t.toolbar.time.minute=e("<a></a>"),t.buttons={btnPrevYear:e(".l-box-dateeditor-header-prevyear",t.header),btnNextYear:e(".l-box-dateeditor-header-nextyear",t.header),btnPrevMonth:e(".l-box-dateeditor-header-prevmonth",t.header),btnNextMonth:e(".l-box-dateeditor-header-nextmonth",t.header),btnYear:e(".l-box-dateeditor-header-year",t.header),btnMonth:e(".l-box-dateeditor-header-month",t.header),btnToday:e(".l-button-today",t.toolbar),btnClose:e(".l-button-close",t.toolbar)};var i=new Date;t.now={year:i.getFullYear(),month:i.getMonth()+1,day:i.getDay(),date:i.getDate(),hour:i.getHours(),minute:i.getMinutes()},t.currentDate={year:i.getFullYear(),month:i.getMonth()+1,day:i.getDay(),date:i.getDate(),hour:i.getHours(),minute:i.getMinutes()},t.selectedDate=null,t.usedDate=null,e("td",t.body.thead).each(function(t,r){e(r).html(n.dayMessage[t])}),e("li",t.body.monthselector).each(function(t,r){e(r).html(n.monthMessage[t])}),t.buttons.btnToday.html(n.todayMessage),t.buttons.btnClose.html(n.closeMessage),n.showTime&&(t.toolbar.time.show(),t.toolbar.time.append(t.toolbar.time.hour).append(":").append(t.toolbar.time.minute),e("li",t.body.hourselector).each(function(t,n){var r=t;t<10&&(r="0"+t.toString()),e(this).html(r)}),e("li",t.body.minuteselector).each(function(t,n){var r=t;t<10&&(r="0"+t.toString()),e(this).html(r)})),t.bulidContent(),t.inputText.val()!=""&&t.onTextChange(),t.dateeditor.hover(null,function(e){t.dateeditor.is(":visible")&&!t.editorToggling&&t.toggleDateEditor(!0)}),t.link.hover(function(){if(n.disabled)return;this.className="l-trigger-hover"},function(){if(n.disabled)return;this.className="l-trigger"}).mousedown(function(){if(n.disabled)return;this.className="l-trigger-pressed"}).mouseup(function(){if(n.disabled)return;this.className="l-trigger-hover"}).click(function(){if(n.disabled)return;t.bulidContent(),t.toggleDateEditor(t.dateeditor.is(":visible"))}),n.disabled&&(t.inputText.attr("readonly","readonly"),t.text.addClass("l-text-disabled")),n.initValue&&t.inputText.val(n.initValue),t.buttons.btnClose.click(function(){t.toggleDateEditor(!0)}),e("td",t.body.tbody).hover(function(){if(e(this).hasClass("l-box-dateeditor-today"))return;e(this).addClass("l-box-dateeditor-over")},function(){e(this).removeClass("l-box-dateeditor-over")}).click(function(){e(".l-box-dateeditor-selected",t.body.tbody).removeClass("l-box-dateeditor-selected"),e(this).hasClass("l-box-dateeditor-today")||e(this).addClass("l-box-dateeditor-selected"),t.currentDate.date=parseInt(e(this).html()),t.currentDate.day=(new Date(t.currentDate.year,t.currentDate.month-1,1)).getDay(),e(this).hasClass("l-box-dateeditor-out")&&(e("tr",t.body.tbody).index(e(this).parent())==0?--t.currentDate.month==0&&(t.currentDate.month=12,t.currentDate.year--):++t.currentDate.month==13&&(t.currentDate.month=1,t.currentDate.year++)),t.selectedDate={year:t.currentDate.year,month:t.currentDate.month,date:t.currentDate.date},t.showDate(),t.editorToggling=!0,t.dateeditor.slideToggle("fast",function(){t.editorToggling=!1})}),e(".l-box-dateeditor-header-btn",t.header).hover(function(){e(this).addClass("l-box-dateeditor-header-btn-over")},function(){e(this).removeClass("l-box-dateeditor-header-btn-over")}),t.buttons.btnYear.click(function(){t.body.yearselector.is(":visible")||e("li",t.body.yearselector).each(function(n,r){var i=t.currentDate.year+(n-4);i==t.currentDate.year?e(this).addClass("l-selected"):e(this).removeClass("l-selected"),e(this).html(i)}),t.body.yearselector.slideToggle()}),t.body.yearselector.hover(function(){},function(){e(this).slideUp()}),e("li",t.body.yearselector).click(function(){t.currentDate.year=parseInt(e(this).html()),t.body.yearselector.slideToggle(),t.bulidContent()}),t.buttons.btnMonth.click(function(){e("li",t.body.monthselector).each(function(n,r){t.currentDate.month==n+1?e(this).addClass("l-selected"):e(this).removeClass("l-selected")}),t.body.monthselector.slideToggle()}),t.body.monthselector.hover(function(){},function(){e(this).slideUp("fast")}),e("li",t.body.monthselector).click(function(){var n=e("li",t.body.monthselector).index(this);t.currentDate.month=n+1,t.body.monthselector.slideToggle(),t.bulidContent()}),t.toolbar.time.hour.click(function(){e("li",t.body.hourselector).each(function(n,r){t.currentDate.hour==n?e(this).addClass("l-selected"):e(this).removeClass("l-selected")}),t.body.hourselector.slideToggle()}),t.body.hourselector.hover(function(){},function(){e(this).slideUp("fast")}),e("li",t.body.hourselector).click(function(){var n=e("li",t.body.hourselector).index(this);t.currentDate.hour=n,t.body.hourselector.slideToggle(),t.bulidContent()}),t.toolbar.time.minute.click(function(){e("li",t.body.minuteselector).each(function(n,r){t.currentDate.minute==n?e(this).addClass("l-selected"):e(this).removeClass("l-selected")}),t.body.minuteselector.slideToggle("fast",function(){var t=e("li",this).index(e("li.l-selected",this));if(t>29){var n=e("li.l-selected",this).offset().top-e(this).offset().top;e(this).animate({scrollTop:n})}})}),t.body.minuteselector.hover(function(){},function(){e(this).slideUp("fast")}),e("li",t.body.minuteselector).click(function(){var n=e("li",t.body.minuteselector).index(this);t.currentDate.minute=n,t.body.minuteselector.slideToggle("fast"),t.bulidContent()}),t.buttons.btnPrevMonth.click(function(){--t.currentDate.month==0&&(t.currentDate.month=12,t.currentDate.year--),t.bulidContent()}),t.buttons.btnNextMonth.click(function(){++t.currentDate.month==13&&(t.currentDate.month=1,t.currentDate.year++),t.bulidContent()}),t.buttons.btnPrevYear.click(function(){t.currentDate.year--,t.bulidContent()}),t.buttons.btnNextYear.click(function(){t.currentDate.year++,t.bulidContent()}),t.buttons.btnToday.click(function(){t.currentDate={year:t.now.year,month:t.now.month,day:t.now.day,date:t.now.date},t.selectedDate={year:t.now.year,month:t.now.month,day:t.now.day,date:t.now.date},t.showDate(),t.dateeditor.slideToggle("fast")}),t.inputText.change(function(){t.onTextChange()}).blur(function(){t.text.removeClass("l-text-focus")}).focus(function(){t.text.addClass("l-text-focus")}),t.text.hover(function(){t.text.addClass("l-text-over")},function(){t.text.removeClass("l-text-over")}),n.label&&(t.labelwrapper=t.textwrapper.wrap('<div class="l-labeltext"></div>').parent(),t.labelwrapper.prepend('<div class="l-text-label" style="float:left;display:inline;">'+n.label+":&nbsp</div>"),t.textwrapper.css("float","left"),n.labelWidth?e(".l-text-label",t.labelwrapper).outerWidth(n.labelWidth):n.labelWidth=e(".l-text-label",t.labelwrapper).outerWidth(),e(".l-text-label",t.labelwrapper).width(n.labelWidth),e(".l-text-label",t.labelwrapper).height(t.text.height()),t.labelwrapper.append('<br style="clear:both;" />'),n.labelAlign&&e(".l-text-label",t.labelwrapper).css("text-align",n.labelAlign),t.textwrapper.css({display:"inline"}),t.labelwrapper.width(t.text.outerWidth()+n.labelWidth+2)),t.set(n)},destroy:function(){this.textwrapper&&this.textwrapper.remove(),this.dateeditor&&this.dateeditor.remove(),this.options=null,e.ligerui.remove(this)},bulidContent:function(){var t=this,n=this.options,r=(new Date(t.currentDate.year,t.currentDate.month-1,1)).getDay(),i=t.currentDate.month,s=t.currentDate.year;++i==13&&(i=1,s++);var o=(new Date(s,i-1,0)).getDate(),u=(new Date(t.currentDate.year,t.currentDate.month-1,0)).getDate();t.buttons.btnMonth.html(n.monthMessage[t.currentDate.month-1]),t.buttons.btnYear.html(t.currentDate.year),t.toolbar.time.hour.html(t.currentDate.hour),t.toolbar.time.minute.html(t.currentDate.minute),t.toolbar.time.hour.html().length==1&&t.toolbar.time.hour.html("0"+t.toolbar.time.hour.html()),t.toolbar.time.minute.html().length==1&&t.toolbar.time.minute.html("0"+t.toolbar.time.minute.html()),e("td",this.body.tbody).each(function(){this.className=""}),e("tr",this.body.tbody).each(function(n,i){e("td",i).each(function(i,s){var a=n*7+(i-r),f=a+1;t.selectedDate&&t.currentDate.year==t.selectedDate.year&&t.currentDate.month==t.selectedDate.month&&a+1==t.selectedDate.date?((i==0||i==6)&&e(s).addClass("l-box-dateeditor-holiday"),e(s).addClass("l-box-dateeditor-selected"),e(s).siblings().removeClass("l-box-dateeditor-selected")):t.currentDate.year==t.now.year&&t.currentDate.month==t.now.month&&a+1==t.now.date?((i==0||i==6)&&e(s).addClass("l-box-dateeditor-holiday"),e(s).addClass("l-box-dateeditor-today")):a<0?(f=u+f,e(s).addClass("l-box-dateeditor-out").removeClass("l-box-dateeditor-selected")):a>o-1?(f-=o,e(s).addClass("l-box-dateeditor-out").removeClass("l-box-dateeditor-selected")):i==0||i==6?e(s).addClass("l-box-dateeditor-holiday").removeClass("l-box-dateeditor-selected"):s.className="",e(s).html(f)})})},updateSelectBoxPosition:function(){var t=this,n=this.options;n.absolute?t.dateeditor.css({left:t.text.offset().left,top:t.text.offset().top+1+t.text.outerHeight()}):t.text.offset().top+4>t.dateeditor.height()&&t.text.offset().top+t.dateeditor.height()+textHeight+4-e(window).scrollTop()>e(window).height()?(t.dateeditor.css("marginTop",-1*(t.dateeditor.height()+textHeight+5)),t.showOnTop=!0):t.showOnTop=!1},toggleDateEditor:function(e){var t=this,n=this.options,r=t.text.height();t.editorToggling=!0,e?t.dateeditor.hide("fast",function(){t.editorToggling=!1}):(t.updateSelectBoxPosition(),t.dateeditor.slideDown("fast",function(){t.editorToggling=!1}))},showDate:function(){var e=this,t=this.options;if(!this.selectedDate)return;var n=e.selectedDate.year+"/"+e.selectedDate.month+"/"+e.selectedDate.date;this.currentDate.hour=parseInt(e.toolbar.time.hour.html(),10),this.currentDate.minute=parseInt(e.toolbar.time.minute.html(),10),t.showTime&&(n+=" "+this.currentDate.hour+":"+this.currentDate.minute),this.inputText.val(n),this.inputText.trigger("change").focus()},isDateTime:function(e){var t=this,n=this.options,r=e.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(r==null)return!1;var i=new Date(r[1],r[3]-1,r[4]);return i=="NaN"?!1:i.getFullYear()==r[1]&&i.getMonth()+1==r[3]&&i.getDate()==r[4]},isLongDateTime:function(e){var t=this,n=this.options,r=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2})$/,i=e.match(r);if(i==null)return!1;var s=new Date(i[1],i[3]-1,i[4],i[5],i[6]);return s=="NaN"?!1:s.getFullYear()==i[1]&&s.getMonth()+1==i[3]&&s.getDate()==i[4]&&s.getHours()==i[5]&&s.getMinutes()==i[6]},getFormatDate:function(e){var t=this,n=this.options;if(e=="NaN")return null;var r=n.format,i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(r)&&(r=r.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in i)(new RegExp("("+s+")")).test(r)&&(r=r.replace(RegExp.$1,RegExp.$1.length==1?i[s]:("00"+i[s]).substr((""+i[s]).length)));return r},onTextChange:function(){var t=this,n=this.options,r=t.inputText.val();if(r=="")return t.selectedDate=null,!0;if(!n.showTime&&!t.isDateTime(r))t.usedDate?t.inputText.val(t.getFormatDate(t.usedDate)):t.inputText.val("");else if(n.showTime&&!t.isLongDateTime(r))t.usedDate?t.inputText.val(t.getFormatDate(t.usedDate)):t.inputText.val("");else{r=r.replace(/-/g,"/");var i=t.getFormatDate(new Date(r));i==null&&(t.usedDate?t.inputText.val(t.getFormatDate(t.usedDate)):t.inputText.val("")),t.usedDate=new Date(r),t.selectedDate={year:t.usedDate.getFullYear(),month:t.usedDate.getMonth()+1,day:t.usedDate.getDay(),date:t.usedDate.getDate(),hour:t.usedDate.getHours(),minute:t.usedDate.getMinutes()},t.currentDate={year:t.usedDate.getFullYear(),month:t.usedDate.getMonth()+1,day:t.usedDate.getDay(),date:t.usedDate.getDate(),hour:t.usedDate.getHours(),minute:t.usedDate.getMinutes()},t.inputText.val(i),t.trigger("changeDate",[i]),e(t.dateeditor).is(":visible")&&t.bulidContent()}},_setHeight:function(e){var t=this;e>4&&(t.text.css({height:e}),t.inputText.css({height:e}),t.textwrapper.css({height:e}))},_setWidth:function(e){var t=this;e>20&&(t.text.css({width:e}),t.inputText.css({width:e-20}),t.textwrapper.css({width:e}))},_setValue:function(e){var t=this;e||t.inputText.val(""),typeof e=="string"?t.inputText.val(e):typeof e=="object"&&e instanceof Date&&(t.inputText.val(t.getFormatDate(e)),t.onTextChange())},_getValue:function(){return this.usedDate},setEnabled:function(){var e=this,t=this.options;this.inputText.removeAttr("readonly"),this.text.removeClass("l-text-disabled"),t.disabled=!1},setDisabled:function(){var e=this,t=this.options;this.inputText.attr("readonly","readonly"),this.text.addClass("l-text-disabled"),t.disabled=!0}})})(jQuery)