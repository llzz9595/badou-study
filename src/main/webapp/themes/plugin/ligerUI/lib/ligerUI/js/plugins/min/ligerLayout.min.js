(function(e){e.fn.ligerLayout=function(t){return e.ligerui.run.call(this,"ligerLayout",arguments)},e.fn.ligerGetLayoutManager=function(){return e.ligerui.run.call(this,"ligerGetLayoutManager",arguments)},e.ligerDefaults.Layout={topHeight:50,bottomHeight:50,leftWidth:110,centerWidth:300,rightWidth:170,InWindow:!0,heightDiff:0,height:"100%",onHeightChanged:null,isLeftCollapse:!1,isRightCollapse:!1,allowLeftCollapse:!0,allowRightCollapse:!0,allowLeftResize:!0,allowRightResize:!0,allowTopResize:!0,allowBottomResize:!0,space:3,onEndResize:null,minLeftWidth:80,minRightWidth:80},e.ligerMethos.Layout={},e.ligerui.controls.Layout=function(t,n){e.ligerui.controls.Layout.base.constructor.call(this,t,n)},e.ligerui.controls.Layout.ligerExtend(e.ligerui.core.UIComponent,{__getType:function(){return"Layout"},__idPrev:function(){return"Layout"},_extendMethods:function(){return e.ligerMethos.Layout},_render:function(){var t=this,n=this.options;t.layout=e(this.element),t.layout.addClass("l-layout"),t.width=t.layout.width(),e("> div[position=top]",t.layout).length>0&&(t.top=e("> div[position=top]",t.layout).wrap('<div class="l-layout-top" style="top:0px;"></div>').parent(),t.top.content=e("> div[position=top]",t.top),t.top.content.hasClass("l-layout-content")||t.top.content.addClass("l-layout-content"),t.topHeight=n.topHeight,t.topHeight&&t.top.height(t.topHeight));if(e("> div[position=bottom]",t.layout).length>0){t.bottom=e("> div[position=bottom]",t.layout).wrap('<div class="l-layout-bottom"></div>').parent(),t.bottom.content=e("> div[position=bottom]",t.bottom),t.bottom.content.hasClass("l-layout-content")||t.bottom.content.addClass("l-layout-content"),t.bottomHeight=n.bottomHeight,t.bottomHeight&&t.bottom.height(t.bottomHeight);var r=t.bottom.content.attr("title");r&&(t.bottom.header=e('<div class="l-layout-header"></div>'),t.bottom.prepend(t.bottom.header),t.bottom.header.html(r),t.bottom.content.attr("title",""))}if(e("> div[position=left]",t.layout).length>0){t.left=e("> div[position=left]",t.layout).wrap('<div class="l-layout-left" style="left:0px;"></div>').parent(),t.left.header=e('<div class="l-layout-header"><div class="l-layout-header-toggle"></div><div class="l-layout-header-inner"></div></div>'),t.left.prepend(t.left.header),t.left.header.toggle=e(".l-layout-header-toggle",t.left.header),t.left.content=e("> div[position=left]",t.left),t.left.content.hasClass("l-layout-content")||t.left.content.addClass("l-layout-content"),n.allowLeftCollapse||e(".l-layout-header-toggle",t.left.header).remove();var i=t.left.content.attr("title");i&&(t.left.content.attr("title",""),e(".l-layout-header-inner",t.left.header).html(i)),t.leftWidth=n.leftWidth,t.leftWidth&&t.left.width(t.leftWidth)}if(e("> div[position=center]",t.layout).length>0){t.center=e("> div[position=center]",t.layout).wrap('<div class="l-layout-center" ></div>').parent(),t.center.content=e("> div[position=center]",t.center),t.center.content.addClass("l-layout-content");var s=t.center.content.attr("title");s&&(t.center.content.attr("title",""),t.center.header=e('<div class="l-layout-header"></div>'),t.center.prepend(t.center.header),t.center.header.html(s)),t.centerWidth=n.centerWidth,t.centerWidth&&t.center.width(t.centerWidth)}if(e("> div[position=right]",t.layout).length>0){t.right=e("> div[position=right]",t.layout).wrap('<div class="l-layout-right"></div>').parent(),t.right.header=e('<div class="l-layout-header"><div class="l-layout-header-toggle"></div><div class="l-layout-header-inner"></div></div>'),t.right.prepend(t.right.header),t.right.header.toggle=e(".l-layout-header-toggle",t.right.header),n.allowRightCollapse||e(".l-layout-header-toggle",t.right.header).remove(),t.right.content=e("> div[position=right]",t.right),t.right.content.hasClass("l-layout-content")||t.right.content.addClass("l-layout-content");var o=t.right.content.attr("title");o&&(t.right.content.attr("title",""),e(".l-layout-header-inner",t.right.header).html(o)),t.rightWidth=n.rightWidth,t.rightWidth&&t.right.width(t.rightWidth)}t.layout.lock=e("<div class='l-layout-lock'></div>"),t.layout.append(t.layout.lock),t._addDropHandle(),t.isLeftCollapse=n.isLeftCollapse,t.isRightCollapse=n.isRightCollapse,t.leftCollapse=e('<div class="l-layout-collapse-left" style="display: none; "><div class="l-layout-collapse-left-toggle"></div></div>'),t.rightCollapse=e('<div class="l-layout-collapse-right" style="display: none; "><div class="l-layout-collapse-right-toggle"></div></div>'),t.layout.append(t.leftCollapse).append(t.rightCollapse),t.leftCollapse.toggle=e("> .l-layout-collapse-left-toggle",t.leftCollapse),t.rightCollapse.toggle=e("> .l-layout-collapse-right-toggle",t.rightCollapse),t._setCollapse(),t._bulid(),e(window).resize(function(){t._onResize()}),t.set(n)},setLeftCollapse:function(e){var t=this,n=this.options;if(!t.left)return!1;t.isLeftCollapse=e,t.isLeftCollapse?(t.leftCollapse.show(),t.leftDropHandle&&t.leftDropHandle.hide(),t.left.hide()):(t.leftCollapse.hide(),t.leftDropHandle&&t.leftDropHandle.show(),t.left.show()),t._onResize()},setRightCollapse:function(e){var t=this,n=this.options;if(!t.right)return!1;t.isRightCollapse=e,t._onResize(),t.isRightCollapse?(t.rightCollapse.show(),t.rightDropHandle&&t.rightDropHandle.hide(),t.right.hide()):(t.rightCollapse.hide(),t.rightDropHandle&&t.rightDropHandle.show(),t.right.show()),t._onResize()},_bulid:function(){var t=this,n=this.options;e("> .l-layout-left .l-layout-header,> .l-layout-right .l-layout-header",t.layout).hover(function(){e(this).addClass("l-layout-header-over")},function(){e(this).removeClass("l-layout-header-over")}),e(".l-layout-header-toggle",t.layout).hover(function(){e(this).addClass("l-layout-header-toggle-over")},function(){e(this).removeClass("l-layout-header-toggle-over")}),e(".l-layout-header-toggle",t.left).click(function(){t.setLeftCollapse(!0)}),e(".l-layout-header-toggle",t.right).click(function(){t.setRightCollapse(!0)}),t.middleTop=0,t.top&&(t.middleTop+=t.top.height(),t.middleTop+=parseInt(t.top.css("borderTopWidth")),t.middleTop+=parseInt(t.top.css("borderBottomWidth")),t.middleTop+=n.space),t.left&&(t.left.css({top:t.middleTop}),t.leftCollapse.css({top:t.middleTop})),t.center&&t.center.css({top:t.middleTop}),t.right&&(t.right.css({top:t.middleTop}),t.rightCollapse.css({top:t.middleTop})),t.left&&t.left.css({left:0}),t._onResize(),t._onResize()},_setCollapse:function(){var t=this,n=this.options;t.leftCollapse.hover(function(){e(this).addClass("l-layout-collapse-left-over")},function(){e(this).removeClass("l-layout-collapse-left-over")}),t.leftCollapse.toggle.hover(function(){e(this).addClass("l-layout-collapse-left-toggle-over")},function(){e(this).removeClass("l-layout-collapse-left-toggle-over")}),t.rightCollapse.hover(function(){e(this).addClass("l-layout-collapse-right-over")},function(){e(this).removeClass("l-layout-collapse-right-over")}),t.rightCollapse.toggle.hover(function(){e(this).addClass("l-layout-collapse-right-toggle-over")},function(){e(this).removeClass("l-layout-collapse-right-toggle-over")}),t.leftCollapse.toggle.click(function(){t.setLeftCollapse(!1)}),t.rightCollapse.toggle.click(function(){t.setRightCollapse(!1)}),t.left&&t.isLeftCollapse&&(t.leftCollapse.show(),t.leftDropHandle&&t.leftDropHandle.hide(),t.left.hide()),t.right&&t.isRightCollapse&&(t.rightCollapse.show(),t.rightDropHandle&&t.rightDropHandle.hide(),t.right.hide())},_addDropHandle:function(){var t=this,n=this.options;t.left&&n.allowLeftResize&&(t.leftDropHandle=e("<div class='l-layout-drophandle-left'></div>"),t.layout.append(t.leftDropHandle),t.leftDropHandle&&t.leftDropHandle.show(),t.leftDropHandle.mousedown(function(e){t._start("leftresize",e)})),t.right&&n.allowRightResize&&(t.rightDropHandle=e("<div class='l-layout-drophandle-right'></div>"),t.layout.append(t.rightDropHandle),t.rightDropHandle&&t.rightDropHandle.show(),t.rightDropHandle.mousedown(function(e){t._start("rightresize",e)})),t.top&&n.allowTopResize&&(t.topDropHandle=e("<div class='l-layout-drophandle-top'></div>"),t.layout.append(t.topDropHandle),t.topDropHandle.show(),t.topDropHandle.mousedown(function(e){t._start("topresize",e)})),t.bottom&&n.allowBottomResize&&(t.bottomDropHandle=e("<div class='l-layout-drophandle-bottom'></div>"),t.layout.append(t.bottomDropHandle),t.bottomDropHandle.show(),t.bottomDropHandle.mousedown(function(e){t._start("bottomresize",e)})),t.draggingxline=e("<div class='l-layout-dragging-xline'></div>"),t.draggingyline=e("<div class='l-layout-dragging-yline'></div>"),t.layout.append(t.draggingxline).append(t.draggingyline)},_setDropHandlePosition:function(){var e=this,t=this.options;e.leftDropHandle&&e.leftDropHandle.css({left:e.left.width()+parseInt(e.left.css("left")),height:e.middleHeight,top:e.middleTop}),e.rightDropHandle&&e.rightDropHandle.css({left:parseInt(e.right.css("left"))-t.space,height:e.middleHeight,top:e.middleTop}),e.topDropHandle&&e.topDropHandle.css({top:e.top.height()+parseInt(e.top.css("top")),width:e.top.width()}),e.bottomDropHandle&&e.bottomDropHandle.css({top:parseInt(e.bottom.css("top"))-t.space,width:e.bottom.width()})},_onResize:function(){var t=this,n=this.options,r=t.layout.height(),i=0,s=e(window).height(),o=null;if(typeof n.height=="string"&&n.height.indexOf("%")>0){var u=t.layout.parent();n.InWindow||u[0].tagName.toLowerCase()=="body"?(o=s,o-=parseInt(e("body").css("paddingTop")),o-=parseInt(e("body").css("paddingBottom"))):o=u.height(),i=o*parseFloat(n.height)*.01;if(n.InWindow||u[0].tagName.toLowerCase()=="body")i-=t.layout.offset().top-parseInt(e("body").css("paddingTop"))}else i=parseInt(n.height);i+=n.heightDiff,t.layout.height(i),t.layoutHeight=t.layout.height(),t.middleWidth=t.layout.width(),t.middleHeight=t.layout.height(),t.top&&(t.middleHeight-=t.top.height(),t.middleHeight-=parseInt(t.top.css("borderTopWidth")),t.middleHeight-=parseInt(t.top.css("borderBottomWidth")),t.middleHeight-=n.space),t.bottom&&(t.middleHeight-=t.bottom.height(),t.middleHeight-=parseInt(t.bottom.css("borderTopWidth")),t.middleHeight-=parseInt(t.bottom.css("borderBottomWidth")),t.middleHeight-=n.space),t.middleHeight-=2,t.hasBind("heightChanged")&&t.layoutHeight!=r&&t.trigger("heightChanged",[{layoutHeight:t.layoutHeight,diff:t.layoutHeight-r,middleHeight:t.middleHeight}]);if(t.center){t.centerWidth=t.middleWidth,t.left&&(t.isLeftCollapse?(t.centerWidth-=t.leftCollapse.width(),t.centerWidth-=parseInt(t.leftCollapse.css("borderLeftWidth")),t.centerWidth-=parseInt(t.leftCollapse.css("borderRightWidth")),t.centerWidth-=parseInt(t.leftCollapse.css("left")),t.centerWidth-=n.space):(t.centerWidth-=t.leftWidth,t.centerWidth-=parseInt(t.left.css("borderLeftWidth")),t.centerWidth-=parseInt(t.left.css("borderRightWidth")),t.centerWidth-=parseInt(t.left.css("left")),t.centerWidth-=n.space)),t.right&&(t.isRightCollapse?(t.centerWidth-=t.rightCollapse.width(),t.centerWidth-=parseInt(t.rightCollapse.css("borderLeftWidth")),t.centerWidth-=parseInt(t.rightCollapse.css("borderRightWidth")),t.centerWidth-=parseInt(t.rightCollapse.css("right")),t.centerWidth-=n.space):(t.centerWidth-=t.rightWidth,t.centerWidth-=parseInt(t.right.css("borderLeftWidth")),t.centerWidth-=parseInt(t.right.css("borderRightWidth")),t.centerWidth-=n.space)),t.centerLeft=0,t.left&&(t.isLeftCollapse?(t.centerLeft+=t.leftCollapse.width(),t.centerLeft+=parseInt(t.leftCollapse.css("borderLeftWidth")),t.centerLeft+=parseInt(t.leftCollapse.css("borderRightWidth")),t.centerLeft+=parseInt(t.leftCollapse.css("left")),t.centerLeft+=n.space):(t.centerLeft+=t.left.width(),t.centerLeft+=parseInt(t.left.css("borderLeftWidth")),t.centerLeft+=parseInt(t.left.css("borderRightWidth")),t.centerLeft+=n.space)),t.center.css({left:t.centerLeft}),t.center.width(t.centerWidth),t.center.height(t.middleHeight);var a=t.middleHeight;t.center.header&&(a-=t.center.header.height()),t.center.content.height(a)}t.left&&(t.leftCollapse.height(t.middleHeight),t.left.height(t.middleHeight)),t.right&&(t.rightCollapse.height(t.middleHeight),t.right.height(t.middleHeight),t.rightLeft=0,t.left&&(t.isLeftCollapse?(t.rightLeft+=t.leftCollapse.width(),t.rightLeft+=parseInt(t.leftCollapse.css("borderLeftWidth")),t.rightLeft+=parseInt(t.leftCollapse.css("borderRightWidth")),t.rightLeft+=n.space):(t.rightLeft+=t.left.width(),t.rightLeft+=parseInt(t.left.css("borderLeftWidth")),t.rightLeft+=parseInt(t.left.css("borderRightWidth")),t.rightLeft+=parseInt(t.left.css("left")),t.rightLeft+=n.space)),t.center&&(t.rightLeft+=t.center.width(),t.rightLeft+=parseInt(t.center.css("borderLeftWidth")),t.rightLeft+=parseInt(t.center.css("borderRightWidth")),t.rightLeft+=n.space),t.right.css({left:t.rightLeft})),t.bottom&&(t.bottomTop=t.layoutHeight-t.bottom.height()-2,t.bottom.css({top:t.bottomTop})),t._setDropHandlePosition()},_start:function(t,n){var r=this,i=this.options;r.dragtype=t;if(t=="leftresize"||t=="rightresize")r.xresize={startX:n.pageX},r.draggingyline.css({left:n.pageX-r.layout.offset().left,height:r.middleHeight,top:r.middleTop}).show(),e("body").css("cursor","col-resize");else{if(t!="topresize"&&t!="bottomresize")return;r.yresize={startY:n.pageY},r.draggingxline.css({top:n.pageY-r.layout.offset().top,width:r.layout.width()}).show(),e("body").css("cursor","row-resize")}r.layout.lock.width(r.layout.width()),r.layout.lock.height(r.layout.height()),r.layout.lock.show(),(e.browser.msie||e.browser.safari)&&e("body").bind("selectstart",function(){return!1}),e(document).bind("mouseup",function(){r._stop.apply(r,arguments)}),e(document).bind("mousemove",function(){r._drag.apply(r,arguments)})},_drag:function(t){var n=this,r=this.options;n.xresize?(n.xresize.diff=t.pageX-n.xresize.startX,n.draggingyline.css({left:t.pageX-n.layout.offset().left}),e("body").css("cursor","col-resize")):n.yresize&&(n.yresize.diff=t.pageY-n.yresize.startY,n.draggingxline.css({top:t.pageY-n.layout.offset().top}),e("body").css("cursor","row-resize"))},_stop:function(t){var n=this,r=this.options,i;if(n.xresize&&n.xresize.diff!=undefined){i=n.xresize.diff;if(n.dragtype=="leftresize"){if(r.minLeftWidth&&n.leftWidth+n.xresize.diff<r.minLeftWidth)return;n.leftWidth+=n.xresize.diff,n.left.width(n.leftWidth),n.center?n.center.width(n.center.width()-n.xresize.diff).css({left:parseInt(n.center.css("left"))+n.xresize.diff}):n.right&&n.right.width(n.left.width()-n.xresize.diff).css({left:parseInt(n.right.css("left"))+n.xresize.diff})}else if(n.dragtype=="rightresize"){if(r.minRightWidth&&n.rightWidth-n.xresize.diff<r.minRightWidth)return;n.rightWidth-=n.xresize.diff,n.right.width(n.rightWidth).css({left:parseInt(n.right.css("left"))+n.xresize.diff}),n.center?n.center.width(n.center.width()+n.xresize.diff):n.left&&n.left.width(n.left.width()+n.xresize.diff)}}else n.yresize&&n.yresize.diff!=undefined&&(i=n.yresize.diff,n.dragtype=="topresize"?(n.top.height(n.top.height()+n.yresize.diff),n.middleTop+=n.yresize.diff,n.middleHeight-=n.yresize.diff,n.left&&(n.left.css({top:n.middleTop}).height(n.middleHeight),n.leftCollapse.css({top:n.middleTop}).height(n.middleHeight)),n.center&&n.center.css({top:n.middleTop}).height(n.middleHeight),n.right&&(n.right.css({top:n.middleTop}).height(n.middleHeight),n.rightCollapse.css({top:n.middleTop}).height(n.middleHeight))):n.dragtype=="bottomresize"&&(n.bottom.height(n.bottom.height()-n.yresize.diff),n.middleHeight+=n.yresize.diff,n.bottomTop+=n.yresize.diff,n.bottom.css({top:n.bottomTop}),n.left&&(n.left.height(n.middleHeight),n.leftCollapse.height(n.middleHeight)),n.center&&n.center.height(n.middleHeight),n.right&&(n.right.height(n.middleHeight),n.rightCollapse.height(n.middleHeight))));n.trigger("endResize",[{direction:n.dragtype?n.dragtype.replace(/resize/,""):"",diff:i},t]),n._setDropHandlePosition(),n.draggingxline.hide(),n.draggingyline.hide(),n.xresize=n.yresize=n.dragtype=!1,n.layout.lock.hide(),(e.browser.msie||e.browser.safari)&&e("body").unbind("selectstart"),e(document).unbind("mousemove",n._drag),e(document).unbind("mouseup",n._stop),e("body").css("cursor","")}})})(jQuery)