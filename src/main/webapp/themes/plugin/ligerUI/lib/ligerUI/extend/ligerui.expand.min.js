$.extend($.ligerDefaults.Grid,{rowHeight:30,checkbox:!0,fixedCellHeight:!1,frozen:!1,async:!0,headerRowHeight:30,allowUnSelectRow:!0,onError:function(e,t){LG.tip("发现系统错误 "+t)}}),$.extend($.ligerDefaults.Tab,{contextmenu:!1}),$.extend($.ligerui.controls.Grid.prototype,{_initBuildHeader:function(){var e=this,t=this.options;t.title?($(".l-panel-header-text",e.header).html(t.title),t.headerImg&&e.header.append("<img src='"+t.headerImg+"' />").addClass("l-panel-header-hasicon")):e.header.hide(),t.toolbar?$.fn.ligerToolBar&&(e.toolbarManager=e.topbar.ligerToolBar(t.toolbar)):e.topbar.remove()},addEditRow:function(e){var t=this;return e=t.add(e),t.beginEdit(e)},getEditingRow:function(){var e=this;for(var t=0,n=e.rows.length;t<n;t++)if(e.rows[t]._editing)return e.rows[t];return null},getChangedRows:function(){function n(e,n){if(!e||!e instanceof Array)return;for(var r=0,i=e.length;r<i;r++)t.push($.extend({},e[r],{__status:n}))}var e=this,t=[];return n(e.getDeleted(),"delete"),n(e.getUpdated(),"update"),n(e.getAdded(),"add"),t},getLastSelected:function(){var e=this,t=e.getSelectedRows();return t&&t.length&&t.length>0?t[t.length-1]:null}}),$.ligerDefaults.Grid.formatters.percent=function(e,t){e<0&&(e=0),e>1&&(e=1);var n=t.editor.precision||0;return(e*100).toFixed(n)+"%"},$.ligerDefaults.Grid.formatters.numberbox=function(e,t){var n=t.editor.precision||0;return e.toFixed(n)},$.ligerDefaults.Grid.formatters.currency=function(e,t){if(!e)return"0.00";e=e.toString().replace(/\$|\,/g,""),isNaN(e)&&(e="0.00"),sign=e==(e=Math.abs(e)),e=Math.floor(e*100+.50000000001),cents=e%100,e=Math.floor(e/100).toString(),cents<10&&(cents="0"+cents);for(var n=0;n<Math.floor((e.length-(1+n))/3);n++)e=e.substring(0,e.length-(4*n+3))+","+e.substring(e.length-(4*n+3));return""+((sign?"":"-")+""+e+"."+cents)},$.ligerDefaults.Grid.editors.percent={create:function(e,t){var n=t.column,r=n.editor.precision||0,i=$("<input type='text' style='text-align:right' class='l-text' />");return i.bind("keypress",function(e){var t=window.event?e.keyCode:e.which;return t>=48&&t<=57||t==46||t==8}),i.bind("blur",function(){var e=i.val();e.replace("%",""),i.val(parseFloat(e).toFixed(r))}),e.append(i),i},getValue:function(e,t){var n=e.val();n.replace("%","");var r=parseFloat(n)*.01;return r<0&&(r=0),r>1&&(r=1),r},setValue:function(e,t,n){var r=n.column,i=r.editor.precision||0;t<0&&(t=0),t>1&&(t=1);var s=(t*100).toFixed(i)+"%";e.val(s)},resize:function(e,t,n,r){e.width(t).height(n)}},$.ligerDefaults.Grid.editors.numberbox={create:function(e,t){var n=t.column,r=n.editor.precision,i=$("<input type='text' style='text-align:right' class='l-text' />");return i.bind("keypress",function(e){var t=window.event?e.keyCode:e.which;return t>=48&&t<=57||t==46||t==8}),i.bind("blur",function(){var e=i.val();i.val(parseFloat(e).toFixed(r))}),e.append(i),i},getValue:function(e,t){return parseFloat(e.val())},setValue:function(e,t,n){var r=n.column,i=r.editor.precision;e.val(t.toFixed(i))},resize:function(e,t,n,r){e.width(t).height(n)}},$.ligerDefaults.Grid.editors.date={create:function(e,t){var n=t.column,r=$("<input type='text'/>");e.append(r);var i={},s=n.editor.p||n.editor.ext;if(s){var o=typeof s=="function"?s(t.record,t.rowindex,t.value,n):s;$.extend(i,o)}return r.ligerDateEditor(i),r},getValue:function(e,t){return e.liger("option","value")},setValue:function(e,t,n){e.liger("option","value",t)},resize:function(e,t,n,r){e.liger("option","width",t),e.liger("option","height",n)},destroy:function(e,t){e.liger("destroy")}},$.ligerDefaults.Grid.editors.select=$.ligerDefaults.Grid.editors.combobox={create:function(e,t){var n=t.column,r=$("<input type='text'/>");e.append(r);var i={data:n.editor.data,slide:!1,valueField:n.editor.valueField||n.editor.valueColumnName,textField:n.editor.textField||n.editor.displayColumnName},s=n.editor.p||n.editor.ext;if(s){var o=typeof s=="function"?s(t.record,t.rowindex,t.value,n):s;$.extend(i,o)}return r.ligerComboBox(i),r},getValue:function(e,t){return e.liger("option","value")},setValue:function(e,t,n){e.liger("option","value",t)},resize:function(e,t,n,r){e.liger("option","width",t-7),e.liger("option","height",n)},destroy:function(e,t){e.liger("destroy")}},$.ligerDefaults.Grid.editors["int"]=$.ligerDefaults.Grid.editors["float"]=$.ligerDefaults.Grid.editors.spinner={create:function(e,t){var n=t.column,r=$("<input type='text'/>");e.append(r),r.css({border:"#6E90BE"});var i={type:n.editor.type=="float"?"float":"int"};return n.editor.minValue!=undefined&&(i.minValue=n.editor.minValue),n.editor.maxValue!=undefined&&(i.maxValue=n.editor.maxValue),r.ligerSpinner(i),r},getValue:function(e,t){var n=t.column,r=n.editor.type=="int";return r?parseInt(e.val(),10):parseFloat(e.val())},setValue:function(e,t,n){e.val(t)},resize:function(e,t,n,r){e.liger("option","width",t),e.liger("option","height",n)},destroy:function(e,t){e.liger("destroy")}},$.ligerDefaults.Grid.editors.string=$.ligerDefaults.Grid.editors.text={create:function(e,t){var n=$("<input type='text' class='l-text-editing'/>");typeof t.column.validate=="string"?n.attr("validate",t.column.validate):t.column.validate&&typeof t.column.validate=="object"&&n.attr("validate",JSON2.stringify(t.column.validate));if(t.grid){var r=t.grid.id+"_editor_"+t.grid.editorcounter++ +"_"+(new Date).getTime();n.attr("name",r).attr("id",r)}return e.append(n),n.ligerTextBox(),n},getValue:function(e,t){return e.val()},setValue:function(e,t,n){e.val(t)},resize:function(e,t,n,r){e.liger("option","width",t-8),e.liger("option","height",19)},destroy:function(e,t){e.liger("destroy")}},$.ligerui.controls.Grid.prototype.showFilter=function(){function u(){return encodeURIComponent(t.url.replace(/(.+)?view=/,""))}function a(){o.html('<option value="0">历史查询记录</options>');var e=u(),t=LG.cookies.get(e);if(t){var n=JSON2.parse(t);$(n).each(function(){o.append('<option value="'+this.name+'">'+this.name+"</options>")})}}function f(e){var t=u(),n,r=LG.cookies.get(t);if(r){n=JSON2.parse(r);for(var i=0,s=n.length;i<s;i++)if(n[i].name==e){n.splice(i,1),LG.cookies.set(t,JSON2.stringify(n));return}}}function l(e){var t=u(),n,r=LG.cookies.get(t);r?(n=JSON2.parse(r),n.push({name:e,value:i.getData()})):n=[{name:e,value:i.getData()}],LG.cookies.set(t,JSON2.stringify(n))}function c(e){var t=u(),n=LG.cookies.get(t);if(n){var r=JSON2.parse(n);for(var i=0,s=r.length;i<s;i++)if(r[i].name==e)return r[i].value}return null}function h(){var t=i.getData();t&&t.rules&&t.rules.length?e.set("parms",{where:JSON2.stringify(t)}):e.set("parms",{}),e.loadData()}var e=this,t=this.options;if(e.winfilter){e.winfilter.show();return}var n=$('<div id="'+e.id+'_filtercontainer"></div>').width(380).height(120).hide(),r=[];$(e.columns).each(function(){var e={name:this.name,display:this.display},t=this.type=="int"||this.type=="number"||this.type=="float",n=this.type=="date";t&&(e.type="number"),n&&(e.type="date"),this.editor&&(e.editor=this.editor),r.push(e)});var i=n.ligerFilter({fields:r});e.winfilter=$.ligerDialog.open({width:420,height:208,target:n,isResize:!0,top:50,buttons:[{text:"确定",onclick:function(e,t){h(),t.hide()}},{text:"取消",onclick:function(e,t){t.hide()}}]});var s=$('<div class="historypanle"><select class="selhistory"><option value="0">历史查询记录</options></select><input type="button" value="删除" class="deletehistory" /><input type="button" value="保存" class="savehistory" /></div>');n.append(s);var o=$(".selhistory",s).change(function(){if(this.value=="0")return;var e=c(this.value);e&&i.setData(e)});$(".deletehistory",s).click(function(){if(o.val()=="0")return;$.ligerDialog.confirm("确定删除吗",function(e){e&&(f(o.val()),a())})}),$(".savehistory",s).click(function(){$.ligerDialog.prompt("输入保存名字",JSON2.stringify(new Date).replace(/["-\.:]/g,""),!1,function(e,t){e&&t&&(l(t),a(),o.val(t))})}),a()},$.extend($.ligerui.controls.TextBox.prototype,{checkNotNull:function(){var e=this,t=this.options;t.nullText&&!t.disabled&&(e.inputText.val()||e.inputText.addClass("l-text-field-null").val(t.nullText))}}),$.extend($.ligerui.controls.ComboBox.prototype,{_setHeight:function(e){var t=this;e>10&&(t.wrapper.height(e),t.inputText.height(e),t.link.height(e),t.textwrapper.css({width:e}))}}),$.ligerui.controls.DateEditor.prototype.updateStyle=function(){var e=this,t=this.options,n=$.ligerDefaults.Grid.formatters.date(e.inputText.val(),{format:t.format});e.inputText.val(n)},$.ligerui.controls.ComboBox.prototype.loadText=function(e){var t=this,n=this.options;e=$.extend({url:"../handler/select.ashx",view:null,idfield:null,textfield:null},e||{});var r=e.value||t.getValue(),i={op:"and",rules:[{field:e.idfield,op:"equal",value:r}]};$.ajax({cache:!1,async:!0,dataType:"json",type:"post",url:e.url,data:{view:e.view,idfield:e.idfield,textfield:e.textfield,where:JSON2.stringify(i)},success:function(e){if(!e||!e.length)return;t._changeValue(e[0].id,e[0].text)}})},$.ligerui.controls.ComboBox.prototype.openSelect=function(e){function o(){if(e.grid.height)return e.grid.height;var t=e.height-60;return e.search&&(t-=55),t}function u(){if(r)r.show();else{var t=$("<div></div>"),n=$("<form></form>"),u=$("<div></div>");t.append(n).append(u),e.grid.width=e.grid.width||"99%",e.grid.height=o(),i=u.ligerGrid(e.grid),i.bind("dblClickRow",function(e){i.select(e),a(),r.hide()}),r=$.ligerDialog.open({title:e.title,width:e.width,height:e.height,top:e.top,left:e.left,target:t,buttons:[{text:"选择",onclick:function(e,t){a(),t.hide()}},{text:"取消",onclick:function(e,t){t.hide()}}]});if(e.search){s=n.ligerForm(e.search);var f=$('<li style="margin-right:9px"></li>'),l=$("<li></li>");$("ul:first",n).append(f).append(l).after('<div class="l-clear"></div>'),LG.addSearchButtons(n,i,f,l)}else n.remove()}}function a(){var r=i.selected,s=!1,o="",u="";$(r).each(function(){s&&(o+=n.split),o+=this[e.valueField],u+=this[e.textField],s=!0}),t._changeValue(o,u)}var t=this,n=this.options;e=$.extend({title:"选择数据",width:800,height:420,top:null,left:null,valueField:null,textField:null,grid:null,form:null},e||{});if(!e.grid)return;var r,i,s;t.bind("beforeOpen",function(){return u(),!1})}