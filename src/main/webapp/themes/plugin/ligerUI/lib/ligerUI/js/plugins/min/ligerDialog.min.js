(function(e){function n(n){for(var r in n)e("<img />").attr("src",t.DialogImagePath+n[r])}var t=e.ligerui;e(".l-dialog-btn").live("mouseover",function(){e(this).addClass("l-dialog-btn-over")}).live("mouseout",function(){e(this).removeClass("l-dialog-btn-over")}),e(".l-dialog-tc .l-dialog-close").live("mouseover",function(){e(this).addClass("l-dialog-close-over")}).live("mouseout",function(){e(this).removeClass("l-dialog-close-over")}),e.ligerDialog=function(){return t.run.call(null,"ligerDialog",arguments,{isStatic:!0})},e.ligerui.DialogImagePath="../../lib/ligerUI/skins/Aqua/images/win/",e.ligerDefaults.Dialog={cls:null,id:null,buttons:null,isDrag:!0,width:280,height:null,content:"",target:null,url:null,load:!1,onLoaded:null,type:"none",left:null,top:null,modal:!0,name:null,isResize:!1,allowClose:!0,opener:null,timeParmName:null,closeWhenEnter:null,isHidden:!0,show:!0,title:"提示",showMax:!1,showToggle:!1,showMin:!1,slide:e.browser.msie?!1:!0,fixedType:null,showType:null},e.ligerDefaults.DialogString={titleMessage:"提示",ok:"确定",yes:"是",no:"否",cancel:"取消",waittingMessage:"正在等待中,请稍候..."},e.ligerMethos.Dialog=e.ligerMethos.Dialog||{},t.controls.Dialog=function(e){t.controls.Dialog.base.constructor.call(this,null,e)},t.controls.Dialog.ligerExtend(t.core.Win,{__getType:function(){return"Dialog"},__idPrev:function(){return"Dialog"},_extendMethods:function(){return e.ligerMethos.Dialog},_render:function(){var n=this,r=this.options;n.set(r,!0);var i=e('<div class="l-dialog"><table class="l-dialog-table" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="l-dialog-tl"></td><td class="l-dialog-tc"><div class="l-dialog-tc-inner"><div class="l-dialog-icon"></div><div class="l-dialog-title"></div><div class="l-dialog-winbtns"><div class="l-dialog-winbtn l-dialog-close"></div></div></div></td><td class="l-dialog-tr"></td></tr><tr><td class="l-dialog-cl"></td><td class="l-dialog-cc"><div class="l-dialog-body"><div class="l-dialog-image"></div> <div class="l-dialog-content"></div><div class="l-dialog-buttons"><div class="l-dialog-buttons-inner"></div></td><td class="l-dialog-cr"></td></tr><tr><td class="l-dialog-bl"></td><td class="l-dialog-bc"></td><td class="l-dialog-br"></td></tr></tbody></table></div>');e("body").append(i),n.dialog=i,n.element=i[0],n.dialog.body=e(".l-dialog-body:first",n.dialog),n.dialog.header=e(".l-dialog-tc-inner:first",n.dialog),n.dialog.winbtns=e(".l-dialog-winbtns:first",n.dialog.header),n.dialog.buttons=e(".l-dialog-buttons:first",n.dialog),n.dialog.content=e(".l-dialog-content:first",n.dialog),n.set(r,!1),r.allowClose==0&&e(".l-dialog-close",n.dialog).remove();if(r.target||r.url||r.type=="none")r.type=null,n.dialog.addClass("l-dialog-win");r.cls&&n.dialog.addClass(r.cls),r.id&&n.dialog.attr("id",r.id),n.mask(),r.isDrag&&n._applyDrag(),r.isResize&&n._applyResize(),r.type?n._setImage():(e(".l-dialog-image",n.dialog).remove(),n.dialog.content.addClass("l-dialog-content-noimage")),r.show||(n.unmask(),n.dialog.hide());if(r.target)n.dialog.content.prepend(r.target),e(r.target).show();else if(r.url){r.timeParmName&&(r.url+=r.url.indexOf("?")==-1?"?":"&",r.url+=r.timeParmName+"="+(new Date).getTime());if(r.load)n.dialog.body.load(r.url,function(){n._saveStatus(),n.trigger("loaded")});else{n.jiframe=e("<iframe frameborder='0'></iframe>");var s=r.name?r.name:"ligerwindow"+(new Date).getTime();n.jiframe.attr("name",s),n.jiframe.attr("id",s),n.dialog.content.prepend(n.jiframe),n.dialog.content.addClass("l-dialog-content-nopadding"),setTimeout(function(){n.jiframe.attr("src",r.url),n.frame=window.frames[n.jiframe.attr("name")]},0)}}r.opener&&(n.dialog.opener=r.opener),r.buttons?e(r.buttons).each(function(t,r){var i=e('<div class="l-dialog-btn"><div class="l-dialog-btn-l"></div><div class="l-dialog-btn-r"></div><div class="l-dialog-btn-inner"></div></div>');e(".l-dialog-btn-inner",i).html(r.text),e(".l-dialog-buttons-inner",n.dialog.buttons).prepend(i),r.width&&i.width(r.width),r.onclick&&i.click(function(){r.onclick(r,n,t)})}):n.dialog.buttons.remove(),e(".l-dialog-buttons-inner",n.dialog.buttons).append("<div class='l-clear'></div>"),e(".l-dialog-title",n.dialog).bind("selectstart",function(){return!1}),n.dialog.click(function(){t.win.setFront(n)}),e(".l-dialog-tc .l-dialog-close",n.dialog).click(function(){r.isHidden?n.hide():n.close()});if(!r.fixedType){var o=0,u=0,a=r.width||n.dialog.width();r.slide==1&&(r.slide="fast"),r.left!=null?o=r.left:r.left=o=.5*(e(window).width()-a),r.top!=null?u=r.top:r.top=u=.5*(e(window).height()-n.dialog.height())+e(window).scrollTop()-10,o<0&&(r.left=o=0),u<0&&(r.top=u=0),n.dialog.css({left:o,top:u})}n.show(),e("body").bind("keydown.dialog",function(e){var t=e.which;t==13?n.enter():t==27&&n.esc()}),n._updateBtnsWidth(),n._saveStatus(),n._onReisze()},_borderX:12,_borderY:32,doMax:function(n){var r=this,i=this.options,s=e(window).width(),o=e(window).height(),u=0,a=0;t.win.taskbar&&(o-=t.win.taskbar.outerHeight(),t.win.top&&(a+=t.win.taskbar.outerHeight())),n?(r.dialog.body.animate({width:s-r._borderX},i.slide),r.dialog.animate({left:u,top:a},i.slide),r.dialog.content.animate({height:o-r._borderY-r.dialog.buttons.outerHeight()},i.slide,function(){r._onReisze()})):(r.set({width:s,height:o,left:u,top:a}),r._onReisze())},max:function(){var t=this,n=this.options;t.winmax&&(t.winmax.addClass("l-dialog-recover"),t.doMax(n.slide),t.wintoggle&&(t.wintoggle.hasClass("l-dialog-extend")?t.wintoggle.addClass("l-dialog-toggle-disabled l-dialog-extend-disabled"):t.wintoggle.addClass("l-dialog-toggle-disabled l-dialog-collapse-disabled")),t.resizable&&t.resizable.set({disabled:!0}),t.draggable&&t.draggable.set({disabled:!0}),t.maximum=!0,e(window).bind("resize.dialogmax",function(){t.doMax(!1)}))},recover:function(){var t=this,n=this.options;t.winmax&&(t.winmax.removeClass("l-dialog-recover"),n.slide?(t.dialog.body.animate({width:t._width-t._borderX},n.slide),t.dialog.animate({left:t._left,top:t._top},n.slide),t.dialog.content.animate({height:t._height-t._borderY-t.dialog.buttons.outerHeight()},n.slide,function(){t._onReisze()})):(t.set({width:t._width,height:t._height,left:t._left,top:t._top}),t._onReisze()),t.wintoggle&&t.wintoggle.removeClass("l-dialog-toggle-disabled l-dialog-extend-disabled l-dialog-collapse-disabled"),e(window).unbind("resize.dialogmax")),this.resizable&&this.resizable.set({disabled:!1}),t.draggable&&t.draggable.set({disabled:!1}),t.maximum=!1},min:function(){var e=this,n=this.options,r=t.win.getTask(this);n.slide?(e.dialog.body.animate({width:1},n.slide),r.y=r.offset().top+r.height(),r.x=r.offset().left+r.width()/2,e.dialog.animate({left:r.x,top:r.y},n.slide,function(){e.dialog.hide()})):e.dialog.hide(),e.unmask(),e.minimize=!0,e.actived=!1},active:function(){var n=this,r=this.options;if(n.minimize){var i=n._width,s=n._height,o=n._left,u=n._top;n.maximum&&(i=e(window).width(),s=e(window).height(),o=u=0,t.win.taskbar&&(s-=t.win.taskbar.outerHeight(),t.win.top&&(u+=t.win.taskbar.outerHeight()))),r.slide?(n.dialog.body.animate({width:i-n._borderX},r.slide),n.dialog.animate({left:o,top:u},r.slide)):n.set({width:i,height:s,left:o,top:u})}n.actived=!0,n.minimize=!1,t.win.setFront(n),n.show()},toggle:function(){var e=this,t=this.options;if(!e.wintoggle)return;e.wintoggle.hasClass("l-dialog-extend")?e.extend():e.collapse()},collapse:function(){var e=this,t=this.options;if(!e.wintoggle)return;t.slide?e.dialog.content.animate({height:1},t.slide):e.dialog.content.height(1),this.resizable&&this.resizable.set({disabled:!0})},extend:function(){var e=this,t=this.options;if(!e.wintoggle)return;var n=e._height-e._borderY-e.dialog.buttons.outerHeight();t.slide?e.dialog.content.animate({height:n},t.slide):e.dialog.content.height(n),this.resizable&&this.resizable.set({disabled:!1})},_updateBtnsWidth:function(){var t=this,n=e(">div",t.dialog.winbtns).length;t.dialog.winbtns.width(22*n)},_setLeft:function(e){if(!this.dialog)return;e!=null&&this.dialog.css({left:e})},_setTop:function(e){if(!this.dialog)return;e!=null&&this.dialog.css({top:e})},_setWidth:function(e){if(!this.dialog)return;e>=this._borderX&&this.dialog.body.width(e-this._borderX)},_setHeight:function(e){var t=this,n=this.options;if(!this.dialog)return;if(e>=this._borderY){var r=e-this._borderY-t.dialog.buttons.outerHeight();t.dialog.content.height(r)}},_setShowMax:function(t){var n=this,r=this.options;t?n.winmax||(n.winmax=e('<div class="l-dialog-winbtn l-dialog-max"></div>').appendTo(n.dialog.winbtns).hover(function(){e(this).hasClass("l-dialog-recover")?e(this).addClass("l-dialog-recover-over"):e(this).addClass("l-dialog-max-over")},function(){e(this).removeClass("l-dialog-max-over l-dialog-recover-over")}).click(function(){e(this).hasClass("l-dialog-recover")?n.recover():n.max()})):n.winmax&&(n.winmax.remove(),n.winmax=null),n._updateBtnsWidth()},_setShowMin:function(n){var r=this,i=this.options;n?r.winmin||(r.winmin=e('<div class="l-dialog-winbtn l-dialog-min"></div>').appendTo(r.dialog.winbtns).hover(function(){e(this).addClass("l-dialog-min-over")},function(){e(this).removeClass("l-dialog-min-over")}).click(function(){r.min()}),t.win.addTask(r)):r.winmin&&(r.winmin.remove(),r.winmin=null),r._updateBtnsWidth()},_setShowToggle:function(t){var n=this,r=this.options;t?n.wintoggle||(n.wintoggle=e('<div class="l-dialog-winbtn l-dialog-collapse"></div>').appendTo(n.dialog.winbtns).hover(function(){if(e(this).hasClass("l-dialog-toggle-disabled"))return;e(this).hasClass("l-dialog-extend")?e(this).addClass("l-dialog-extend-over"):e(this).addClass("l-dialog-collapse-over")},function(){e(this).removeClass("l-dialog-extend-over l-dialog-collapse-over")}).click(function(){if(e(this).hasClass("l-dialog-toggle-disabled"))return;if(n.wintoggle.hasClass("l-dialog-extend")){if(n.trigger("extend")==0)return;n.wintoggle.removeClass("l-dialog-extend"),n.extend(),n.trigger("extended")}else{if(n.trigger("collapse")==0)return;n.wintoggle.addClass("l-dialog-extend"),n.collapse(),n.trigger("collapseed")}})):n.wintoggle&&(n.wintoggle.remove(),n.wintoggle=null)},enter:function(){var e=this,t=this.options,n;if(t.closeWhenEnter!=undefined)n=t.closeWhenEnter;else if(t.type=="warn"||t.type=="error"||t.type=="success"||t.type=="question")n=!0;n&&e.close()},esc:function(){},_removeDialog:function(){var e=this,t=this.options;t.showType&&t.fixedType?e.dialog.animate({bottom:-1*t.height},function(){e.dialog.remove()}):e.dialog.remove()},close:function(){var n=this,r=this.options;t.win.removeTask(this),n.unmask(),n._removeDialog(),e("body").unbind("keydown.dialog")},_getVisible:function(){return this.dialog.is(":visible")},_setUrl:function(e){var t=this,n=this.options;n.url=e,n.load?t.dialog.body.html("").load(n.url,function(){t.trigger("loaded")}):t.jiframe&&t.jiframe.attr("src",n.url)},_setContent:function(e){this.dialog.content.html(e)},_setTitle:function(t){var n=this,r=this.options;t&&e(".l-dialog-title",n.dialog).html(t)},_hideDialog:function(){var e=this,t=this.options;t.showType&&t.fixedType?e.dialog.animate({bottom:-1*t.height},function(){e.dialog.hide()}):e.dialog.hide()},hidden:function(){var e=this;t.win.removeTask(e),e.dialog.hide(),e.unmask()},show:function(){var t=this,n=this.options;t.mask(),n.fixedType?n.showType?(t.dialog.css({bottom:-1*n.height}).addClass("l-dialog-fixed"),n.bottom?t.dialog.show().animate({bottom:n.bottom}):t.dialog.show().animate({bottom:0})):t.dialog.show().css({bottom:0}):t.dialog.show(),e.ligerui.win.setFront.ligerDefer(e.ligerui.win,100,[t])},setUrl:function(e){this._setUrl(e)},_saveStatus:function(){var e=this;e._width=e.dialog.body.width(),e._height=e.dialog.body.height();var t=0,n=0;isNaN(parseInt(e.dialog.css("top")))||(t=parseInt(e.dialog.css("top"))),isNaN(parseInt(e.dialog.css("left")))||(n=parseInt(e.dialog.css("left"))),e._top=t,e._left=n},_applyDrag:function(){var n=this,r=this.options;e.fn.ligerDrag&&(n.draggable=n.dialog.ligerDrag({handler:".l-dialog-title",animate:!1,onStartDrag:function(){t.win.setFront(n)},onStopDrag:function(){if(r.target){var i=t.find(e.ligerui.controls.DateEditor),s=t.find(e.ligerui.controls.ComboBox);e(e.merge(i,s)).each(function(){this.updateSelectBoxPosition&&this.updateSelectBoxPosition()})}n._saveStatus()}}))},_onReisze:function(){var t=this,n=this.options;if(n.target){var r=e(n.target).liger();r||(r=e(n.target).find(":first").liger());if(!r)return;var i=t.dialog.content.height(),s=t.dialog.content.width();r.trigger("resize",[{width:s,height:i}])}},_applyResize:function(){var t=this,n=this.options;e.fn.ligerResizable&&(t.resizable=t.dialog.ligerResizable({onStopResize:function(e,n){var r=0,i=0;return isNaN(parseInt(t.dialog.css("top")))||(r=parseInt(t.dialog.css("top"))),isNaN(parseInt(t.dialog.css("left")))||(i=parseInt(t.dialog.css("left"))),e.diffLeft&&t.set({left:i+e.diffLeft}),e.diffTop&&t.set({top:r+e.diffTop}),e.newWidth&&(t.set({width:e.newWidth}),t.dialog.body.css({width:e.newWidth-t._borderX})),e.newHeight&&t.set({height:e.newHeight}),t._onReisze(),t._saveStatus(),!1},animate:!1}))},_setImage:function(){var t=this,n=this.options;n.type&&(n.type=="success"||n.type=="donne"||n.type=="ok"?(e(".l-dialog-image",t.dialog).addClass("l-dialog-image-donne").show(),t.dialog.content.css({paddingLeft:64,paddingBottom:30})):n.type=="error"?(e(".l-dialog-image",t.dialog).addClass("l-dialog-image-error").show(),t.dialog.content.css({paddingLeft:64,paddingBottom:30})):n.type=="warn"?(e(".l-dialog-image",t.dialog).addClass("l-dialog-image-warn").show(),t.dialog.content.css({paddingLeft:64,paddingBottom:30})):n.type=="question"&&(e(".l-dialog-image",t.dialog).addClass("l-dialog-image-question").show(),t.dialog.content.css({paddingLeft:64,paddingBottom:40})))}}),t.controls.Dialog.prototype.hide=t.controls.Dialog.prototype.hidden,e.ligerDialog.open=function(t){return e.ligerDialog(t)},e.ligerDialog.close=function(){var e=t.find(t.controls.Dialog.prototype.__getType());for(var n in e){var r=e[n];r.destroy.ligerDefer(r,5)}t.win.unmask()},e.ligerDialog.show=function(n){var r=t.find(t.controls.Dialog.prototype.__getType());if(r.length)for(var i in r){r[i].show();return}return e.ligerDialog(n)},e.ligerDialog.hide=function(){var e=t.find(t.controls.Dialog.prototype.__getType());for(var n in e){var r=e[n];r.hide()}},e.ligerDialog.tip=function(t){return t=e.extend({showType:"slide",width:240,modal:!1,height:100},t||{}),e.extend(t,{fixedType:"se",type:"none",isDrag:!1,isResize:!1,showMax:!1,showToggle:!1,showMin:!1}),e.ligerDialog.open(t)},e.ligerDialog.alert=function(t,n,r,i){t=t||"",typeof n=="function"?(i=n,r=null):typeof r=="function"&&(i=r);var s=function(e,t,n){t.close(),i&&i(e,t,n)};return p={content:t,buttons:[{text:e.ligerDefaults.DialogString.ok,onclick:s}]},typeof n=="string"&&n!=""&&(p.title=n),typeof r=="string"&&r!=""&&(p.type=r),e.extend(p,{showMax:!1,showToggle:!1,showMin:!1}),e.ligerDialog(p)},e.ligerDialog.confirm=function(t,n,r){typeof n=="function"&&(r=n,type=null);var i=function(e,t){t.close(),r&&r(e.type=="ok")};return p={type:"question",content:t,buttons:[{text:e.ligerDefaults.DialogString.yes,onclick:i,type:"ok"},{text:e.ligerDefaults.DialogString.no,onclick:i,type:"no"}]},typeof n=="string"&&n!=""&&(p.title=n),e.extend(p,{showMax:!1,showToggle:!1,showMin:!1}),e.ligerDialog(p)},e.ligerDialog.warning=function(t,n,r){typeof n=="function"&&(r=n,type=null);var i=function(e,t){t.close(),r&&r(e.type)};return p={type:"question",content:t,buttons:[{text:e.ligerDefaults.DialogString.yes,onclick:i,type:"yes"},{text:e.ligerDefaults.DialogString.no,onclick:i,type:"no"},{text:e.ligerDefaults.DialogString.cancel,onclick:i,type:"cancel"}]},typeof n=="string"&&n!=""&&(p.title=n),e.extend(p,{showMax:!1,showToggle:!1,showMin:!1}),e.ligerDialog(p)},e.ligerDialog.waitting=function(t){return t=t||e.ligerDefaults.Dialog.waittingMessage,e.ligerDialog.open({cls:"l-dialog-waittingdialog",type:"none",content:'<div style="padding:4px">'+t+"</div>",allowClose:!1})},e.ligerDialog.closeWaitting=function(){var e=t.find(t.controls.Dialog);for(var n in e){var r=e[n];r.dialog.hasClass("l-dialog-waittingdialog")&&r.close()}},e.ligerDialog.success=function(t,n,r){return e.ligerDialog.alert(t,n,"success",r)},e.ligerDialog.error=function(t,n,r){return e.ligerDialog.alert(t,n,"error",r)},e.ligerDialog.warn=function(t,n,r){return e.ligerDialog.alert(t,n,"warn",r)},e.ligerDialog.question=function(t,n){return e.ligerDialog.alert(t,n,"question")},e.ligerDialog.prompt=function(t,n,r,i){var s=e('<input type="text" class="l-dialog-inputtext"/>');typeof r=="function"&&(i=r),typeof n=="function"?i=n:typeof n=="boolean"&&(r=n),typeof r=="boolean"&&r&&(s=e('<textarea class="l-dialog-textarea"></textarea>')),(typeof n=="string"||typeof n=="int")&&s.val(n);var o=function(e,t,n){t.close(),i&&i(e.type=="yes",s.val())};return p={title:t,target:s,width:320,buttons:[{text:e.ligerDefaults.DialogString.ok,onclick:o,type:"yes"},{text:e.ligerDefaults.DialogString.cancel,onclick:o,type:"cancel"}]},e.ligerDialog(p)}})(jQuery)